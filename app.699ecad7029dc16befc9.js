(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"/7QA":function(e,t,n){"use strict";n.r(t);var r=n("XH0y"),i=n("ssMx"),a=n("IqKQ"),o=n("cE7O"),s=n("fDnD"),u=n.n(s);function c(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){c(a,r,i,o,s,"next",e)}function s(e){c(a,r,i,o,s,"throw",e)}o(void 0)}))}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f,h=n("7GJN"),p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.filer=void 0,this.filer=new h}var t,n,r,i,a,s,c,f,p,m,g,v,y,b,w,x,k,E,S,R,_;return t=e,(n=[{key:"init",value:(_=l(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.init({persistent:!0,size:t},e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"create",value:(R=l(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.create(t,!1,e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"mkdir",value:(S=l(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.mkdir(t,!1,e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"ls",value:(E=l(regeneratorRuntime.mark((function e(t,n){var r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){a.filer.ls(t,e,n)}));case 2:if(r=e.sent,n){e.next=5;break}return e.abrupt("return",r);case 5:return i=n.split("|"),e.abrupt("return",r.filter((function(e){return e.isFile&&i.some((function(t){return e.name.endsWith(t)}))})));case 7:case"end":return e.stop()}}),e)}))),function(e,t){return E.apply(this,arguments)})},{key:"exists",value:(k=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.fullPath?t.fullPath:t).startsWith("/")){e.next=3;break}throw new Error('exists() only works with absolute paths, "'.concat(n,'" given.'));case 3:r=n.split("/").filter((function(e){return""!==e})),n="",i=!0,a=!1,o=void 0,e.prev=8,s=r[Symbol.iterator]();case 10:if(i=(u=s.next()).done){e.next=22;break}return c=u.value,n+="/",e.next=15,this.ls(n);case 15:if(l=e.sent,n+=c,void 0!==l.find((function(e){return e.fullPath===n}))){e.next=19;break}return e.abrupt("return",!1);case 19:i=!0,e.next=10;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(8),a=!0,o=e.t0;case 28:e.prev=28,e.prev=29,i||null==s.return||s.return();case 31:if(e.prev=31,!a){e.next=34;break}throw o;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",!0);case 37:case"end":return e.stop()}}),e,this,[[8,24,28,36],[29,,31,35]])}))),function(e){return k.apply(this,arguments)})},{key:"open",value:(x=l(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.open(t,e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"openAndGetContentAsText",value:(w=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.open(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.getTextContentFromFile.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"openAndGetContentAsStream",value:(b=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=o.a,e.t1=this,e.next=4,this.open(t);case 4:return e.t2=e.sent,e.next=7,e.t1.getUint8ContentFromFile.call(e.t1,e.t2);case 7:return e.t3=e.sent,e.abrupt("return",new e.t0(e.t3));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"openAndGetContentAsUint8Array",value:(y=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.open(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.getUint8ContentFromFile.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getTextContentFromFile",value:(v=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(t){null!==r.result?e(r.result):n()},r.onerror=function(e){n()},r.readAsText(t)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"getUint8ContentFromFile",value:(g=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(t){null!==r.result?e(new Uint8Array(r.result)):n()},r.onerror=function(e){n()},r.readAsArrayBuffer(t)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"df",value:(m=l(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.filer.df((function(t,n,r){return e({used:t,free:n,cap:r})}),n)})));case 1:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)})},{key:"write",value:(p=l(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){return r.filer.write(t,{data:n},e,i)})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return p.apply(this,arguments)})},{key:"rm",value:(f=l(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.rm(t,e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"rmRoot",value:(c=l(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ls("/");case 2:return t=e.sent,e.abrupt("return",Promise.all(t.map((function(e){return n.rm(e.fullPath)}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"download",value:(s=l(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ls(t);case 3:n=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",this.downloadFile(t));case 9:return e.abrupt("return",this.downloadDirectory(n));case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return s.apply(this,arguments)})},{key:"downloadFile",value:(a=l(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"==typeof t?t:t.fullPath,e.next=3,this.openAndGetContentAsUint8Array(t);case 3:r=e.sent,this.doDownload(n,r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"downloadDirectory",value:(i=l(regeneratorRuntime.mark((function e(t){var n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.a,r=function(){var e=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(){var e=l(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t.fullPath),!t.isFile){e.next=5;break}n.file(t.fullPath,a.openAndGetContentAsUint8Array(t)),e.next=10;break;case 5:return e.next=7,a.ls(t);case 7:return i=e.sent,e.next=10,r(i);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=4,r(t);case 4:return e.next=6,n.generateAsync({type:"uint8array"});case 6:i=e.sent,this.doDownload("data.zip",i);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"doDownload",value:function(e,t){var n=new Blob([t],{type:"application/zip"}),r=document.createElement("a");r.href=window.URL.createObjectURL(n),r.download=e,r.click()}}])&&d(t.prototype,n),r&&d(t,r),e}(),m=n("+qE3"),g=n("lXCB");function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Paused=0]="Paused",e[e.Default=1]="Default",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=4]="Fast",e[e.SuperFast=8]="SuperFast"}(f||(f={}));var y=function(){function e(t,n,r,i,a,o,s,u,c,l,d,f,h,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islands=t,this.players=n,this.tasks=r,this.gameName=i,this.soldiers=a,this.ships=o,this.kontors=s,this.castles=u,this.cities=c,this.trader=l,this.timers=d,this.producers=f,this.houses=h,this.farmFields=p}var t,n,r;return t=e,(n=[{key:"log",value:function(){console.log("Tasks"),console.table(this.tasks),console.log("Game Name",this.gameName),console.log("Islands"),console.table(this.islands),console.log("Players"),console.table(this.players),console.log("Soldiers"),console.table(this.soldiers),console.log("Ships"),console.table(this.ships),console.log("Kontors"),console.table(this.kontors),console.log("Castles"),console.table(this.castles),console.log("Cities"),console.table(this.cities),console.log("Trader",this.trader),console.log("Timers",this.timers),console.log("Producers"),console.table(this.producers),console.log("Houses"),console.table(this.houses),console.log("Farm fields"),console.table(this.farmFields)}}])&&v(t.prototype,n),r&&v(t,r),e}(),b=n("p0ib"),w=n("bne5"),x=n("Rney"),k=n("p0Sj"),E=n("67Y/"),S=n("ad02"),R=n("vurl");function _(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}var A=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.world=t,this.spriteLoader=n,this.render=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return r.spriteLoader.getIslandSprites(e)})));case 2:return n=e.sent,console.log("Map sprites loaded."),n.forEach((function(e){return e.sprites.forEach((function(e){return e.filter((function(e){return null!==e})).forEach((function(e){return r.world.addChild(e.sprite)}))}))})),console.log("Map sprites drawn."),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){_(a,r,i,o,s,"next",e)}function s(e){_(a,r,i,o,s,"throw",e)}o(void 0)}))});return function(e){return t.apply(this,arguments)}}()};function I(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T,P=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.isTrader=n,this.animation=void 0,this.bugAnimation=void 0,this.whiteFlag=void 0,this.flag=void 0,this.hp=void 0,this.HP_WIDTH=38,this.HP_HEIGHT=7}var t,n,r,i,o;return t=e,(n=[{key:"begin",value:(i=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getShipAnimation(t);case 2:return this.animation=e.sent,Object(g.a)(this.animation.config.Bugfignr),e.next=6,n.getAnimation(this.animation.config.Bugfignr);case 6:return this.bugAnimation=e.sent,e.next=9,n.getAnimation("FAHNEWEISS");case 9:if(this.whiteFlag=e.sent,this.isTrader){e.next=18;break}return r="FAHNE".concat(5===t.playerId?"PIRAT":t.playerId+1),e.next=14,n.getAnimation(r);case 14:this.flag=e.sent,this.hp=new a.Graphics,this.hp.beginFill(65280),this.hp.drawRect(0,0,this.HP_WIDTH,this.HP_HEIGHT);case 18:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){I(a,n,r,o,s,"next",e)}function s(e){I(a,n,r,o,s,"throw",e)}o(void 0)}))},function(e,t){return o.apply(this,arguments)})},{key:"render",value:function(e,t){var n=e.rotation,r=Ze.fieldPosToWorldPos(e.position),i=r.x,a=r.y,o=this.animation.animations[0].rotations[n].main,s=i+(32-Math.floor(o.width/2)),u=a+(this.animation.config.Posoffs[0]+18),c=function(e){return Math.sign(e)*Math.floor(Math.abs(e))},l=this.animation.config.Fahnoffs,d=i+32;switch(n){case 0:case 2:d+=c(64*l[1]/2);break;case 4:case 6:d+=-c(64*l[1]/2);break;case 1:d+=c(64*l[1]*Math.SQRT2/2);break;case 5:d+=-c(64*l[1]*Math.SQRT2/2);break;case 3:case 7:d+=0;break;default:Object(R.a)(n)}var f=a+48;switch(n){case 2:case 4:f+=c(32*l[1]/2);break;case 0:case 6:f+=-c(32*l[1]/2);break;case 3:f+=c(32*l[1]*Math.SQRT2/2);break;case 7:f+=-c(32*l[1]*Math.SQRT2/2);break;case 1:case 5:f+=0;break;default:Object(R.a)(n)}if(this.animation.config.Bugfignr){var h=this.bugAnimation.animations[0].rotations[n].main;h.x=d-Math.floor(h.width/2),h.y=f-30,t.addChild(h),h.play()}if(o.x=s,o.y=u,t.addChild(o),o.play(),!this.isTrader){var p=this.flag.animations[0].rotations[0].main,m=d-Math.floor(p.width/2),g=f-Math.floor(32*l[2]);p.x=m,p.y=g,t.addChild(p),p.play();var v=i+32-this.HP_WIDTH/2,y=g-p.height-this.HP_HEIGHT;this.hp.position.set(v,y),t.addChild(this.hp)}}}])&&O(t.prototype,n),r&&O(t,r),e}();function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Stopped=0]="Stopped",e[e.Sailing=55]="Sailing",e[e.Unknown=53]="Unknown",e[e.Unknown2=52]="Unknown2",e[e.Unknown3=54]="Unknown3",e[e.Unknown4=51]="Unknown4"}(T||(T={}));var N=function(){var e,t,n;function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.position=e,this.state=t}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read32(),n=t>>8&255,i=t>>16&255,o=t>>24&255,s=t>>0&255;return Object(g.a)(s in T),new r(new a.Point(o+((15&n)<<8),i+((240&n)<<4)),s)}}],(t=null)&&C(e.prototype,t),n&&C(e,n),r}(),G={21:"HANDEL1",23:"HANDEL2",25:"KRIEG1",27:"KRIEG2",29:"HANDLER",31:"PIRAT",37:"TRADER1"};function D(e){var t=e.readString(28),n=new a.Point(e.read16(),e.read16()),r=(e.read(12),N.fromSaveGame(e),N.fromSaveGame(e),N.fromSaveGame(e),e.read32(),e.read16()),i=(e.read32(),e.read8(),e.read8(),e.read16(),e.read16()),o=e.read16(),s=e.read8(),u=e.read8(),c=(e.read32(),e.read16()),l=function(e,t){for(var n=[],r=0;r<t;r++)n.push({id:e.read8(),kontor_id:e.read8(),_1:e.read16(),goods:j(e,2),_2:e.read(16)});return n}(e,8);e.read16();return{id:i,type:o,kind:s,playerId:u,position:n,rotation:c,name:t,hp:r,tradeStops:l,cargo:j(e,8)}}function j(e,t){for(var n=[],r=0;r<t;r++)n.push({good_id:e.read16(),amount:e.read16(),action:e.read32()});return n}var F=function(e,t,n){var r=new a.Point(e.x+e.width/2,e.y+e.height/2);return Math.pow(Math.abs(n.x+.5-r.x)+(e.width%2==0?0:.5),2)+Math.pow(Math.abs(n.y+.5-r.y)+(e.height%2==0?0:.5),2)<Math.ceil(Math.pow(t+Math.PI/3,2))};function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var H=function(){function e(t,n){var r,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hud=t,this.translator=n,this.container=void 0,this.onLoad=function(e){i.container=e},this.buttons=(L(r={},57028,(function(){})),L(r,57033,(function(){return i.hud.setStatusAreaContent("city-list")})),L(r,57032,(function(){return i.hud.setStatusAreaContent("ship-list")})),L(r,57031,(function(){return i.hud.setStatusAreaContent("diplomacy")})),r),this.texts={57002:this.translator.translate("game.player_status"),57005:this.translator.translate("game.inhabitants"),57008:this.translator.translate("game.tax_revenue"),57011:this.translator.translate("game.operating_cost"),57014:this.translator.translate("game.military_budget"),57017:this.translator.translate("game.sales_revenue"),57020:this.translator.translate("game.purchase_cost"),57023:this.translator.translate("game.balance_sheet"),57026:this.translator.translate("game.score")},this.ignore=[]}var t,n,r;return t=e,(n=[{key:"setOperatingCosts",value:function(e){var t=this.container.getChildByName("menu-57012");t&&(t.text=e.toString())}}])&&M(t.prototype,n),r&&M(t,r),e}();function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U,W,K,z,Z,V,q,Y,X,J,$,Q,ee,te,ne,re,ie,ae,oe,se,ue,ce,le,de=function e(t,n){var r,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gameRenderer=t,this.hud=n,this.container=void 0,this.onLoad=function(e){i.container=e,e.getChildByName("menu-".concat(30013)).emit("mousedown")},this.buttons=(B(r={30001:function(){return alert("Rotation is not supported yet :(")},30002:function(){return alert("Rotation is not supported yet :(")},30003:function(){return i.gameRenderer.zoomIn()},30004:function(){return i.gameRenderer.zoomOut()},30011:function(){return i.hud.setSidebarActiveTab("build")},30015:function(){return i.hud.setSidebarActiveTab("battle")}},30013,(function(){return i.hud.setSidebarActiveTab("status")})),B(r,30014,(function(){return i.hud.setSidebarActiveTab("options")})),r),this.texts={},this.ignore=[]};!function(e){e[e["game.stock"]=0]="game.stock",e[e["game.empty"]=1]="game.empty",e[e["game.tax"]=2]="game.tax",e[e["game.pioneers"]=3]="game.pioneers",e[e["game.settlers"]=4]="game.settlers",e[e["game.citizens"]=5]="game.citizens",e[e["game.merchants"]=6]="game.merchants",e[e["game.aristocrats"]=7]="game.aristocrats",e[e["game.food"]=8]="game.food",e[e["game.empty2"]=9]="game.empty2",e[e["game.price"]=10]="game.price",e[e["game.workload"]=11]="game.workload",e[e["game.hold"]=12]="game.hold",e[e["game.cannon"]=13]="game.cannon",e[e["game.speed"]=14]="game.speed",e[e["game.inhabitants"]=15]="game.inhabitants",e[e["game.anonymous"]=16]="game.anonymous",e[e["game.stock_full_message"]=17]="game.stock_full_message",e[e["game.operating_cost"]=18]="game.operating_cost",e[e["game.tax_revenue"]=19]="game.tax_revenue",e[e["game.workers"]=20]="game.workers",e[e["game.supplies_remaining"]=21]="game.supplies_remaining",e[e["game.suitable_for"]=22]="game.suitable_for",e[e["game.canons_ready"]=23]="game.canons_ready",e[e["game.no_canons_ready"]=24]="game.no_canons_ready",e[e["game.settings"]=25]="game.settings",e[e["game.savewd_games"]=26]="game.savewd_games",e[e["game.music_and_effects"]=27]="game.music_and_effects",e[e["game.speech"]=28]="game.speech",e[e["game.video_sequences"]=29]="game.video_sequences",e[e["game.music"]=30]="game.music",e[e["game.effects"]=31]="game.effects",e[e["game.saved_game"]=32]="game.saved_game",e[e["game.fleet_orders"]=33]="game.fleet_orders",e[e["game.troop_orders"]=34]="game.troop_orders",e[e["game.supply"]=35]="game.supply",e[e["game.demand"]=36]="game.demand",e[e["game.dired_up_field"]=37]="game.dired_up_field",e[e["game.player_status"]=38]="game.player_status",e[e["game.who_do_we"]=39]="game.who_do_we",e[e["game.want_to_attack"]=40]="game.want_to_attack",e[e["game.always_profitable"]=41]="game.always_profitable",e[e["game.to_invest"]=42]="game.to_invest",e[e["game.peaceful_life"]=43]="game.peaceful_life",e[e["game.pirate_hideout"]=44]="game.pirate_hideout",e[e["game.cost"]=45]="game.cost",e[e["game.select_target"]=46]="game.select_target",e[e["game.n_knots"]=47]="game.n_knots",e[e["game.n_percent"]=48]="game.n_percent",e[e["game.n_tons"]=49]="game.n_tons",e[e["game.?3"]=50]="game.?3",e[e["game.load_on_ship"]=51]="game.load_on_ship",e[e["game.load_on_wagon"]=52]="game.load_on_wagon",e[e["game.unload_into_warehouse"]=53]="game.unload_into_warehouse",e[e["game.buy"]=54]="game.buy",e[e["game.sell"]=55]="game.sell",e[e["game.pickup"]=56]="game.pickup",e[e["game.deliver"]=57]="game.deliver",e[e["game.at_gold_coins_each"]=58]="game.at_gold_coins_each",e[e["game.purchase_up_to"]=59]="game.purchase_up_to",e[e["game.sell_down_to"]=60]="game.sell_down_to",e[e["game.demand_fulfilled_percent"]=61]="game.demand_fulfilled_percent",e[e["game.demand_fulfilled_none"]=62]="game.demand_fulfilled_none",e[e["game.citizens_now_demand"]=63]="game.citizens_now_demand",e[e["game.sales_revenue"]=64]="game.sales_revenue",e[e["game.purchase_cost"]=65]="game.purchase_cost",e[e["game.nothing_available"]=66]="game.nothing_available",e[e["game.momentarily_no_demand"]=67]="game.momentarily_no_demand",e[e["game.no_demand"]=68]="game.no_demand",e[e["game.demand2"]=69]="game.demand2",e[e["game.demand_at_coins"]=70]="game.demand_at_coins",e[e["game.ship_list"]=71]="game.ship_list",e[e["game.military_budget"]=72]="game.military_budget",e[e["game.unit_forming_requirement"]=73]="game.unit_forming_requirement",e[e["game.unit_training_progress"]=74]="game.unit_training_progress",e[e["game.fully_trained_unit"]=75]="game.fully_trained_unit",e[e["game.no_weapons"]=76]="game.no_weapons",e[e["game.cities_list"]=77]="game.cities_list",e[e["game.pay_tribute"]=78]="game.pay_tribute",e[e["game.empty3"]=79]="game.empty3",e[e["game.balance_sheet"]=80]="game.balance_sheet",e[e["game.enter_your_name"]=81]="game.enter_your_name",e[e["game.score"]=82]="game.score",e[e["misc.insert_cd"]=83]="misc.insert_cd",e[e["misc.no_cd"]=84]="misc.no_cd",e[e["menu.divider.orginal_missions"]=85]="menu.divider.orginal_missions",e[e["menu.divider.missions"]=86]="menu.divider.missions",e[e["menu.divider.new_missions"]=87]="menu.divider.new_missions",e[e["menu.divider.custom_missions"]=88]="menu.divider.custom_missions",e[e["misc.exit_game"]=89]="misc.exit_game",e[e["misc.exit_game_question"]=90]="misc.exit_game_question"}(U||(U={})),W||(W={}),function(e){e[e["player.color.red"]=0]="player.color.red",e[e["player.color.blue"]=1]="player.color.blue",e[e["player.color.yellow"]=2]="player.color.yellow",e[e["player.color.white"]=3]="player.color.white"}(K||(K={})),function(e){e[e["videos.event"]=0]="videos.event",e[e["videos.battle"]=1]="videos.battle",e[e["videos.diplomacy"]=2]="videos.diplomacy"}(z||(z={})),function(e){e[e["speech.event"]=0]="speech.event",e[e["speech.island_status"]=1]="speech.island_status",e[e["speech.player"]=2]="speech.player",e[e["speech.trade"]=3]="speech.trade",e[e["speech.battle"]=4]="speech.battle",e[e["speech.order"]=5]="speech.order",e[e["speech.diplomacy"]=6]="speech.diplomacy"}(Z||(Z={})),function(e){e[e["path.custom_missions"]=0]="path.custom_missions"}(V||(V={})),function(e){e[e["endless.difficulty.easy"]=0]="endless.difficulty.easy",e[e["endless.difficulty.medium"]=1]="endless.difficulty.medium",e[e["endless.difficulty.difficult"]=2]="endless.difficulty.difficult",e[e["endless.difficulty.hard"]=3]="endless.difficulty.hard"}(q||(q={})),function(e){e[e["tutorial.mission_0"]=0]="tutorial.mission_0",e[e["tutorial.mission_1"]=1]="tutorial.mission_1",e[e["tutorial.mission_2"]=2]="tutorial.mission_2",e[e["tutorial.mission_3"]=3]="tutorial.mission_3",e[e["tutorial.mission_4"]=4]="tutorial.mission_4"}(Y||(Y={})),function(e){e[e["campaign.0.mission_0"]=0]="campaign.0.mission_0",e[e["campaign.0.mission_1"]=1]="campaign.0.mission_1",e[e["campaign.0.mission_2"]=2]="campaign.0.mission_2",e[e["campaign.0.mission_3"]=3]="campaign.0.mission_3",e[e["campaign.0.mission_4"]=4]="campaign.0.mission_4",e[e["campaign.1.mission_0"]=5]="campaign.1.mission_0",e[e["campaign.1.mission_1"]=6]="campaign.1.mission_1",e[e["campaign.1.mission_2"]=7]="campaign.1.mission_2",e[e["campaign.1.mission_3"]=8]="campaign.1.mission_3",e[e["campaign.1.mission_4"]=9]="campaign.1.mission_4",e[e["campaign.2.mission_0"]=10]="campaign.2.mission_0",e[e["campaign.2.mission_1"]=11]="campaign.2.mission_1",e[e["campaign.2.mission_2"]=12]="campaign.2.mission_2",e[e["campaign.2.mission_3"]=13]="campaign.2.mission_3",e[e["campaign.2.mission_4"]=14]="campaign.2.mission_4",e[e["campaign.3.mission_0"]=15]="campaign.3.mission_0",e[e["campaign.3.mission_1"]=16]="campaign.3.mission_1",e[e["campaign.3.mission_2"]=17]="campaign.3.mission_2",e[e["campaign.3.mission_3"]=18]="campaign.3.mission_3",e[e["campaign.3.mission_4"]=19]="campaign.3.mission_4",e[e["campaign.4.mission_0"]=20]="campaign.4.mission_0",e[e["campaign.4.mission_1"]=21]="campaign.4.mission_1",e[e["campaign.4.mission_2"]=22]="campaign.4.mission_2",e[e["campaign.4.mission_3"]=23]="campaign.4.mission_3",e[e["campaign.4.mission_4"]=24]="campaign.4.mission_4",e[e["campaign.5.mission_0"]=25]="campaign.5.mission_0",e[e["campaign.5.mission_1"]=26]="campaign.5.mission_1",e[e["campaign.5.mission_2"]=27]="campaign.5.mission_2",e[e["campaign.5.mission_3"]=28]="campaign.5.mission_3",e[e["campaign.5.mission_4"]=29]="campaign.5.mission_4"}(X||(X={})),function(e){e[e["figure.unused"]=0]="figure.unused",e[e["figure.infantry"]=1]="figure.infantry",e[e["figure.cavalry"]=2]="figure.cavalry",e[e["figure.musketeer"]=3]="figure.musketeer",e[e["figure.artiellery"]=4]="figure.artiellery"}(J||(J={})),function(e){e[e["good.empty"]=0]="good.empty",e[e["good.each"]=1]="good.each",e[e["good.iron_ore"]=2]="good.iron_ore",e[e["good.gold_ore"]=3]="good.gold_ore",e[e["good.wool"]=4]="good.wool",e[e["good.sugarcane"]=5]="good.sugarcane",e[e["good.tobacco"]=6]="good.tobacco",e[e["good.cattle"]=7]="good.cattle",e[e["good.grain"]=8]="good.grain",e[e["good.flour"]=9]="good.flour",e[e["good.iron"]=10]="good.iron",e[e["good.swords"]=11]="good.swords",e[e["good.muskets"]=12]="good.muskets",e[e["good.cannons"]=13]="good.cannons",e[e["good.food"]=14]="good.food",e[e["good.tobacco_products"]=15]="good.tobacco_products",e[e["good.spices"]=16]="good.spices",e[e["good.cocoa"]=17]="good.cocoa",e[e["good.liquor"]=18]="good.liquor",e[e["good.cloth"]=19]="good.cloth",e[e["good.clothes"]=20]="good.clothes",e[e["good.jewlry"]=21]="good.jewlry",e[e["good.tools"]=22]="good.tools",e[e["good.wood"]=23]="good.wood",e[e["good.bricks"]=24]="good.bricks"}($||($={})),function(e){e[e["rohst.grain"]=0]="rohst.grain",e[e["rohst.tobacco"]=1]="rohst.tobacco",e[e["rohst.spices"]=2]="rohst.spices",e[e["rohst.sugarcane"]=3]="rohst.sugarcane",e[e["rohst.cotton"]=4]="rohst.cotton",e[e["rohst.vines"]=5]="rohst.vines",e[e["rohst.cocoa"]=6]="rohst.cocoa",e[e["rohst.grazing_land"]=7]="rohst.grazing_land",e[e["rohst.tree"]=8]="rohst.tree",e[e["rohst.stones"]=9]="rohst.stones",e[e["rohst.ores"]=10]="rohst.ores",e[e["rohst.wild_game"]=11]="rohst.wild_game",e[e["rohst.fish"]=12]="rohst.fish"}(Q||(Q={})),function(e){e[e["rohst_field.grain"]=0]="rohst_field.grain",e[e["rohst_field.tobacco"]=1]="rohst_field.tobacco",e[e["rohst_field.spices"]=2]="rohst_field.spices",e[e["rohst_field.sugarcane"]=3]="rohst_field.sugarcane",e[e["rohst_field.cotton"]=4]="rohst_field.cotton",e[e["rohst_field.vines"]=5]="rohst_field.vines",e[e["rohst_field.cocoa"]=6]="rohst_field.cocoa",e[e["rohst_field.grazing_land"]=7]="rohst_field.grazing_land",e[e["rohst_field.tree"]=8]="rohst_field.tree",e[e["rohst_field.stones"]=9]="rohst_field.stones",e[e["rohst_field.ores"]=10]="rohst_field.ores",e[e["rohst_field.wild_game"]=11]="rohst_field.wild_game",e[e["rohst_field.fish"]=12]="rohst_field.fish"}(ee||(ee={})),function(e){e[e["buildings.military.wooden.wall"]=0]="buildings.military.wooden.wall",e[e["buildings.military.wooden.gate"]=1]="buildings.military.wooden.gate",e[e["buildings.military.wooden.watchtower"]=2]="buildings.military.wooden.watchtower",e[e["buildings.military.stone.wall"]=3]="buildings.military.stone.wall",e[e["buildings.military.stone.gate"]=4]="buildings.military.stone.gate",e[e["buildings.military.stone.watchtower"]=5]="buildings.military.stone.watchtower",e[e["buildings.military.stone.gate_big"]=6]="buildings.military.stone.gate_big",e[e["buildings.military.castle.small"]=7]="buildings.military.castle.small",e[e["buildings.military.castle.medium"]=8]="buildings.military.castle.medium",e[e["buildings.military.castle.large"]=9]="buildings.military.castle.large"}(te||(te={})),function(e){e[e["buildings.house.house"]=0]="buildings.house.house"}(ne||(ne={})),function(e){e[e["buildings.street.dirt.street"]=0]="buildings.street.dirt.street",e[e["buildings.street.stone.street"]=1]="buildings.street.stone.street",e[e["buildings.street.dirt.bridge"]=2]="buildings.street.dirt.bridge",e[e["buildings.street.stone.bridge"]=3]="buildings.street.stone.bridge",e[e["buildings.street.square.0"]=4]="buildings.street.square.0",e[e["buildings.street.square.1"]=5]="buildings.street.square.1",e[e["buildings.street.square.2"]=6]="buildings.street.square.2",e[e["buildings.street.square.3"]=7]="buildings.street.square.3"}(re||(re={})),function(e){e[e["buildings.mine.quarry"]=0]="buildings.mine.quarry",e[e["buildings.mine.iron"]=1]="buildings.mine.iron",e[e["buildings.mine.iron_deep"]=2]="buildings.mine.iron_deep",e[e["buildings.mine.gold"]=3]="buildings.mine.gold"}(ie||(ie={})),function(e){e[e["buildings.production.weaver"]=0]="buildings.production.weaver",e[e["buildings.production.butcher"]=1]="buildings.production.butcher",e[e["buildings.production.flour_mill"]=2]="buildings.production.flour_mill",e[e["buildings.production.bakery"]=3]="buildings.production.bakery",e[e["buildings.production.tobacco"]=4]="buildings.production.tobacco",e[e["buildings.production.distillery"]=5]="buildings.production.distillery",e[e["buildings.production.tailor"]=6]="buildings.production.tailor",e[e["buildings.production.weaving_mill"]=7]="buildings.production.weaving_mill",e[e["buildings.production.stonemason"]=8]="buildings.production.stonemason",e[e["buildings.production.water_mill"]=9]="buildings.production.water_mill",e[e["buildings.production.ore_smelter"]=10]="buildings.production.ore_smelter",e[e["buildings.production.tool_maker"]=11]="buildings.production.tool_maker",e[e["buildings.production.gold_smith"]=12]="buildings.production.gold_smith",e[e["buildings.production.armourer"]=13]="buildings.production.armourer",e[e["buildings.production.musket_maker"]=14]="buildings.production.musket_maker",e[e["buildings.production.canon_foundry"]=15]="buildings.production.canon_foundry"}(ae||(ae={})),function(e){e[e["buildings.farm.hunter"]=0]="buildings.farm.hunter",e[e["buildings.farm.forester"]=1]="buildings.farm.forester",e[e["buildings.field.forest"]=2]="buildings.field.forest",e[e["buildings.farm.grain"]=3]="buildings.farm.grain",e[e["buildings.field.grain"]=4]="buildings.field.grain",e[e["buildings.farm.sheep"]=5]="buildings.farm.sheep",e[e["buildings.farm.cattle"]=6]="buildings.farm.cattle",e[e["buildings.farm.tobacco"]=7]="buildings.farm.tobacco",e[e["buildings.field.tobacco"]=8]="buildings.field.tobacco",e[e["buildings.farm.spice"]=9]="buildings.farm.spice",e[e["buildings.field.spice"]=10]="buildings.field.spice",e[e["buildings.farm.wine"]=11]="buildings.farm.wine",e[e["buildings.field.wine"]=12]="buildings.field.wine",e[e["buildings.farm.sugarcane"]=13]="buildings.farm.sugarcane",e[e["buildings.field.sugarcane"]=14]="buildings.field.sugarcane",e[e["buildings.farm.cotton"]=15]="buildings.farm.cotton",e[e["buildings.field.cotton"]=16]="buildings.field.cotton",e[e["buildings.farm.cocoa"]=17]="buildings.farm.cocoa",e[e["buildings.field.cocoa"]=18]="buildings.field.cocoa"}(oe||(oe={})),function(e){e[e["buildings.docks.warehouse.0"]=0]="buildings.docks.warehouse.0",e[e["buildings.docks.warehouse.1"]=1]="buildings.docks.warehouse.1",e[e["buildings.docks.warehouse.2"]=2]="buildings.docks.warehouse.2",e[e["buildings.docks.warehouse.3"]=3]="buildings.docks.warehouse.3",e[e["buildings.docks.fisher"]=4]="buildings.docks.fisher",e[e["buildings.docks.dock"]=5]="buildings.docks.dock",e[e["buildings.docks.shipyard.small"]=6]="buildings.docks.shipyard.small",e[e["buildings.docks.shipyard.large"]=7]="buildings.docks.shipyard.large"}(se||(se={})),function(e){e[e["buildings.public.house"]=0]="buildings.public.house",e[e["buildings.public.marketplace"]=1]="buildings.public.marketplace",e[e["buildings.public.chapel"]=2]="buildings.public.chapel",e[e["buildings.public.church"]=3]="buildings.public.church",e[e["buildings.public.cathedral"]=4]="buildings.public.cathedral",e[e["buildings.public.tavern"]=5]="buildings.public.tavern",e[e["buildings.public.doctor"]=6]="buildings.public.doctor",e[e["buildings.public.school"]=7]="buildings.public.school",e[e["buildings.public.college"]=8]="buildings.public.college",e[e["buildings.public.bathhouse"]=9]="buildings.public.bathhouse",e[e["buildings.public.theater"]=10]="buildings.public.theater",e[e["buildings.public.firefighters"]=11]="buildings.public.firefighters",e[e["buildings.public.palace"]=12]="buildings.public.palace",e[e["buildings.public.gallows"]=13]="buildings.public.gallows",e[e["buildings.public.monument"]=14]="buildings.public.monument",e[e["buildings.public.triumphal_arch"]=15]="buildings.public.triumphal_arch"}(ue||(ue={})),function(e){e[e.demolish=0]="demolish"}(ce||(ce={})),function(e){e[e["natives.0.head_lodge"]=0]="natives.0.head_lodge",e[e["natives.0.hut.0"]=1]="natives.0.hut.0",e[e["natives.0.hut.1"]=2]="natives.0.hut.1",e[e["natives.0.hut.2"]=3]="natives.0.hut.2",e[e["natives.0.hut.3"]=4]="natives.0.hut.3",e[e["natives.1.head_lodge"]=5]="natives.1.head_lodge",e[e["natives.1.hut.0"]=6]="natives.1.hut.0",e[e["natives.1.hut.1"]=7]="natives.1.hut.1",e[e["natives.1.hut.2"]=8]="natives.1.hut.2",e[e["natives.1.hut.3"]=9]="natives.1.hut.3",e[e["natives.pyramid"]=10]="natives.pyramid",e[e["pirates.warehouse"]=11]="pirates.warehouse",e[e["pirates.1"]=12]="pirates.1",e[e["pirates.2"]=13]="pirates.2",e[e["pirates.tower"]=14]="pirates.tower",e[e["forest.mixed"]=15]="forest.mixed",e[e["forest.palm"]=16]="forest.palm"}(le||(le={}));var fe,he={GAME:U,LEISTE:W,PATH:V,ENDLESSKIND:q,PLAYCOL:K,VIDEOKIND:z,SPEECHKIND:Z,TUTORKIND:Y,KAMPAGNE:X,FIGKIND:J,WARE:$,ROHST:Q,ROHSTFELD:ee,MILITAR:te,WOHNHAUS:ne,STRASSE:re,BERGWERK:ie,HANDWERK:ae,FARM:oe,HAFEN:se,DIVERS:ue,ABRISS:ce,LANDSCHAFT:le},pe=[{type:"MILITAR",ids:[22521,21404,21405,22501,20304,20305,20303,20311,20313,20315],iconOffset:86},{type:"HANDWERK",ids:[20507,20511,20501,20503,20525,20519,20505,20531,20513,20509,20521,20515,20533,20517,20529,20527],iconOffset:108},{type:"FARM",ids:[22003,22001,21303,21503,21301,21515,21513,21507,21335,21501,21341,21517,21343,21511,21339,21505,21331,21509,21337],iconOffset:125},{type:"BERGWERK",ids:[22407,22401,22403,22405],iconOffset:104},{type:"HAFEN",ids:[22101,22103,22105,22107,21075,21073,22115,22111],iconOffset:144},{type:"STRASSE",ids:[20411,20401,21601,21603,20421,20422,20423,20424],iconOffset:96},{type:"DIVERS",ids:[20605,20809,20803,20805,20801,20807,20817,20821,20819,20813,20815,20811,20831,20841,20851,20853],iconOffset:152}];function me(e){var t=!0,n=!1,r=void 0;try{for(var i,a=pe[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)for(var o=i.value,s=0;s<o.ids.length;s++){if(o.ids[s]===e)return o.iconOffset+s}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}throw new Error("Could not find icon offset for ".concat(e,"."))}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.None=0]="None",e[e.Sell=1]="Sell",e[e.Buy=2]="Buy"}(fe||(fe={}));var ve=function(){var e,t,n;function r(e,t,n,i,a,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.goodId=e,this.sellingPrice=t,this.buyingPrice=n,this.wantedSellingAmount=i,this.wantedBuyingAmount=a,this.currentAmount=o,this.action=s}return e=r,n=[{key:"fromSaveGame",value:function(e,t){var n=e.read32(),i=(1023&n)>>0,a=(1047552&n)>>10,o=(4293918720&n)>>20;Object(g.a)(o>=0&&o<=2),e.read32();var s=e.read16(),u=e.read16(),c=e.read16(),l=(e.read16(),e.read16());return e.read16(),new r(void 0!==t?t:l,i,a,s,u,c,o)}}],(t=null)&&ge(e.prototype,t),n&&ge(e,n),r}();function ye(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function be(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){ye(a,r,i,o,s,"next",e)}function s(e){ye(a,r,i,o,s,"throw",e)}o(void 0)}))}}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(){return new a.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792})}var ke=function(){function e(t,n,r,i,o){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.menuRenderer=n,this.translator=r,this.spriteLoader=i,this.sidebar=new a.Container,this.sidebarDetails=new a.Container,this.topBar=new a.Container,this.bottomBar=new a.Container,this.debugArea=new a.Container,this.money=xe(),this.coordinates=xe(),this.islandNumber=xe(),this.producerInfo=xe(),this.simulationSpeedDisplay=xe(),this.infoModel=void 0,this.ctrlModel=void 0,this.toolsTextures=void 0,this.WARE_ICON_OFFSET=192,this.setMoney=function(e){s.money.text="Money: ".concat(e)},this.setOperatingCosts=function(e){s.infoModel.setOperatingCosts(e)},this.setStatusAreaContent=function(){var e=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="status"===e.t0?3:"city-list"===e.t0?6:"ship-list"===e.t0?9:"diplomacy"===e.t0?12:15;break;case 3:return e.next=5,s.menuRenderer.renderScreen(s.sidebarDetails,"INFO.GAD",s.infoModel);case 5:return e.abrupt("break",16);case 6:return e.next=8,s.menuRenderer.renderScreen(s.sidebarDetails,"STADTLST.GAD");case 8:return e.abrupt("break",16);case 9:return e.next=11,s.menuRenderer.renderScreen(s.sidebarDetails,"SHIPLIST.GAD");case 11:return e.abrupt("break",16);case 12:return e.next=14,s.menuRenderer.renderScreen(s.sidebarDetails,"VERTRAG.GAD");case 14:return e.abrupt("break",16);case 15:Object(R.a)(t);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setSidebarActiveTab=function(){var e=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="build"===e.t0?3:"battle"===e.t0?6:"status"===e.t0?8:"options"===e.t0?11:14;break;case 3:return e.next=5,s.menuRenderer.renderScreen(s.sidebarDetails,"BAU.GAD");case 5:return e.abrupt("break",15);case 6:return s.sidebarDetails.removeChildren(),e.abrupt("break",15);case 8:return e.next=10,s.menuRenderer.renderScreen(s.sidebarDetails,"INFO.GAD",s.infoModel);case 10:return e.abrupt("break",15);case 11:return e.next=13,s.menuRenderer.renderScreen(s.sidebarDetails,"OPTION.GAD",{onLoad:function(){},buttons:{},texts:{47002:s.translator.translate("game.settings"),47031:"640x480",47032:"800x600",47033:"1024x768"},ignore:[]});case 13:return e.abrupt("break",15);case 14:Object(R.a)(t);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.infoModel=new H(this,r),this.ctrlModel=new de(t,this),this.money.y=0,this.coordinates.y=30,this.islandNumber.y=60,this.producerInfo.y=90,this.simulationSpeedDisplay.y=150,this.debugArea.addChild(this.money),this.debugArea.addChild(this.coordinates),this.debugArea.addChild(this.islandNumber),this.debugArea.addChild(this.producerInfo),this.debugArea.addChild(this.simulationSpeedDisplay),o.addChild(this.sidebar),o.addChild(this.sidebarDetails),o.addChild(this.topBar),o.addChild(this.bottomBar),o.addChild(this.debugArea)}var t,n,r,i,o,s,u,c,l,d,f,h;return t=e,(n=[{key:"begin",value:(h=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.spriteLoader.getTextures("TOOLS/TOOLS");case 2:return this.toolsTextures=e.sent,e.next=5,this.menuRenderer.renderScreen(this.sidebar,"CTRL.GAD",this.ctrlModel);case 5:return e.next=7,this.menuRenderer.renderScreen(this.bottomBar,"LEIST.GAD");case 7:return e.next=9,this.setSidebarActiveTab("status");case 9:this.setSize(t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"isObscuredByHud",value:function(e){return this.sidebar.getBounds().contains(e.x,e.y)||this.bottomBar.getBounds().contains(e.x,e.y)}},{key:"setSize",value:function(e){this.sidebar.position.x=e.x-271,this.sidebarDetails.position.copyFrom(this.sidebar.position),this.bottomBar.position.y=e.y-35}},{key:"setSimulationSpeed",value:function(e){this.simulationSpeedDisplay.text="Simulation speed: ".concat(e,".")}},{key:"showProducer",value:(f=be(regeneratorRuntime.mark((function e(t,n,r,i,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.production.kind!==ze.FISCHEREI&&a.production.kind!==ze.JAGDHAUS&&a.production.kind!==ze.PLANTAGE&&a.production.kind!==ze.WEIDETIER){e.next=5;break}return e.next=3,this.showProducerFarm(t,r,i,a);case 3:e.next=18;break;case 5:if(a.production.kind!==ze.HANDWERK){e.next=10;break}return e.next=8,this.showProducerHandwerk(t,r,i,a);case 8:e.next=18;break;case 10:if(a.production.kind!==ze.BERGWERK){e.next=15;break}return e.next=13,this.showProducerMine(t,r,i,a);case 13:e.next=18;break;case 15:if(a.production.kind!==ze.KIRCHE&&a.production.kind!==ze.KAPELLE&&a.production.kind!==ze.WIRT&&a.production.kind!==ze.THEATER&&a.production.kind!==ze.BADEHAUS&&a.production.kind!==ze.KLINIK&&a.production.kind!==ze.HOCHSCHULE&&a.production.kind!==ze.SCHULE&&a.production.kind!==ze.BRUNNEN&&a.production.kind!==ze.SCHLOSS&&a.production.kind!==ze.GALGEN){e.next=18;break}return e.next=18,this.showProducerPublicBuilding(t,r,i,a);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i){return f.apply(this,arguments)})},{key:"showHouse",value:(d=be(regeneratorRuntime.mark((function e(t,n,r,i,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(g.a)(a.production.kind===ze.WOHNUNG),e.next=3,this.menuRenderer.renderScreen(this.sidebarDetails,"SIEDLER.GAD",{texts:{36002:r.name,36012:"???",36011:this.translator.translate("game.tax").replace("%d",(r.taxes[t.inhabitantLevel]>>2).toString()).replace("%%","%"),36014:this.translator.populationLevelName(t.inhabitantLevel),36013:r.inhabitants[t.inhabitantLevel].toString(),36019:this.translator.translate("game.food")},buttons:{},ignore:[],onLoad:function(){}});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i){return d.apply(this,arguments)})},{key:"showKontor",value:(l=be(regeneratorRuntime.mark((function e(t,n,r,i,a){var o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(g.a)(a.production.kind===ze.KONTOR),o=a.production.maxStock+0,e.next=4,this.menuRenderer.renderScreen(this.sidebarDetails,"STADT.GAD",{buttons:{43003:function(e){return s.menuRenderer.renderScreen(e,"KONTOR.GAD",{buttons:{},texts:{},ignore:[],onLoad:function(){}})},43004:function(e){return s.menuRenderer.renderScreen(e,"KONTOR.GAD",{buttons:{},texts:{},ignore:[],onLoad:function(){}})},43006:function(){var e=be(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=8,s.menuRenderer.renderScreen(n,"LAGER.GAD",{buttons:{},texts:{44002:r.name},ignore:[44171,44044,44074,44134,44164,44104],onLoad:function(){var e=be(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.goods.map(function(){var e=be(regeneratorRuntime.mark((function e(t,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.getChildByName("menu-".concat(44021+r)).texture=s.toolsTextures.get(s.WARE_ICON_OFFSET+t.goodId),i=n.getChildByName("menu-".concat(44141+r)),a=n.getChildByName("menu-".concat(44111+r)),t.action===fe.None&&(i.visible=!1,a.visible=!1),n.getChildByName("menu-".concat(44051+r)).setValue(Math.min(1,(t.currentAmount>>5)/o));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},ignore:[43005],texts:{43002:r.name,43007:this.translator.translate("game.inhabitants"),43008:r.inhabitants.reduce((function(e,t){return e+t})).toString(),43010:this.translator.translate("game.tax_revenue"),43013:this.translator.translate("game.operating_cost"),43016:this.translator.translate("game.sales_revenue"),43019:this.translator.translate("game.purchase_cost"),43022:this.translator.translate("game.balance_sheet")},onLoad:function(){}});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i){return l.apply(this,arguments)})},{key:"showProducerFarm",value:(c=be(regeneratorRuntime.mark((function e(t,n,r,i){var a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.menuRenderer.renderScreen(this.sidebarDetails,"PLANTAGE.GAD",{buttons:{41009:function(e,n){return t.setActive(!n)},41010:function(e,n){return t.setGoodsAllowedForPickup(!n)}},texts:{41002:n.name,41003:this.translator.translate("game.workload"),41004:this.translator.translate("game.n_percent").replace("%d","???").replace("%%","%"),41005:this.translator.translate("game.operating_cost"),41006:t.isActive()?i.production.upkeep.active.toString():i.production.upkeep.inactive.toString(),41008:this.translator.getFieldName(r.fieldId),41022:this.translator.translate("game.n_tons").replace("%d",(t.stock>>5).toString())},ignore:[],onLoad:function(){var e=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getChildByName("menu-41021").texture=a.toolsTextures.get(a.WARE_ICON_OFFSET+i.production.good);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return c.apply(this,arguments)})},{key:"showProducerPublicBuilding",value:(u=be(regeneratorRuntime.mark((function e(t,n,r,i){var a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={62002:n.name,62003:this.translator.translate("game.operating_cost"),62004:t.isActive()?i.production.upkeep.active.toString():i.production.upkeep.inactive.toString(),62006:this.translator.getFieldName(r.fieldId)},e.next=3,this.menuRenderer.renderScreen(this.sidebarDetails,"INFRA.GAD",{buttons:{},texts:a,ignore:[],onLoad:function(){var e=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getChildByName("menu-62021").texture=o.toolsTextures.get(me(r.fieldId));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return u.apply(this,arguments)})},{key:"showProducerMine",value:(s=be(regeneratorRuntime.mark((function e(t,n,r,i){var a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={46002:n.name,46003:this.translator.translate("game.operating_cost"),46004:t.isActive()?i.production.upkeep.active.toString():i.production.upkeep.inactive.toString(),46006:this.translator.getFieldName(r.fieldId),46022:this.translator.translate("game.n_tons").replace("%d",(t.stock>>5).toString())},e.next=3,this.menuRenderer.renderScreen(this.sidebarDetails,"BERGWERK.GAD",{buttons:{46009:function(e,n){return t.setActive(!n)},46010:function(e,n){return t.setGoodsAllowedForPickup(!n)}},texts:a,ignore:[],onLoad:function(){var e=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getChildByName("menu-46021").texture=o.toolsTextures.get(o.WARE_ICON_OFFSET+i.production.good);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return s.apply(this,arguments)})},{key:"showProducerShipyard",value:(o=be(regeneratorRuntime.mark((function e(t,n,r,i){var a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={41002:n.name,41003:this.translator.translate("game.workload"),41004:this.translator.translate("game.n_percent").replace("%d","???").replace("%%","%"),41005:this.translator.translate("game.operating_cost"),41006:t.isActive()?i.production.upkeep.active.toString():i.production.upkeep.inactive.toString(),41008:this.translator.getFieldName(r.fieldId),41022:this.translator.translate("game.n_tons").replace("%d",(t.stock>>5).toString())},e.next=3,this.menuRenderer.renderScreen(this.sidebarDetails,"WERFT.GAD",{buttons:{41009:function(e,n){return t.setActive(!n)},41010:function(e,n){return t.setGoodsAllowedForPickup(!n)}},texts:a,ignore:[],onLoad:function(){var e=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getChildByName("menu-41021").texture=o.toolsTextures.get(o.WARE_ICON_OFFSET+i.production.good);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"showProducerHandwerk",value:(i=be(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.production.good2,o={37002:n.name,37003:this.translator.translate("game.workload"),37004:this.translator.translate("game.n_percent").replace("%d","???").replace("%%","%"),37005:this.translator.translate("game.operating_cost"),37006:t.isActive()?i.production.upkeep.active.toString():i.production.upkeep.inactive.toString(),37008:this.translator.getFieldName(r.fieldId)},s=[],a?(o[37032]=this.translator.translate("game.n_tons").replace("%d",(t.secondGoodStock>>5).toString()),o[37036]=this.translator.translate("game.n_tons").replace("%d",(t.firstGoodStock>>5).toString()),o[37040]=this.translator.translate("game.n_tons").replace("%d",(t.stock>>5).toString()),s.push.apply(s,[37021,37022,37023,37024,37025,37026,37027])):(o[37022]=this.translator.translate("game.n_tons").replace("%d",(t.firstGoodStock>>5).toString()),o[37026]=this.translator.translate("game.n_tons").replace("%d",(t.stock>>5).toString()),s.push.apply(s,[37031,37032,37033,37034,37035,37036,37037,37038,37039,37040,37041])),e.next=6,this.menuRenderer.renderScreen(this.sidebarDetails,"PROD.GAD",{buttons:{37009:function(e,n){return t.setActive(!n)},37010:function(e,n){return t.setGoodsAllowedForPickup(!n)}},texts:o,ignore:s,onLoad:function(){var e=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a?(t.getChildByName("menu-37035").texture=u.toolsTextures.get(u.WARE_ICON_OFFSET+i.production.good1),t.getChildByName("menu-37031").texture=u.toolsTextures.get(u.WARE_ICON_OFFSET+i.production.good2),t.getChildByName("menu-37039").texture=u.toolsTextures.get(u.WARE_ICON_OFFSET+i.production.good)):(t.getChildByName("menu-37021").texture=u.toolsTextures.get(u.WARE_ICON_OFFSET+i.production.good1),t.getChildByName("menu-37025").texture=u.toolsTextures.get(u.WARE_ICON_OFFSET+i.production.good));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"setHoveredPosition",value:function(e,t,n){if(this.coordinates.text="Land: ".concat(e.x," ; ").concat(e.y," | Sea: ").concat(t.x," ; ").concat(t.y),n){var r=new a.Point(e.x-n.position.x,e.y-n.position.y);this.islandNumber.text="Island id: ".concat(n.id,", x: ").concat(r.x," y: ").concat(r.y)}else this.islandNumber.text="Island id: ?"}}])&&we(t.prototype,n),r&&we(t,r),e}();function Ee(e){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e,t){return!t||"object"!==Ee(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ae(e){return(Ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Oe=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"none";Se(this,t),(e=_e(this,Ae(t).call(this))).debug=n,e.lastParentWorldID=-1,e.GRID_WIDTH=(Ue+We)/2,e.GRID_HEIGHT=Ue+We-1,e.grid=new Array(e.GRID_WIDTH*e.GRID_HEIGHT),e.entities=Array.from({length:32*e.GRID_HEIGHT/2},(function(e){return new Set})),e.debugGrid=new Array(e.GRID_WIDTH*e.GRID_HEIGHT),e.topLeft=new a.Point(0,0),e.bottomRight=new a.Point(0,0),e.fieldRangesFrom=new Array(e.GRID_HEIGHT),e.fieldRangesTo=new Array(e.GRID_HEIGHT),window.grid=e.grid,console.debug("grid length",e.grid.length),console.debug("entities length",e.entities.length);for(var r=0;r<e.GRID_HEIGHT;++r){var i=t.fieldRangeInGridRow(r),o=i.from,s=i.to;e.fieldRangesFrom[r]=o,e.fieldRangesTo[r]=s}var u=new a.Graphics;u.lineStyle(.5,16711680,.5).moveTo(0,-16).lineTo(32,-32).lineTo(64,-16).lineTo(32,0).lineTo(0,-16);var c=new a.Graphics;if(c.lineStyle(.5,65280,.5).moveTo(0,-16).lineTo(32,-32).lineTo(64,-16).lineTo(32,0).lineTo(0,-16),"none"!==e.debug){for(var l=0;l<e.GRID_HEIGHT;++l){var d=t.fieldRangeInGridRow(l),f=d.from,h=d.to,p=c.clone(),m=t.gridToScreen(f,l),g=m.screenX,v=m.screenY;p.position.set(g,v),e.addChild(p);var y=c.clone(),b=t.gridToScreen(h,l),w=b.screenX,x=b.screenY;y.position.set(w,x),e.addChild(y);for(var k={x:297,y:326},E=0;E<e.GRID_WIDTH;++E)if("grid-border"!==n||!(Math.abs(k.x-E)>10||Math.abs(k.y-l)>10)){var S=E+l*e.GRID_WIDTH,R=t.gridToScreen(E,l),_=R.screenX,A=R.screenY,I=t.gridToIso(E,l),O=I.isoX,T=I.isoY,P=new a.Container,C=u.clone();P.addChild(C);var N=new a.Text("".concat(E," | ").concat(l,"\n").concat(O," | ").concat(T),{fontFamily:"Arial",fontSize:16,fill:16776960,align:"center"});N.scale.set(.5,.5),N.position.set(32,-16),N.anchor.set(.5,.5),P.addChild(N),P.position.set(_,A+-20),e.debugGrid[S]=P,e.add(P)}}var G=new a.Graphics;G.lineStyle(.5,16711680,.5).moveTo(0,0).lineTo(2e4,0),e.addChild(G);var D=new a.Graphics;D.lineStyle(.5,16711680,.5).moveTo(0,0).lineTo(0,2e4),e.addChild(D)}return e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(t,e),n=t,i=[{key:"isoToGrid",value:function(e,t){var n=e+t;return{x:Math.floor((e-t)/2)+We/2+(n%2==0?-1:0),y:n}}},{key:"gridToScreen",value:function(e,t){return{screenX:64*e-t%2*64/2-64*(We/2-1),screenY:32*t/2}}},{key:"gridToIso",value:function(e,n){var r=t.gridToScreen(e,n),i=r.screenX,o=r.screenY,s=Ze.worldPosToFieldPos(new a.Point(i,o));return{isoX:s.x,isoY:s.y-1}}},{key:"fieldRangeInGridRow",value:function(e){var t=Math.abs(We/2-1-Math.floor((e+(e>=We?-1:0))/2));return{from:t,to:e<We?t+e:e<Ue?t+We-1:t+We-1-(e-Ue+1)}}}],(r=[{key:"sortChildren",value:function(){throw new Error("Sorting children not supported.")}},{key:"updateTransform",value:function(){console.assert(this.transform._localID===this.transform._currentLocalID),a.Container.prototype.updateTransform.call(this);var e=this.parent.transform._worldID;if(e!==this.lastParentWorldID){var n=this.parent.getVisibleBounds(),r=Ze.worldPosToFieldPos(new a.Point(n.x-64,n.y-32)),i=Ze.worldPosToFieldPos(new a.Point(n.x+n.width+64,n.y+n.height+32+200)),o=t.isoToGrid(r.x,r.y),s=t.isoToGrid(i.x,i.y);this.topLeft.x=Math.max(o.x,0),this.topLeft.y=Math.max(o.y,0),this.bottomRight.x=Math.min(s.x,this.GRID_WIDTH-1),this.bottomRight.y=Math.min(s.y,this.GRID_HEIGHT-1);for(var u=this.topLeft.y;u<=this.bottomRight.y;++u){this.updateEntitiesTransform(u);for(var c=this.topLeft.x;c<=this.bottomRight.x;++c){var l=c+u*this.GRID_WIDTH,d=this.grid[l];d&&d.updateTransform()}}if("none"!==this.debug)for(var f=this.topLeft.y;f<=this.bottomRight.y;++f)for(var h=this.topLeft.x;h<=this.bottomRight.x;++h){var p=h+f*this.GRID_WIDTH,m=this.debugGrid[p];m&&m.updateTransform()}this.lastParentWorldID=e}}},{key:"addField",value:function(e,n,r){var i=t.isoToGrid(n,r),a=i.x+i.y*this.GRID_WIDTH;console.assert(void 0===this.grid[a]),this.grid[a]=e,this.add(e)}},{key:"addEntity",value:function(e,t){if(Math.round(t)!==t)throw new Error("y must be an integer, got ".concat(t,"."));this.entities[t+32].add(e),this.add(e)}},{key:"changeEntityY",value:function(e,t,n){if(Math.round(t)!==t)throw new Error("oldY must be an integer, got ".concat(t,"."));if(Math.round(n)!==n)throw new Error("newY must be an integer, got ".concat(n,"."));console.assert(this.entities[t+32].has(e)),this.entities[t+32].delete(e),this.entities[n+32].add(e),e.updateTransform()}},{key:"replaceEntity",value:function(e,t,n){if(Math.round(n)!==n)throw new Error("y must be an integer, got ".concat(n,"."));console.assert(this.entities[n+32].has(e)),this.entities[n+32].delete(e),this.remove(e),this.entities[n+32].add(t),this.add(t),t.updateTransform()}},{key:"add",value:function(e){e.parent&&e.parent.removeChild(e),e.parent=this,e.transform._parentID=-1,this._boundsID++}},{key:"remove",value:function(e){e.parent=null,e.transform._parentID=-1,this._boundsID++}},{key:"renderEntities",value:function(e,t){if(!(t<2||t>=this.GRID_HEIGHT))for(var n=32*t/2-20+16,r=0;r<16;r++){var i=this.entities[n+r],a=!0,o=!1,s=void 0;try{for(var u,c=i[Symbol.iterator]();!(a=(u=c.next()).done);a=!0)u.value.render(e)}catch(e){o=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}}}},{key:"updateEntitiesTransform",value:function(e){if(!(e<2||e>=this.GRID_HEIGHT))for(var t=0;t<16;t++){var n=this.entities[t+32*e/2+-20],r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value.updateTransform()}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"render",value:function(e){for(var t=this.topLeft.y;t<=this.bottomRight.y;++t){for(var n=Math.max(this.topLeft.x,this.fieldRangesFrom[t]),r=Math.min(this.bottomRight.x,this.fieldRangesTo[t]),i=n;i<=r;++i)this.grid[i+t*this.GRID_WIDTH]._render(e);this.renderEntities(e,t)}if("none"!==this.debug)for(var a=this.topLeft.y;a<=this.bottomRight.y;++a)for(var o=this.topLeft.x;o<=this.bottomRight.x;++o){var s=o+a*this.GRID_WIDTH,u=this.debugGrid[s];u&&u.render(e)}for(var c=0,l=this.children.length;c<l;++c)this.children[c].render(e)}}])&&Re(n.prototype,r),i&&Re(n,i),t}(a.Container);function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ce(e,t){return!t||"object"!==Te(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ge(e,t){return(Ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var De=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ce(this,Ne(t).call(this))).isEnabled=!1,e._pressedKeys=new Set,e._releasedKeys=new Set,e._downKeys=new Set,e._preventDefaultKeys={},e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ge(e,t)}(t,e),n=t,(r=[{key:"enable",value:function(){this.isEnabled||(this.isEnabled=!0,this._enableEvents())}},{key:"_enableEvents",value:function(){window.addEventListener("keydown",this._onKeyDown.bind(this),!0),window.addEventListener("keyup",this._onKeyUp.bind(this),!0)}},{key:"disable",value:function(){this.isEnabled&&(this.isEnabled=!1,this._disableEvents())}},{key:"_disableEvents",value:function(){window.removeEventListener("keydown",this._onKeyDown,!0),window.removeEventListener("keyup",this._onKeyUp,!0)}},{key:"setPreventDefault",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Array.isArray(e))for(var n=0;n<e.length;n++)this._preventDefaultKeys[e[n]]=t;else this._preventDefaultKeys[e]=t}},{key:"_onKeyDown",value:function(e){var t=e.which||e.keyCode;this._preventDefaultKeys[t]&&e.preventDefault(),this.isDown(t)||(this._downKeys.add(t),this._pressedKeys.add(t),this.emit("pressed",t))}},{key:"_onKeyUp",value:function(e){var t=e.which||e.keyCode;this._preventDefaultKeys[t]&&e.preventDefault(),this.isDown(t)&&(this._pressedKeys.delete(t),this._releasedKeys.delete(t),this._downKeys.delete(t),this.emit("released",t))}},{key:"onKeyPressedWithPreventDefault",value:function(e,t){this.onKeysPressedWithPreventDefault([e],t)}},{key:"onKeysPressedWithPreventDefault",value:function(e,t){var n=this;this.setPreventDefault(e),this.on("pressed",(function(){e.every((function(e){return n.isPressed(e)}))&&t()}))}},{key:"isDown",value:function(e){return this._downKeys.has(e)}},{key:"isPressed",value:function(e){return this._pressedKeys.has(e)}},{key:"isReleased",value:function(e){return this._releasedKeys.has(e)}},{key:"update",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this._downKeys[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;this.emit("down",a)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this._pressedKeys.clear(),this._releasedKeys.clear()}}])&&Pe(n.prototype,r),i&&Pe(n,i),t}(a.utils.EventEmitter),je={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,PAUSE:19,CTRL:17,ALT:18,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CMD:91,CMD_RIGHT:93,NUM_0:96,NUM_1:97,NUM_2:98,NUM_3:99,NUM_4:100,NUM_5:101,NUM_6:102,NUM_7:103,NUM_8:104,NUM_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222};function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Me(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Le(a,r,i,o,s,"next",e)}function s(e){Le(a,r,i,o,s,"throw",e)}o(void 0)}))}}function He(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Be(e,t,n){return t&&He(e.prototype,t),n&&He(e,n),e}var Ue=500,We=350;console.assert(Ue%2==0),console.assert(We%2==0);var Ke,ze,Ze=function(){function e(t,n,r,i,o,s,u,c,l,d){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.islandSpriteLoader=n,this.app=r,this.viewport=i,this.configLoader=o,this.animationRenderer=s,this.menuRenderer=u,this.spriteLoader=l,this.myPlayerId=d,this.WIDTH=Ue,this.HEIGHT=We,this.fields=void 0,this.keyboardManager=void 0,this.hud=void 0,this.interactionManager=void 0,this.fieldContainer=new Oe("none"),this.active=!1,this.showRadiusOfAllBuildings=!1,this.radiusSprites=[],this.keyboardManager=new De,this.setupHotKeys();var f=new a.Container;this.hud=new ke(this,this.menuRenderer,c,l,f),r.stage.addChild(f),this.interactionManager=this.app.renderer.plugins.interaction}var t,n;return Be(e,null,[{key:"fieldPosToWorldPos",value:function(e){var t=e.x,n=e.y,r=32*(t-n),i=16*(t+n);return new a.Point(r,i)}},{key:"landFieldPosToWorldPos",value:function(e){var t=this.fieldPosToWorldPos(e);return t.y+=-20,t}},{key:"worldPosToFieldPos",value:function(e){var t=e.x,n=e.y,r=(t/32+n/16)/2,i=(n/16-t/32)/2;return new a.Point(Math.round(r),Math.round(i)+1)}},{key:"worldPosToFieldPosLand",value:function(e){var t=new a.Point;return t.copyFrom(e),t.y-=-20,this.worldPosToFieldPos(t)}}]),Be(e,[{key:"begin",value:(n=Me(regeneratorRuntime.mark((function t(){var n,r,i,o,s,u,c,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.active){t.next=2;break}throw new Error("Cannot call .begin() twice!");case 2:return this.active=!0,this.viewport.removeChildren(),this.keyboardManager.enable(),this.app.ticker.add((function(){l.keyboardManager.update()})),t.next=8,this.hud.begin(new a.Point(this.viewport.screenWidth,this.viewport.screenHeight));case 8:return this.sendHoveredPositionsToHUD(),t.next=11,Promise.all(Object.values(this.game.state.islands).map((function(e){return l.islandSpriteLoader.getIslandSprites(e)})));case 11:n=t.sent,console.log("Map sprites loaded."),n.forEach((function(e){e.sprites.forEach((function(e){return e.filter((function(e){return null!==e})).forEach((function(e){return l.fieldContainer.addField(e.sprite,e.mapPosition.x,e.mapPosition.y)}))})),e.smokeSprites.forEach((function(e){l.fieldContainer.addEntity(e.sprite,e.y),e.sprite.play()}))})),console.log("Map sprites drawn."),r=Object(R.d)(this.WIDTH,this.HEIGHT),n.forEach((function(e){return e.sprites.forEach((function(e){return e.filter((function(e){return null!==e})).forEach((function(e){return r[e.mapPosition.x][e.mapPosition.y]=e.sprite}))}))})),i=null,o=0;case 19:if(!(o<this.WIDTH)||i){t.next=31;break}s=0;case 21:if(!(s<this.HEIGHT)){t.next=28;break}if(!r[o][s]){t.next=25;break}return i=r[o][s].texture,t.abrupt("break",28);case 25:s++,t.next=21;break;case 28:o++,t.next=19;break;case 31:return r.forEach((function(t,n){return t.forEach((function(t,o){if(null===t){var s=new a.Sprite(i),u=e.fieldPosToWorldPos(new a.Point(n,o)),c=u.x,d=u.y;s.anchor.set(0,1),s.x=c,s.y=d,r[n][o]=s,l.fieldContainer.addField(s,n,o)}}))})),this.fields=r,this.viewport.addChild(this.fieldContainer),t.next=36,this.renderShips();case 36:return this.moveCameraToStartPosition(this.myPlayerId),this.interactionManager.on("mouseup",Me(regeneratorRuntime.mark((function t(){var n,r,i,o,s,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=l.interactionManager.mouse.global,!l.hud.isObscuredByHud(n)){t.next=3;break}return t.abrupt("return");case 3:if(r=e.worldPosToFieldPosLand(l.viewport.toWorld(n)),i=Object.values(l.game.state.islands).find((function(e){return e.positionRect.contains(r.x,r.y)}))){t.next=7;break}return t.abrupt("return");case 7:if(o=new a.Point(r.x-i.position.x,r.y-i.position.y),!(s=l.findBuilding(l.game.state.kontors,i,o))){t.next=13;break}return t.next=12,l.hud.showKontor(s.building,i,s.city,s.field,s.config);case 12:return t.abrupt("return",t.sent);case 13:if(!(u=l.findBuilding(l.game.state.producers,i,o))){t.next=18;break}return t.next=17,l.hud.showProducer(u.building,i,u.city,u.field,u.config);case 17:return t.abrupt("return",t.sent);case 18:if(!(c=l.findBuilding(l.game.state.houses,i,o))){t.next=23;break}return t.next=22,l.hud.showHouse(c.building,i,c.city,c.field,c.config);case 22:return t.abrupt("return",t.sent);case 23:case"end":return t.stop()}}),t)})))),this.game.addListener("player/money",(function(e){var t=e.playerId,n=e.money;t===l.myPlayerId&&l.hud.setMoney(n)})),this.game.addListener("producer/good-produced",(function(e){var t=e.island,n=e.position,r=e.stock;l.onProduced(t,n,r)})),this.game.addListener("simulation-speed",(function(e){return l.hud.setSimulationSpeed(e)})),this.game.addListener("player/upkeep",(function(e){var t=e.playerId,n=e.upkeep;t===l.myPlayerId&&l.hud.setOperatingCosts(n)})),this.game.addListener("field/changed",function(){var e=Me(regeneratorRuntime.mark((function e(t){var n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("renderer: field changed",t),n=l.configLoader.getFieldData().get(t.fieldId),r=l.game.state.islands[t.islandId],i=new a.Point(r.position.x+t.x,r.position.y+t.y),e.t0=n,e.t1=t.playerId,e.t2=r.position,e.t3=i,e.t4=t.rotation,e.t5=t.ani,e.next=12,l.spriteLoader.getTextures("STADTFLD");case 12:return e.t6=e.sent,e.t7=l.animationRenderer,e.next=16,e.t0.getSprites.call(e.t0,e.t1,e.t2,e.t3,e.t4,e.t5,e.t6,e.t7);case 16:if(o=e.sent,s=o.sprites,u=l.fields[i.x][i.y]){e.next=21;break}throw new Error("Sprite must exist");case 21:u.texture=s[0].sprite.texture;case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16711680,i=e.landFieldPosToWorldPos(new a.Point(t,n)),o=i.x,s=i.y;o+=32,s-=32;var u=new a.Graphics;u.beginFill(r),u.alpha=.2,u.visible=l.showRadiusOfAllBuildings,u.drawPolygon([new a.Point(o,s),new a.Point(o+32,s+16),new a.Point(o,s+32),new a.Point(o-32,s+16)]),l.radiusSprites.push(u)},this.game.state.producers.forEach((function(e){for(var t=l.game.state.islands[e.islandId],n=new a.Point(t.position.x+e.position.x,t.position.y+e.position.y),r=l.game.getFieldAtIsland(t,e.position),i=l.configLoader.getFieldData().get(r.fieldId),o=i.size,s=r.rotation%2==0?o.x:o.y,c=r.rotation%2==0?o.y:o.x,d=i.production.radius,f=0;f<s;f++)for(var h=0;h<c;h++)u(n.x+f,n.y+h);for(var p=new a.Rectangle(n.x,n.y,s,c),m=-20;m<20;m++)for(var g=-20;g<20;g++)F(p,d,new a.Point(n.x+m,n.y+g))&&u(n.x+m,n.y+g,16776960)})),c=new Map,t.next=48,Promise.all(this.game.state.figureAnimations.map(function(){var e=Me(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.animationRenderer.getAnimation(t.animationName);case 2:n=e.sent,(r=n.animations[1].rotations[0].main).play(),l.fieldContainer.addEntity(r,r.y),c.set(t,{sprite:r,rotation:0,animationConfig:n});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 48:this.app.renderer.on("prerender",(function(){l.app.renderer.renderingToScreen&&l.game.state.figureAnimations.forEach((function(t){var n,r=t.waypoints,i=t.nextWaypointIdx,a=t.nextWaypointProgress,o=c.get(t),s=o.sprite,u=o.animationConfig,d=o.rotation,f=r[i-1],h=r[i],p=e.landFieldPosToWorldPos(f),m=h.x-f.x,g=h.y-f.y;if(-1===m&&-1===g)n=7;else if(0===m&&-1===g)n=0;else if(1===m&&-1===g)n=1;else if(-1===m&&0===g)n=6;else{if(0===m&&0===g)throw new Error("Invalid waypoints!");if(1===m&&0===g)n=2;else if(-1===m&&1===g)n=5;else if(0===m&&1===g)n=4;else{if(1!==m||1!==g)throw new Error("Invalid waypoints!");n=3}}var v=64*(m-g)/2,y=32*(m+g)/2;s.x=p.x+a*v;var b=Math.round(s.y);s.y=p.y-u.config.Posoffs[1]+a*y;var w=Math.round(s.y);if(b!==w&&l.fieldContainer.changeEntityY(s,b,w),n!==d){var x=u.animations[1].rotations[n].main;x.play(),s.stop(),l.fieldContainer.replaceEntity(s,x,w),c.set(t,{sprite:x,rotation:n,animationConfig:u})}}))}));case 49:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"findBuilding",value:function(e,t,n){var r=this,i=!0,o=!1,s=void 0;try{for(var u,c=function(){var e=u.value;if(e.islandId!==t.id)return"continue";var i=r.game.getFieldAtIsland(t,e.position),o=r.configLoader.getFieldData().get(i.fieldId);if(new a.Rectangle(e.position.x,e.position.y,i.rotation%2==0?o.size.x:o.size.y,i.rotation%2==0?o.size.y:o.size.x).contains(n.x,n.y)){var s=r.game.state.cities.find((function(e){return e.islandId===t.id&&e.cityIslandNum===i.islandCityNum}));if(!s)throw new Error("City must exist");return{v:{building:e,field:i,config:o,city:s}}}},l=e[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var d=c();switch(d){case"continue":continue;default:if("object"===Fe(d))return d.v}}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"renderShips",value:(t=Me(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.game.state.ships.filter((function(e){return"TRADER1"!==G[e.type]})).map((function(e){return new P(e.id,4===e.playerId)})),e.next=3,Promise.all(this.game.state.ships.filter((function(e){return"TRADER1"!==G[e.type]})).map((function(e){return t.find((function(t){return t.id===e.id})).begin(e,n.animationRenderer)})));case 3:this.game.state.ships.filter((function(e){return"TRADER1"!==G[e.type]})).forEach((function(e){t.find((function(t){return t.id===e.id})).render(e,n.viewport)}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setupHotKeys",value:function(){var e=this,t=je.F1;this.keyboardManager.onKeyPressedWithPreventDefault(t,(function(){var t=e.game.state.players[e.myPlayerId],n=e.game.state.tasks[t.assignedTaskId];void 0!==n?console.info(n.text):console.info("It appears like you have no task :/")}));for(var n=[{key:je.F2,zoom:1},{key:je.F3,zoom:2},{key:je.F4,zoom:3}],r=function(){var t=a[i];e.keyboardManager.onKeyPressedWithPreventDefault(t.key,(function(){return e.zoom(t.zoom)}))},i=0,a=n;i<a.length;i++)r();for(var o=[{keys:[je.PAUSE],speed:f.Paused},{keys:[je.F5],speed:f.Slow},{keys:[je.F6],speed:f.Medium},{keys:[je.F7],speed:f.Fast},{keys:[je.SHIFT,je.F8],speed:f.SuperFast}],s=function(){var t=c[u];e.keyboardManager.onKeysPressedWithPreventDefault(t.keys,(function(){return e.game.setSimulationSpeed(t.speed)}))},u=0,c=o;u<c.length;u++)s();[je.LEFT,je.RIGHT,je.UP,je.DOWN].forEach((function(t){return e.keyboardManager.setPreventDefault(t)})),this.keyboardManager.on("down",(function(t){switch(console.log("key down",t),t){case je.LEFT:e.viewport.moveCorner(e.viewport.corner.x-50,e.viewport.corner.y);break;case je.RIGHT:e.viewport.moveCorner(e.viewport.corner.x+50,e.viewport.corner.y);break;case je.UP:e.viewport.moveCorner(e.viewport.corner.x,e.viewport.corner.y-50);break;case je.DOWN:e.viewport.moveCorner(e.viewport.corner.x,e.viewport.corner.y+50)}})),this.keyboardManager.onKeyPressedWithPreventDefault(je.R,(function(){e.toggleShowRadiusOfAllBuildings()}))}},{key:"toggleShowRadiusOfAllBuildings",value:function(){var e=this;this.showRadiusOfAllBuildings=!this.showRadiusOfAllBuildings,this.radiusSprites.forEach((function(t){return t.visible=e.showRadiusOfAllBuildings}))}},{key:"zoom",value:function(e){var t=this.viewport.center;this.viewport.scale.set(1/e),this.viewport.moveCenter(t.x,t.y)}},{key:"zoomIn",value:function(){var e=1/this.viewport.scale.x;this.zoom(Math.max(1,e-1))}},{key:"zoomOut",value:function(){var e=1/this.viewport.scale.x;this.zoom(e+1)}},{key:"onProduced",value:function(t,n,r){var i=this;console.log("Producer at island ".concat(t.id," (").concat(n.x,", ").concat(n.y,") has now stock: ").concat(r,"."));var o=new a.Text("Stock: ".concat(r>>5),{fontFamily:"Arial",fontSize:24,fill:16715792}),s=e.fieldPosToWorldPos(new a.Point(t.position.x+n.x,t.position.y+n.y));o.position.set(s.x,s.y),this.viewport.addChild(o);var u=this.app.ticker.lastTime;this.app.ticker.add((function e(){o.position.y=o.position.y-100*i.app.ticker.deltaMS/2e3,i.app.ticker.lastTime-u>2e3&&(i.app.ticker.remove(e),i.viewport.removeChild(o))}))}},{key:"sendHoveredPositionsToHUD",value:function(){var t=this;Object(b.a)(Object(w.a)(this.viewport,"moved"),Object(w.a)(this.viewport,"wheel-scroll"),Object(w.a)(this.interactionManager,"pointermove")).pipe(Object(x.a)(100),Object(k.a)(null),Object(E.a)((function(e){return t.viewport.toWorld(t.interactionManager.mouse.global)})),Object(E.a)((function(t){return{screen:t,land:e.worldPosToFieldPosLand(t),sea:e.worldPosToFieldPos(t)}})),Object(S.a)((function(e,t){return e.land.equals(t.land)&&e.sea.equals(t.sea)})),Object(E.a)((function(e){return{pos:e,island:Object.values(t.game.state.islands).find((function(t){return t.positionRect.contains(e.sea.x,e.sea.y)}))}}))).subscribe((function(e){var n=e.pos,r=e.island;return t.hud.setHoveredPosition(n.land,n.sea,r)}))}},{key:"moveCameraToStartPosition",value:function(e){var t=this.game.state.kontors.find((function(t){return t.playerId===e}));if(void 0===t){var n=this.game.state.ships.find((function(t){return t.playerId===e}));void 0===n?this.moveTo(new a.Point(250,150)):this.moveTo(n.position)}else{var r=t.position,i=Object.values(this.game.state.islands).find((function(e){return e.id===t.islandId}));this.moveTo(new a.Point(i.position.x+r.x,i.position.y+r.y))}}},{key:"moveTo",value:function(t){this.viewport.moveCenter(e.fieldPosToWorldPos(t))}}]),e}();function Ve(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function qe(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Ve(a,r,i,o,s,"next",e)}function s(e){Ve(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.NOWARE=0]="NOWARE",e[e.ALLWARE=1]="ALLWARE",e[e.EISENERZ=2]="EISENERZ",e[e.GOLD=3]="GOLD",e[e.WOLLE=4]="WOLLE",e[e.ZUCKER=5]="ZUCKER",e[e.TABAK=6]="TABAK",e[e.FLEISCH=7]="FLEISCH",e[e.KORN=8]="KORN",e[e.MEHL=9]="MEHL",e[e.EISEN=10]="EISEN",e[e.SCHWERTER=11]="SCHWERTER",e[e.MUSKETEN=12]="MUSKETEN",e[e.KANONEN=13]="KANONEN",e[e.NAHRUNG=14]="NAHRUNG",e[e.TABAKWAREN=15]="TABAKWAREN",e[e.GEWUERZE=16]="GEWUERZE",e[e.KAKAO=17]="KAKAO",e[e.ALKOHOL=18]="ALKOHOL",e[e.STOFFE=19]="STOFFE",e[e.KLEIDUNG=20]="KLEIDUNG",e[e.SCHMUCK=21]="SCHMUCK",e[e.WERKZEUG=22]="WERKZEUG",e[e.HOLZ=23]="HOLZ",e[e.ZIEGEL=24]="ZIEGEL",e[e.wSOLDAT1=25]="wSOLDAT1",e[e.wSOLDAT2=26]="wSOLDAT2",e[e.wSOLDAT3=27]="wSOLDAT3",e[e.wSOLDAT4=28]="wSOLDAT4",e[e.wKAVALERIE1=29]="wKAVALERIE1",e[e.wKAVALERIE2=30]="wKAVALERIE2",e[e.wKAVALERIE3=31]="wKAVALERIE3",e[e.wKAVALERIE4=32]="wKAVALERIE4",e[e.wMUSKETIER1=33]="wMUSKETIER1",e[e.wMUSKETIER2=34]="wMUSKETIER2",e[e.wMUSKETIER3=35]="wMUSKETIER3",e[e.wMUSKETIER4=36]="wMUSKETIER4",e[e.wKANONIER1=37]="wKANONIER1",e[e.wKANONIER2=38]="wKANONIER2",e[e.wKANONIER3=39]="wKANONIER3",e[e.wKANONIER4=40]="wKANONIER4",e[e.wPIONIER1=41]="wPIONIER1",e[e.wPIONIER2=42]="wPIONIER2",e[e.wPIONIER3=43]="wPIONIER3",e[e.wPIONIER4=44]="wPIONIER4",e[e.GETREIDE=45]="GETREIDE",e[e.TABAKBAUM=46]="TABAKBAUM",e[e.GEWUERZBAUM=47]="GEWUERZBAUM",e[e.ZUCKERROHR=48]="ZUCKERROHR",e[e.BAUMWOLLE=49]="BAUMWOLLE",e[e.WEINTRAUBEN=50]="WEINTRAUBEN",e[e.KAKAOBAUM=51]="KAKAOBAUM",e[e.GRAS=52]="GRAS",e[e.BAUM=53]="BAUM",e[e.STEINE=54]="STEINE",e[e.ERZE=55]="ERZE",e[e.WILD=56]="WILD",e[e.FISCHE=57]="FISCHE",e[e.SCHATZ=58]="SCHATZ"}(Ke||(Ke={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.HANDWERK=1]="HANDWERK",e[e.PLANTAGE=2]="PLANTAGE",e[e.BERGWERK=3]="BERGWERK",e[e.WEIDETIER=4]="WEIDETIER",e[e.JAGDHAUS=5]="JAGDHAUS",e[e.FISCHEREI=6]="FISCHEREI",e[e.MARKT=7]="MARKT",e[e.KONTOR=8]="KONTOR",e[e.ROHSTOFF=9]="ROHSTOFF",e[e.ROHSTWACHS=10]="ROHSTWACHS",e[e.STEINBRUCH=11]="STEINBRUCH",e[e.ROHSTERZ=12]="ROHSTERZ",e[e.WOHNUNG=13]="WOHNUNG",e[e.WERFT=14]="WERFT",e[e.MILITAR=15]="MILITAR",e[e.WACHTURM=16]="WACHTURM",e[e.WIRT=17]="WIRT",e[e.KAPELLE=18]="KAPELLE",e[e.KIRCHE=19]="KIRCHE",e[e.BADEHAUS=20]="BADEHAUS",e[e.THEATER=21]="THEATER",e[e.KLINIK=22]="KLINIK",e[e.SCHULE=23]="SCHULE",e[e.HOCHSCHULE=24]="HOCHSCHULE",e[e.GALGEN=25]="GALGEN",e[e.BRUNNEN=26]="BRUNNEN",e[e.SCHLOSS=27]="SCHLOSS",e[e.DENKMAL=28]="DENKMAL",e[e.TRIUMPH=29]="TRIUMPH",e[e.HAUPT=30]="HAUPT",e[e.PIRATWOHN=31]="PIRATWOHN",e[e.pMAUER=32]="pMAUER"}(ze||(ze={}));var Xe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=void 0,this.gfxId=void 0,this.iconGfxId=void 0,this.kind=void 0,this.size=void 0,this.rotate=void 0,this.animAdd=void 0,this.yOffset=void 0,this.animTime=void 0,this.animAnz=void 0,this.production=void 0,this.figureSpeed=void 0,this.id=t.Id,this.gfxId=t.Gfx,this.iconGfxId=t.Baugfx,this.kind=t.Kind,this.size=new a.Point(t.Size.x,t.Size.y),this.rotate=t.Rotate,this.animAdd=t.AnimAdd,this.animAnz=t.AnimAnz,this.animTime="TIMENEVER"===t.AnimTime?0:t.AnimTime,this.yOffset=-t.Posoffs,this.figureSpeed=[parseInt(t.Wegspeed[0],10),parseInt(t.Wegspeed[1],10),parseInt(t.Wegspeed[2],10),parseInt(t.Wegspeed[3],10)];var n=t.nested_objects.HAUS_PRODTYP[0],r={active:0,inactive:0};Array.isArray(n.Kosten)?(r.active=n.Kosten[0],r.inactive=n.Kosten[1]):r.active=r.inactive=void 0!==n.Kosten?n.Kosten:0,this.production={kind:this.productionKindToId(n.Kind),good:this.goodNameToId(n.Ware),upkeep:r,good1:this.goodNameToId(n.Rohstoff),good2:this.goodNameToId(n.Workstoff),amount:n.Prodmenge*Math.pow(2,5),amount1:n.Rohmenge*Math.pow(2,5),amount2:void 0!==n.Workmenge?n.Workmenge*Math.pow(2,5):0,radius:"RADIUS_MARKT"===n.Radius||"RADIUS_HQ"===n.Radius?16:n.Radius,interval:n.Interval,maxStock:n.Maxlager,smokeAnimationNames:Array.isArray(n.Rauchfignr)?n.Rauchfignr:n.Rauchfignr?[n.Rauchfignr]:[],droughtFlag:1===n.Doerrflg}}var t,n,r,i;return t=e,(n=[{key:"goodNameToId",value:function(e){if(void 0===e)return Ke.NOWARE;var t=Ke[e];if(void 0===t)throw new Error("Invalid good name ".concat(e,"."));return t}},{key:"productionKindToId",value:function(e){var t=ze[e];if(void 0===t)throw new Error("Invalid good name ".concat(e,"."));return t}},{key:"getSprites",value:(i=qe(regeneratorRuntime.mark((function e(t,n,r,i,o,s,u){var c,l,d,f,h,p,m,g,v,y,b,w,x,k,E,S,R,_,A;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=[],l=[],d=i%2==0?this.size.x:this.size.y,f=i%2==0?this.size.y:this.size.x,h=0;h<f;h++)for(p=0;p<d;p++){if(m=r.x+p,g=r.y+h,v=Ze.fieldPosToWorldPos(new a.Point(m,g)),y=v.x,b=v.y,w=void 0,0===this.animAdd||0===this.animTime)x=this.getTexture(p,h,i,o,s),w=new a.Sprite(x);else{for(k=[],E=0;E<this.animAnz;E++)k.push(this.getTexture(p,h,i,E,s));(S=new a.AnimatedSprite(k)).animationSpeed=1/60*(1e3/this.animTime),S.gotoAndPlay(o),w=S}w.anchor.set(0,1),w.x=y,w.y=b+this.yOffset,l.push({sprite:w,pixelPosition:new a.Point(w.x,w.y),mapPosition:new a.Point(m,g),mapPositionOnIsland:new a.Point(m-n.x,g-n.y),fieldOriginPosition:new a.Point(r.x,r.y)})}if(!this.production.smokeAnimationNames){e.next=9;break}return R=Ze.fieldPosToWorldPos(new a.Point(r.x,r.y)),_=R.x,A=R.y,e.next=9,Promise.all(this.production.smokeAnimationNames.map(function(){var e=qe(regeneratorRuntime.mark((function e(n){var r,o,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("FAHNEKONTOR"!==n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,u.getAnimation(n);case 4:r=e.sent,o=Object.keys(r.animations).length>1?r.animations[t]:r.animations[0],(s=(o.rotations.length>1?o.rotations[(i+3)%4*2]:o.rotations[0]).main).x=_-Math.floor(s.width/2)+48-16*(f-d+1)+Math.floor(64*(r.config.Fahnoffs[0]*(0===i||3===i?1:-1)-r.config.Fahnoffs[1]*(0===i||1===i?1:-1))/2),l=A-16+32*(d+f-2)*.25+Math.floor(32*(r.config.Fahnoffs[0]*(0===i||1===i?1:-1)+r.config.Fahnoffs[1]*(0===i||3===i?1:-1))/2),s.y=l-Math.floor(32*r.config.Fahnoffs[2]),s.anchor=new a.Point(0,1),c.push({sprite:s,y:l}),n.startsWith("RAUCH")&&(s.alpha=.7);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:return e.abrupt("return",{sprites:l,smokeAnimations:c});case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,a,o,s){return i.apply(this,arguments)})},{key:"getTexture",value:function(e,t,n,r,i){var a=this.gfxId;if(this.rotate>0&&(a+=n*this.size.x*this.size.y),a+=r*this.animAdd,0===n)a+=t*this.size.x+e;else if(1===n)a+=this.size.x*this.size.y-1-(e*this.size.x+(this.size.x-1-t));else if(2===n)a+=(this.size.y-1-t)*this.size.x+(this.size.x-1-e);else{if(3!==n)throw new Error("Invalid building rotation: ".concat(n,"."));a+=e*this.size.x+(this.size.x-1-t)}var o=i.get(a);if(void 0===o)throw new Error("Could not load texture ".concat(a,"."));return o}}])&&Ye(t.prototype,n),r&&Ye(t,r),e}();function Je(e){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(n,!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nt(e,t){return!t||"object"!==Je(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rt(e){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function it(e,t){return(it=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var at=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=nt(this,rt(t).call(this))).configLoader=e,r.state=void 0,r.timerId=void 0,r.farmFieldTick=r.makeFarmFieldTickGenerator(),r.producerTick=r.makeProducerTickGenerator(),r.getFieldAtIsland=function(e,t){return e.fields[t.x][t.y]},r.getFieldAt=function(e){var t=Object.values(r.state.islands).find((function(t){return t.positionRect.contains(e.x,e.y)}));if(!t)return null;var n=new a.Point(e.x-t.position.x,e.y-t.position.y);return r.getFieldAtIsland(t,n)},r.tick=function(){r.state.timers.timeGame++,r.state.timers.cntCity=r.inc(r.state.timers.cntCity,8,100),r.state.timers.cntIsland=r.inc(r.state.timers.cntIsland,8,100),r.state.timers.cntShipyard=r.inc(r.state.timers.cntShipyard,8,10),r.state.timers.cntMilitary=r.inc(r.state.timers.cntMilitary,8,10),r.state.timers.cntProduction=r.inc(r.state.timers.cntProduction,8,10);for(var e=0;e<r.state.timers.cntGrowth.length;e++)r.state.timers.timeGrowth[e]+=100*r.state.timers.simulationSpeed,r.state.timers.timeGrowth[e]>4e4+7e3*e&&(r.state.timers.timeGrowth[e]=0,r.state.timers.cntGrowth[e]=++r.state.timers.cntGrowth[e]%8);r.farmFieldTick.next(),r.producerTick.next(),r.watchTicksForUpkeep(),r.moveAnimations(),r.emit("tick")},r.inc=function(e,t,n){return r.state.timers.timeGame%n!=0?e:(++e>=t&&(e=0),e)},r.state={players:r.mapArrayById(n.players),islands:r.mapArrayById(n.islands),tasks:r.mapArrayById(n.tasks),cities:n.cities,kontors:n.kontors,producers:n.producers,ships:n.ships,houses:n.houses,farmFields:n.farmFields,timers:Qe({},n.timers,{simulationSpeed:f.Paused}),figureAnimations:[]},r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&it(e,t)}(t,e),n=t,(r=[{key:"setSimulationSpeed",value:function(e){this.state.timers.simulationSpeed=e,this.timerId&&window.clearInterval(this.timerId),e!==f.Paused&&(this.timerId=window.setInterval(this.tick,100/e)),this.emit("simulation-speed",e)}},{key:"mapArrayById",value:function(e){return e.reduce((function(e,t){return e[t.id]=t,e}),{})}},{key:"watchTicksForUpkeep",value:function(){if(this.state.timers.timeGame%100==0){console.log("upkeep calculation");for(var e=this.calculateUpkeeps(),t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Math.floor(e[r]/6);this.addMoney(parseInt(r,10),-i),this.emit("player/upkeep",{playerId:parseInt(r,10),upkeep:e[r]})}}}},{key:"addMoney",value:function(e,t){this.state.players[e].money+=t,this.emit("player/money",{playerId:e,money:this.state.players[e].money})}},{key:"makeProducerTickGenerator",value:regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u,c,l,d,f,h,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.configLoader.getFieldData();case 1:n=0;case 3:if(!(n<this.state.producers.length)){e.next=56;break}if(!(n>0&&n%1037==0)){e.next=7;break}return void(e.next=7);case 7:if((r=this.state.producers[n]).getLastTimerCntProductionWhenThisProducerRan()!==this.state.timers.cntProduction){e.next=10;break}return e.abrupt("continue",53);case 10:if(r.isActive()){e.next=12;break}return e.abrupt("continue",53);case 12:if(!(r.timer>0)){e.next=16;break}if(r.timer--,!(r.timer>0)){e.next=16;break}return e.abrupt("continue",53);case 16:if(i=this.state.islands[r.islandId],a=this.getFieldAtIsland(i,r.position).fieldId,o=t.get(a),Object(g.a)(o),r.howMuchIsBeingProduced>0&&(r.firstGoodStock-=o.production.amount1*r.howMuchIsBeingProduced>>7,r.secondGoodStock-=o.production.amount2*r.howMuchIsBeingProduced>>7,s=r.stock,r.stock+=o.production.amount*r.howMuchIsBeingProduced>>7,r.stock-s>=32&&this.emit("producer/good-produced",{island:this.state.islands[r.islandId],position:r.position,stock:r.stock})),u=0,c=11,l=!1,r.stock>=o.production.maxStock<<5||(0===r.firstGoodStock||r.isProducing()||o.production.good===Ke.NOWARE||(0===o.production.amount1?u=128:(d=r.firstGoodStock/o.production.amount1*128,u=Math.min(128,d)),0===o.production.amount2||(f=r.secondGoodStock/o.production.amount2*128,u=Math.min(f,u)),u<64?u=0:(c=(o.production.interval<<8)*u>>7,0!==u&&(r.prodCount+=(u>>7)*o.production.amount,r.setGoodWasProducedTimer(0),l=!0))),l||r.getGoodWasProducedTimer()<15&&r.setGoodWasProducedTimer(r.getGoodWasProducedTimer()+1)),r.howMuchIsBeingProduced,r.timeCount+=c>>8,r.howMuchIsBeingProduced=u,r.timer=c>>8,r.timeCount<=240&&(r.timeCount>>=1,r.prodCount>>=1),!(r.howMuchIsBeingProduced>0||r.stock<o.production.maxStock)){e.next=52;break}if(h=void 0,h=0===o.production.amount2?384:Math.floor((r.secondGoodStock<<7)/o.production.amount2),0!==o.production.amount1){e.next=36;break}e.next=52;break;case 36:if(!((p=Math.floor((r.firstGoodStock<<7)/o.production.amount1))>256||p>h)){e.next=40;break}e.next=52;break;case 40:e.t0=o.production.kind,e.next=e.t0===ze.WEIDETIER?43:e.t0===ze.HANDWERK?44:e.t0===ze.MARKT?45:e.t0===ze.KONTOR?45:e.t0===ze.HAUPT?45:e.t0===ze.PLANTAGE?46:e.t0===ze.FISCHEREI?47:e.t0===ze.KLINIK?48:e.t0===ze.BERGWERK?49:e.t0===ze.BRUNNEN?50:51;break;case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:return e.abrupt("break",52);case 52:this.emit("producer/updated",{producerId:n});case 53:n++,e.next=3;break;case 56:return void(e.next=58);case 58:e.next=1;break;case 60:case"end":return e.stop()}}),e,this)}))},{key:"calculateUpkeeps",value:function(){var e=this,t=Object.keys(this.state.players).reduce((function(e,t){return e[t]=0,e}),{});return Object.values(this.state.producers).forEach((function(n){var r=e.state.islands[n.islandId].fields[n.position.x][n.position.y],i=r.fieldId,a=r.playerId;Object(g.a)(65535!==i),Object(g.a)(a<7);var o=e.configLoader.getFieldData().get(i);Object(g.a)(o),t[a]+=o.production.upkeep[n.isActive()?"active":"inactive"]}),this),t}},{key:"moveAnimations",value:function(){var e=this,t=this.configLoader.getFieldData();this.state.figureAnimations.forEach((function(n){var r=n.waypoints,i=n.nextWaypointIdx,o=n.nextWaypointProgress,s=n.animationName,u=e.configLoader.getFiguresData().get(s).Speedtyp,c=r[i-1],l=r[i],d=l.x-c.x,f=l.y-c.y,h=new a.Point(c.x+d*o,c.y+f*o),p=e.getFieldAt(new a.Point(Math.round(h.x),Math.round(h.y))),m=t.get(p.fieldId).figureSpeed[u];n.nextWaypointProgress+=1/m*10*e.state.timers.simulationSpeed,n.nextWaypointProgress>=1&&(n.nextWaypointProgress-=1,console.assert(n.nextWaypointProgress<1),n.nextWaypointIdx++,n.nextWaypointIdx===n.waypoints.length&&(n.nextWaypointIdx=1))}))}},{key:"makeFarmFieldTickGenerator",value:regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.configLoader.getFieldData();case 1:n=this.state.farmFields.length-1;case 3:if(!(n>=0)){e.next=24;break}if(n%206!=0){e.next=7;break}return void(e.next=7);case 7:if(r=this.state.farmFields[n],i=this.state.timers.cntGrowth[r.cntGrowthTimerIdx],r.lastGrowthCntWhenFieldHasGrown===i){e.next=21;break}if(r.lastGrowthCntWhenFieldHasGrown=i,a=this.state.islands[r.islandId],o=this.getFieldAtIsland(a,r.position),(s=t.get(o.fieldId)).production.kind!==ze.ROHSTWACHS){e.next=20;break}if(r.animCnt=r.animCnt+1&255,!(r.animCnt>=s.animAnz)){e.next=20;break}return s.production.droughtFlag||(o.fieldId++,this.emit("field/changed",o)),this.state.farmFields.splice(n,1),e.abrupt("continue",21);case 20:0===s.animTime&&(o.ani=r.animCnt,this.emit("field/changed",o));case 21:n--,e.next=3;break;case 24:return void(e.next=26);case 26:e.next=1;break;case 28:case"end":return e.stop()}}),e,this)}))}])&&tt(n.prototype,r),i&&tt(n,i),t}(m.EventEmitter);function ot(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function st(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ut(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){st(a,r,i,o,s,"next",e)}function s(e){st(a,r,i,o,s,"throw",e)}o(void 0)}))}}function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var lt=function(){function e(t,n,r,i,a,o,s,u,c,l,d){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.gamParser=n,this.islandSpriteLoader=r,this.app=i,this.viewport=a,this.configLoader=o,this.musicPlayer=s,this.animationRenderer=u,this.menuStructure=c,this.translator=l,this.spriteLoader=d}var t,n,r,i,a,o;return t=e,(n=[{key:"loadByName",value:(o=ut(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSavesAndMissions();case 2:if(n=e.sent,r=n.find((function(e){return e.name===t}))){e.next=6;break}throw new Error("Could not find ".concat(t,". The following files are available: ").concat(n.map((function(e){return e.name})).join(", ")));case 6:return e.next=8,this.load(r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"load",value:(a=ut(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.openAndGetContentAsStream(t);case 2:return n=e.sent,e.next=5,this.gamParser.getWorld(n);case 5:return r=e.sent,i=new at(this.configLoader,r),a=new Ze(i,this.islandSpriteLoader,this.app,this.viewport,this.configLoader,this.animationRenderer,this.menuStructure,this.translator,this.spriteLoader,0),e.next=11,a.begin();case 11:return e.next=13,this.musicPlayer.playAll();case 13:i.setSimulationSpeed(f.Default);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadSavesAndMissions",value:(i=ut(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.t0=t.push,e.t1=t,e.t2=ot,e.next=7,this.fs.ls("/saves",".gam");case 7:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4),e.next=14;break;case 12:e.prev=12,e.t5=e.catch(1);case 14:return n=[],e.prev=15,e.t6=n.push,e.t7=n,e.t8=ot,e.next=21,this.fs.ls("/missions-original",".szs|.szm");case 21:return e.t9=e.sent,e.t10=(0,e.t8)(e.t9),e.t6.apply.call(e.t6,e.t7,e.t10),e.t11=n.push,e.t12=n,e.t13=ot,e.next=29,this.fs.ls("/missions-custom",".szs|.szm");case 29:e.t14=e.sent,e.t15=(0,e.t13)(e.t14),e.t11.apply.call(e.t11,e.t12,e.t15),e.next=36;break;case 34:e.prev=34,e.t16=e.catch(15);case 36:return e.abrupt("return",t.concat(n));case 37:case"end":return e.stop()}}),e,this,[[1,12],[15,34]])}))),function(){return i.apply(this,arguments)})}])&&ct(t.prototype,n),r&&ct(t,r),e}();function dt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ft(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){dt(a,r,i,o,s,"next",e)}function s(e){dt(a,r,i,o,s,"throw",e)}o(void 0)}))}}function ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var pt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.animationData=t,this.spriteLoader=n}var t,n,r,i,o,s;return t=e,(n=[{key:"getAnimation",value:(s=ft(regeneratorRuntime.mark((function e(t){var n,r,i,o,s,u,c,l,d,f,h,p,m,v,y,b,w,x,k,E,S,R,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.animationData.objects.FIGUR.items[t]){e.next=4;break}throw console.log(this.animationData.objects.FIGUR.items),new Error("Invalid animation name: ".concat(t));case 4:if(!["FAHNE1","FAHNE2","FAHNE3","FAHNE4","FAHNEWEISS","FAHNEPIRAT"].includes(t)){e.next=8;break}r={0:this.animationData.objects.FIGUR.items.FAHNEMARKT.nested_objects.ANIM[0]},e.next=12;break;case 8:if(0!==Object.values(n.nested_objects).length){e.next=10;break}throw new Error('Animation "'.concat(t,'" does not include sufficient animation data.'));case 10:Object(g.a)(n.nested_objects.ANIM),r=n.nested_objects.ANIM;case 12:return i=n.Gfx,o=n.Rotate,s=0===o?1:8,Object(g.a)(n.GfxCategoryMapped.startsWith("GFX")),u=n.GfxCategoryMapped.substr("GFX".length),e.next=19,this.spriteLoader.getTextures(u);case 19:for(c=e.sent,l={config:n,animations:{}},d=0,f=Object.keys(r);d<f.length;d++){for(h=f[d],p=[],m=r[h],v=n.Bugfignr?1:m.AnimAnz,y=1/60*(1e3/m.AnimSpeed),b=m.AnimAdd,m.AnimRept&&m.AnimRept,w=m.Rotate?m.Rotate:o,x=0;x<s;x++){for(k=[],E=i+m.AnimOffs+x*w,S=[],R=0;R<v;R++)S.push(c.get(E)),E+=b;(_=new a.AnimatedSprite(S)).anchor.set(0,1),_.loop="ENDLESS"===m.Kind,_.animationSpeed=y,k.push(_),p.push({main:_})}l.animations[h]={rotations:p,config:m}}return e.abrupt("return",l);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"renderAnimation",value:(o=ft(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAnimation(t);case 2:for(r=e.sent,console.log(r),i=200,a=function(){var e=s[o],t=r.animations[e].rotations,a=0;t.forEach((function(e){u.debugDrawSprite(e.main,n,a,i),a+=e.main.width})),i+=50},o=0,s=Object.keys(r.animations);o<s.length;o++)a();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getShipAnimation",value:(i=ft(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=G[t.type],e.abrupt("return",this.getAnimation(n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"debugDrawSprite",value:function(e,t,n,r){var i=new a.Graphics;i.position.set(n,r),i.lineStyle(1,16711680),i.drawRect(0,0,e.width,-e.height),e.position.set(n,r),t.addChild(e),t.addChild(i),e.play()}}])&&ht(t.prototype,n),r&&ht(t,r),e}();function mt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function gt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){mt(a,r,i,o,s,"next",e)}function s(e){mt(a,r,i,o,s,"throw",e)}o(void 0)}))}}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var yt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.loaded=!1,this.fieldData=new Map,this.figuresData=new Map}var t,n,r,i,a;return t=e,(n=[{key:"load",value:(a=gt(regeneratorRuntime.mark((function e(){var t,n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.fs.openAndGetContentAsText("/fields.json");case 3:for(e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1).objects.HAUS.items,n=0,r=Object.keys(t);n<r.length;n++)i=r[n],a=parseInt(t[i].Id,10),this.fieldData.set(a,new Xe(t[i]));return e.next=8,this.loadFigures();case 8:this.loaded=!0;case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadFigures",value:(i=gt(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.fs.openAndGetContentAsText("/animations.json");case 3:for(e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1).objects.FIGUR.items,n=0,r=Object.keys(t);n<r.length;n++)i=r[n],this.figuresData.set(i,t[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getFieldData",value:function(){if(!this.loaded)throw new Error("Configuration is not loaded. Call .load() first!");return this.fieldData}},{key:"getFiguresData",value:function(){return this.figuresData}}])&&vt(t.prototype,n),r&&vt(t,r),e}();function bt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var xt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t}var t,n,r,i,o;return t=e,n=[{key:"load",value:(i=regeneratorRuntime.mark((function t(){var n,r,i,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i[r].name,console.log("Loading font ".concat(t,".")),e.next=4,o.fs.openAndGetContentAsUint8Array("/fonts/".concat(t,"/font.xml"));case 4:return n=e.sent,e.next=7,new Promise((function(e){a.Loader.shared.add(t,"data:application/xml;base64,".concat(Object(R.e)(n))).load(e)}));case 7:console.log("Finished loading font ".concat(t,"."));case 8:case"end":return e.stop()}}),e)})),r=0,i=Object.values(e.fonts);case 2:if(!(r<i.length)){t.next=7;break}return t.delegateYield(n(),"t0",4);case 4:r++,t.next=2;break;case 7:case"end":return t.stop()}}),t)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){bt(a,n,r,o,s,"next",e)}function s(e){bt(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return o.apply(this,arguments)})}],r=[{key:"getFontByGadId",value:function(e){return this.fonts[e]}}],n&&wt(t.prototype,n),r&&wt(t,r),e}();function kt(e){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rt(e,t){return!t||"object"!==kt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _t(e){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}xt.fonts={0:{name:"ZEI20V",size:24},1:{name:"ZEI14A",size:18},2:{name:"ZEI28V",size:32}};var It=function(e){function t(){var e,n;Et(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Rt(this,(e=_t(t)).call.apply(e,[this].concat(i)))).dragging=!1,n.topY=void 0,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(t,e),n=t,(r=[{key:"setSliderData",value:function(e,t,n){var r=this;this.position.set(this.position.x,this.position.y+(e-n)/2),this.topY=this.position.y,this.on("mousedown",(function(e){r.dragging=!0})),this.on("mouseup",(function(e){r.dragging=!1})),this.on("mousemove",(function(e){if(r.dragging){var t=e.data.originalEvent.offsetY-r.texture.height/2;r.position.y=r.clamp(t,r.topY,r.topY+n-r.texture.height/2)}}))}},{key:"clamp",value:function(e,t,n){return Math.min(Math.max(t,e),n)}}])&&St(n.prototype,r),i&&St(n,i),t}(a.Sprite);function Ot(e){return(Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pt(e,t){return!t||"object"!==Ot(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ct(e){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Nt(e,t){return(Nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}for(var Gt=function(e){function t(e,n,r,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Pt(this,Ct(t).call(this))).size=n,a.isVertical=r,a.color=i,a.position=e,a.setValue(Math.random()),a}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nt(e,t)}(t,e),n=t,(r=[{key:"setValue",value:function(e){if(Object(g.a)(e>=0&&e<=1),this.clear(),this.beginFill(this.color),this.isVertical){var t=Math.floor(this.size.y*e);this.drawRect(0,this.size.y-t,this.size.x,t)}else{var n=Math.floor(this.size.x*e);this.drawRect(0,0,n,this.size.y)}}}])&&Tt(n.prototype,r),i&&Tt(n,i),t}(a.Graphics),Dt=new Uint8Array([0,0,0,128,0,0,0,128,0,128,128,0,0,0,128,109,31,108,0,128,128,192,192,192,255,0,255,255,0,255,0,0,0,0,4,4,0,8,8,0,16,0,11,6,3,21,8,0,37,4,0,0,20,4,6,22,6,0,33,0,3,38,3,14,28,5,8,49,4,32,24,0,27,44,0,10,12,18,8,28,20,24,22,16,35,23,12,1,41,21,12,44,19,24,43,17,35,41,15,10,22,37,10,44,37,36,31,31,34,49,29,18,36,44,38,46,41,19,34,64,4,61,6,16,59,6,21,62,8,37,61,4,14,60,40,33,59,35,41,61,32,14,55,64,24,61,61,33,49,61,37,61,57,17,58,72,41,61,66,17,60,78,17,58,94,13,77,0,37,78,0,18,77,8,23,77,37,28,77,72,25,77,88,22,73,110,17,95,3,37,98,0,22,93,61,22,112,45,21,150,36,25,124,107,28,148,113,0,82,140,8,74,144,248,194,48,8,82,148,8,86,148,12,78,140,23,82,136,0,99,140,24,94,140,8,90,156,12,90,160,18,99,148,18,101,148,10,117,150,8,90,173,8,99,169,12,103,165,21,104,165,6,121,173,19,115,171,33,115,165,10,118,181,24,119,177,33,115,173,33,123,177,24,117,187,8,136,189,11,136,196,17,136,220,33,156,132,0,156,148,24,156,177,0,156,214,12,148,206,196,120,94,11,173,216,8,148,231,8,148,239,12,160,230,28,152,226,21,178,225,16,177,239,24,189,231,33,189,222,0,148,247,80,150,226,0,156,255,224,138,108,242,153,122,233,113,2,255,125,2,8,165,247,251,216,52,244,175,45,16,156,247,24,148,239,20,152,251,255,252,157,33,165,247,54,17,4,74,17,4,53,45,12,70,44,11,60,74,11,41,99,0,59,90,19,45,103,0,46,112,0,45,99,8,44,106,17,55,109,2,55,106,17,66,106,3,68,108,16,59,47,38,62,68,41,59,61,64,61,74,63,60,97,45,65,91,68,63,77,75,60,99,75,49,76,90,63,75,85,46,98,90,65,101,86,58,95,104,55,98,117,55,102,140,94,22,5,89,42,20,90,64,26,89,96,11,90,94,45,88,80,70,87,102,68,89,79,80,85,103,80,93,107,77,90,88,89,86,111,90,87,99,98,88,102,117,115,33,10,113,65,20,111,95,17,111,82,57,108,111,65,111,107,90,107,104,107,143,29,4,137,86,13,140,88,31,137,99,64,172,39,5,166,93,37,197,49,8,205,84,30,41,126,2,49,123,0,53,127,0,66,123,0,52,123,11,54,123,20,54,122,73,49,132,4,66,132,0,49,132,20,64,132,22,53,140,0,53,134,55,49,141,50,49,167,29,83,130,9,91,126,62,87,121,107,108,123,103,82,171,6,85,145,47,89,182,41,119,126,60,119,119,105,116,180,48,170,128,42,145,125,103,133,187,58,202,172,52,43,133,116,83,127,115,127,124,115,125,142,115,74,126,126,73,128,164,118,132,123,118,135,143,43,160,124,95,156,132,45,181,136,63,193,138,92,169,189,63,222,167,86,237,200,144,137,123,141,153,133,152,149,127,175,154,124,152,165,140,152,178,141,169,176,140,204,194,133,154,176,173,185,182,160,179,200,167,172,209,207,221,218,181,225,239,226,254,250,230,0,148,255,160,160,164,128,128,128,255,0,0,0,255,0,255,255,0,0,0,255,255,0,255,0,255,255,255,255,255]),jt=Dt,Ft={},Lt=0;Lt<Dt.length/3;Lt++){Ft[((Dt[3*Lt+0]<<24)+(Dt[3*Lt+1]<<16)+(Dt[3*Lt+2]<<8)+255).toString()]=Lt}var Mt=Ft;function Ht(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ut=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spriteLoader=t,this.videos=[]}var t,n,r,i,o;return t=e,(n=[{key:"clear",value:function(e){this.destroyVideos(),e.removeChildren()}},{key:"render",value:(i=regeneratorRuntime.mark((function e(t,n,r){var i,o,s,u,c,l,d,f,h,p,m,v,y=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.destroyVideos(),i=new Map,o=0,s=Object.keys(n.variables);o<s.length;o++)u=s[o],c=n.variables[u],u.startsWith("BLK_")&&("TOOL"===(l=u.substring(4))&&(l="TOOLS"),i.set(c,l));d=[],f=0,h=n.objects.GADGET.items,p=regeneratorRuntime.mark((function e(){var n,o,s,u,c,l,p,b,w,x,k,E,S,R,_,A,I,O,T,P,C,N,G,D,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v[m],o=h[n],s=o.Id,u=o.Blocknr,c=o.Gfxnr,"GAD_UNUSED"!==(l=o.Kind)&&"GAD_NIX"!==l&&!r.ignore.includes(s)){e.next=8;break}return e.abrupt("return","continue");case 8:p=new a.Point(o.Pos[0],o.Pos[1]),o.Posoffs&&p.set(p.x+o.Posoffs[0],p.y+o.Posoffs[1]),b=void 0!==o.Size?new a.Point(o.Size.x,o.Size.y):null,w=void 0===o.Noselflg||0===o.Noselflg,x=1===o.Flipflg,k=o.Pressoff,(E=1===o.Reiheflg)&&Object(g.a)(w),Object(g.a)(void 0!==u),S=void 0!==o.Slidverflg,R=o.Slidoffs,_=o.Slidsize,e.t0=l,e.next="GAD_GFX"===e.t0?23:"GAD_TEXTL"===e.t0?35:"GAD_TEXTZ"===e.t0?35:"GAD_TEXTR"===e.t0?35:"GAD_BALKEN"===e.t0?44:53;break;case 23:return e.next=25,y.spriteLoader.getTextures("TOOLS/".concat(i.get(parseInt(u,10))));case 25:return A=e.sent,I=A.get(c),O=A.get(c+k),(T=S?new It(I):new a.Sprite(I)).position.set(p.x,p.y),T.name="menu-".concat(s),S&&T.setSliderData(b.y,R?R[1]:0,_?_[1]:0),w&&(T.buttonMode=!0,T.interactive=!0,P=Array.isArray(r.buttons)?r.buttons[f]:r.buttons[s],E&&(0===d.length&&(T.texture=O),d.push({sprite:T,activeTexture:O,defaultTexture:I})),T.on("mousedown",(function(){if(T.texture=x?T.texture===I?O:I:O,E){var e=!0,n=!1,r=void 0;try{for(var i,a=d[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.sprite!==T&&(o.sprite.texture=o.defaultTexture)}}catch(e){n=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}P(t,!x||T.texture===O)})),E||x||T.on("mouseup",(function(){return T.texture=I})),f++),t.addChild(T),e.abrupt("break",54);case 35:return C=xt.getFontByGadId(void 0===u?0:parseInt(u,10)),(N=new a.BitmapText(r.texts[s]||"???",{font:{name:C.name,size:C.size}})).position.set(p.x,p.y),N.pivot.set(0,C.size),N.name="menu-".concat(s),b&&(N.hitArea=new a.Rectangle(0,0,b.x,b.y)),l.endsWith("Z")?N.anchor=new a.Point(.5,0):l.endsWith("R")&&(N.anchor=new a.Point(1,0)),t.addChild(N),e.abrupt("break",54);case 44:if(null!==b){e.next=46;break}throw new Error("Size must be set for bar");case 46:return G=o.Color[0],Object(g.a)(G>=0&&G<=255),D=(jt[3*G+0]<<16)+(jt[3*G+1]<<8)+(jt[3*G+2]<<0),(j=new Gt(p,b,1===o.Slidverflg,D)).name="menu-".concat(s),t.addChild(j),e.abrupt("break",54);case 53:console.warn("Unsupported kind: ".concat(l));case 54:case"end":return e.stop()}}),e)})),m=0,v=Object.keys(h);case 8:if(!(m<v.length)){e.next=16;break}return e.delegateYield(p(),"t0",10);case 10:if("continue"!==e.t0){e.next=13;break}return e.abrupt("continue",13);case 13:m++,e.next=8;break;case 16:r.onLoad(t);case 17:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){Ht(a,n,r,o,s,"next",e)}function s(e){Ht(a,n,r,o,s,"throw",e)}o(void 0)}))},function(e,t,n){return o.apply(this,arguments)})},{key:"renderVideo",value:function(e,t,n){t.texture.baseTexture.resource.source.addEventListener("ended",(function(){e.removeChild(t),n()}),{once:!0}),e.addChild(t),this.videos.push(t)}},{key:"renderVideoFullscreen",value:function(e,t,n){this.clear(e),t.texture.baseTexture.resource.source.addEventListener("ended",(function(){e.removeChild(t),n()}),{once:!0}),t.scale.set(2,2);var r=512-t.texture.width*t.scale.x/2,i=384-t.texture.height*t.scale.y/2;t.position.set(r,i),e.addChild(t)}},{key:"destroyVideos",value:function(){this.videos.forEach((function(e){return e.destroy({texture:!0,baseTexture:!0})})),this.videos=[]}}])&&Bt(t.prototype,n),r&&Bt(t,r),e}(),Wt=n("aNYc"),Kt=n.n(Wt);function zt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Zt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Vt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Zt(a,r,i,o,s,"next",e)}function s(e){Zt(a,r,i,o,s,"throw",e)}o(void 0)}))}}var qt=function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configLoader=t,this.spriteLoader=n,this.animationRenderer=r,this.inited=!1,this.fields=new Map,this.textures=new Map,this.lock=new Kt.a,this.init=Vt(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.lock.acquire("init",Vt(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.inited){e.next=6;break}return e.next=3,i.spriteLoader.getTextures("STADTFLD");case 3:i.textures=e.sent,i.fields=i.configLoader.getFieldData(),i.inited=!0;case 6:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))),this.getIslandSprites=function(){var e=Vt(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.init();case 2:n=[],r=Object(R.d)(t.size.x,t.size.y),a=0;case 5:if(!(a<t.size.x)){e.next=16;break}o=0;case 7:if(!(o<t.size.y)){e.next=13;break}return e.next=10,i.loadSpritesOfField(t,a,o,r,n);case 10:o++,e.next=7;break;case 13:a++,e.next=5;break;case 16:return e.abrupt("return",{sprites:r,smokeSprites:n});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadSpritesOfField=function(){var e=Vt(regeneratorRuntime.mark((function e(t,n,r,o,s){var u,c,l,d,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(u=t.fields[n][r])){e.next=3;break}return e.abrupt("return");case 3:if(void 0!==(c=i.fields.get(u.fieldId))){e.next=6;break}throw new Error("Could not load config for ".concat(u.fieldId,"."));case 6:return l=new a.Point(t.position.x+n,t.position.y+r),e.next=9,c.getSprites(u.playerId,t.position,l,u.rotation,u.ani,i.textures,i.animationRenderer);case 9:d=e.sent,f=d.sprites,h=d.smokeAnimations,f.forEach((function(e){var t=e.mapPositionOnIsland,n=t.x,r=t.y;null===o[n][r]&&(o[n][r]=e)})),s.push.apply(s,zt(h));case 14:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()};function Yt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Xt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Yt(a,r,i,o,s,"next",e)}function s(e){Yt(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Jt(e){return $t.apply(this,arguments)}function $t(){return($t=Xt(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.createElement("video")).src="data:video/mp4;base64,".concat(Object(R.e)(t)),r=a.Texture.from(n),e.next=5,new Promise((function(e,t){r.baseTexture.addListener("loaded",e),r.baseTexture.addListener("error",t)}));case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var en,tn,nn=function(){var e,t,n;function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.type=e,this.ready=t,this.hp=n}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=e.read8();e.read16();var i=e.read16();return e.read16(),new r(t,0!=(16&n),i)}}],(t=null)&&Qt(e.prototype,t),n&&Qt(e,n),r}();function rn(e){var t=e.read8(),n=new a.Point(e.read8(),e.read8());e.read8(),e.read32();var r=e.read16(),i=e.read16(),o=e.read16();e.read16();var s=function(e){for(var t=[],n=0;n<8;n++)t.push(nn.fromSaveGame(e));return t}(e);return e.read(32),{islandId:t,position:n,numSwords:r,numMuscets:i,numCanons:o,units:s}}function an(e){for(var t=e.read8(),n=e.read8(),r=e.read16(),i=!e.read8Bool(),a=e.read8(),o=e.read16(),s=e.read32(),u=e.read32(),c=e.read32(),l=e.read32(),d=e.read(16,4),f=e.read32(),h=[],p=0;p<5;p++)h.push(e.read32());e.read(15);for(var m=[],g=0;g<5;g++)m.push(e.read8());e.read(3);return{islandId:t,playerId:r,cityIslandNum:n,progressAllowed:i,inhabitants:h,taxes:m,name:e.readString(33),marketCnt:l,lastMeldNr:a,stimmung:o,einkauf:s,verkauf:u,tragedyCnt:c,playerCredit:d,wohnRes:f}}function on(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Iron=2]="Iron",e[e.Gold=3]="Gold"}(en||(en={})),function(e){e[e.Small=1]="Small",e[e.Big=0]="Big"}(tn||(tn={}));var sn,un,cn=function(){var e,t,n;function r(e,t,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.kind=e,this.size=t,this.amount=n,this.position=i,this.discoveredBy=a}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=new a.Point(e.read8(),e.read8()),i=e.read8(),o=e.read8();return e.read8(),new r(t,o,e.read16(),n,i)}}],(t=null)&&on(e.prototype,t),n&&on(e,n),r}();function ln(e,t,n,r,i){i.read8();var o=new a.Point(i.read8(),i.read8());return{id:e,position:t,size:o,positionRect:new a.Rectangle(t.x,t.y,o.x,o.y),numBaseIsland:r,numOreLocations:0,oreLocations:[],fertility:{tobacco:!1,sugarcane:!1,wine:!1,cotton:!1,cacao:!1,spice:!1},isSouth:n,differsFromBaseIsland:!1,fertilityDiscovered:!1,fields:[]}}function dn(e,t,n,r,i){return ln(e,t,n,r,i)}function fn(e,t,n,r,i){return ln(e,t,n,r,i)}function hn(e){var t=e.read8(),n=e.read8(),r=e.read8(),i=(e.read8(),e.read16()),o=e.read16();e.read16(),e.read16(),e.read(8);Object(g.a)(e.read(3).every((function(e){return 0===e})));e.read8(),e.read8Bool(),e.read8();var s=e.read8(),u=e.read8(),c=[cn.fromSaveGame(e),cn.fromSaveGame(e)],l=(e.read(48),function(e){return{tobacco:(e&1<<sn.TOBACCO)>0,sugarcane:(e&1<<sn.SUGARCANE)>0,wine:(e&1<<sn.WINE)>0,cotton:(e&1<<sn.COTTON)>0,cacao:(e&1<<sn.CACAO)>0,spice:(e&1<<sn.SPICE)>0}}(e.read32())),d=e.read16(),f=(e.read16(),e.read8Bool()),h=e.read8Bool();e.read8(),e.read8(),e.read32(),e.read32();e.read32();return{id:t,position:new a.Point(i,o),size:new a.Point(n,r),positionRect:new a.Rectangle(i,o,n,r),numBaseIsland:d,numOreLocations:s,oreLocations:c,fertility:l,isSouth:f,differsFromBaseIsland:h,fertilityDiscovered:0!==u,fields:[]}}function pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.TOBACCO=1]="TOBACCO",e[e.SUGARCANE=3]="SUGARCANE",e[e.WINE=5]="WINE",e[e.COTTON=4]="COTTON",e[e.CACAO=6]="CACAO",e[e.SPICE=2]="SPICE"}(sn||(sn={})),function(e){e[e.Inactive=0]="Inactive",e[e.OfferedByMe=1]="OfferedByMe",e[e.OfferedByOther=2]="OfferedByOther",e[e.Active=3]="Active"}(un||(un={}));var mn,gn=function(){var e,t,n;function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.state=e,this.time=t}return e=r,n=[{key:"fromSaveGame",value:function(e){return new r(e.read32(),e.read32())}}],(t=null)&&pn(e.prototype,t),n&&pn(e,n),r}();function vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}mn||(mn={});var yn,bn=function(){var e,t,n;function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.kind=e,this.otherPlayerId=t,this.time=n}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=e.read8();return Object(g.a)(0===e.read16()),new r(t,n,e.read32())}}],(t=null)&&vn(e.prototype,t),n&&vn(e,n),r}();function wn(e){var t=e.read32S(),n=e.read8(),r=e.read8(),i=(e.read8(),e.read8()),a=e.read8();Object(g.a)(0===e.read8());var o=e.read16(),s=e.read8(),u=e.read8(),c=e.read8Bool(),l=e.read8Bool(),d=e.read16(),f=e.read16(),h=e.read16(),p=e.read16(),m=e.read16(),v=e.read16(),y=e.read8(),b=e.read8(),w=(1&b)>0,x=(2&b)>0,k=e.read(6),E=e.read8()/32+1,S=e.read8()/32+1;Object(g.a)(e.read(14).every((function(e){return 0===e})));var R=e.read32(),_=e.read16(),A=e.read16(),I=e.read32();Object(g.a)(4294967295===I);e.read(264);for(var O=[],T=0;T<3;T++)O.push(gn.fromSaveGame(e));for(var P=[],C=0;C<3;C++)P.push(gn.fromSaveGame(e));e.read(72);for(var N=[],G=0;G<64;G++)N.push(bn.fromSaveGame(e));var D=e.readString(64),j=e.readString(48);return console.log("player ".concat(r,":  "),a,o,u,y,k),{id:r,kind:n,color:i,fullName:D,shortName:j,tradeContracts:O,peaceContracts:P,money:t,enemiesDefeated:d,triumphArchesBuilt:f,soldiersKilled:h,soldiersFallen:p,shipsSunken:m,shipsKilled:v,accessibleBuildings:R,statues:_,statuesBuilt:A,palaceBuilt:c,cathedralBuilt:l,enablePositiveWillInfluence:w,enableNegativeWillInfluence:x,positiveWillInfluence:E,negativeWillInfluence:S,assignedTaskId:s,playerEvents:N}}function xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.HUMAN=0]="HUMAN",e[e.AI=9]="AI",e[e.TRADER=13]="TRADER",e[e.PIRATE=14]="PIRATE",e[e.NATIVE=11]="NATIVE"}(yn||(yn={}));var kn,En=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandId=void 0,this.position=void 0,this.stock=void 0,this.firstGoodStock=void 0,this.secondGoodStock=void 0,this.timer=void 0,this.prodCount=void 0,this.timeCount=void 0,this.howMuchIsBeingProduced=void 0,this.goodWasProduced=void 0,this.speedCnt=void 0}var t,n,r;return t=e,r=[{key:"load",value:function(t){var n=new e;n.islandId=t.read8(),n.position=new a.Point(t.read8(),t.read8()),t.read8(),n.speedCnt=7&t.read8(),n.stock=t.read16(),t.read8(),n.timer=t.read16(),n.secondGoodStock=t.read16(),n.firstGoodStock=t.read16(),t.read8(),n.howMuchIsBeingProduced=t.read8(),n.prodCount=t.read16(),n.timeCount=t.read16();var r=t.read8();return n.setActive(!!(1&r)),n.setAnimCount(r>>2&15),n.setGoodsAllowedForPickup(1==(64&r)),2&r?n.goodWasProduced|=64:n.goodWasProduced&=-65,n.setGoodWasProducedTimer(15&t.read8()),Object(g.a)(0===t.read16()),n}}],(n=[{key:"save",value:function(e){e.write8(this.islandId),e.write8(this.position.x),e.write8(this.position.y),e.write8(0),e.write8(7&this.speedCnt),e.write16(this.stock),e.write8(0),e.write16(this.timer),e.write16(this.secondGoodStock),e.write16(this.firstGoodStock),e.write8(0),e.write8(this.howMuchIsBeingProduced),e.write16(this.prodCount),e.write16(this.timeCount);var t=(this.isActive()?1:0)<<0|(this.goodWasProduced>>6&1)<<1|this.getAnimCount()<<2|(this.goodsAllowedForPickup()?1:0)<<6;e.write8(t),e.write8(this.getGoodWasProducedTimer()),e.write16(0)}},{key:"isProducing",value:function(){return!!(128&this.goodWasProduced)}},{key:"isActive",value:function(){return!!(8&this.speedCnt)}},{key:"setActive",value:function(e){e?this.speedCnt|=8:this.speedCnt&=-9}},{key:"goodsAllowedForPickup",value:function(){return!!(16&this.goodWasProduced)}},{key:"setGoodsAllowedForPickup",value:function(e){e?this.goodWasProduced|=16:this.goodWasProduced&=-17}},{key:"stockAsInt",value:function(){return this.stock>>>5}},{key:"firstGoodStockAsInt",value:function(){return this.firstGoodStock>>>5}},{key:"secondGoodStockAsInt",value:function(){return this.secondGoodStock>>>5}},{key:"getGoodWasProducedTimer",value:function(){return 15&this.goodWasProduced}},{key:"setGoodWasProducedTimer",value:function(e){Object(g.a)(e>=0&&e<=15),this.goodWasProduced=240&this.goodWasProduced|15&e}},{key:"getAnimCount",value:function(){return this.speedCnt>>4&15}},{key:"setAnimCount",value:function(e){Object(g.a)(e>=0&&e<=15),this.speedCnt=15&this.speedCnt|e<<4}},{key:"getLastTimerCntProductionWhenThisProducerRan",value:function(){return 7&this.speedCnt}}])&&xn(t.prototype,n),r&&xn(t,r),e}();function Sn(e){var t=new a.Point(e.read16()/2,e.read16()/2),n=e.read16(),r=e.read16(),i=e.read16(),o=(e.read(4),e.read16(),e.read16(),e.read8(),e.read8(),e.read32(),e.read8()),s=(e.read8(),e.read8(),e.read8()),u=(e.read8(),e.read8Bool());e.read(4),e.read(4),e.read(30);return{id:i,playerId:o,type:r,position:t,rotation:s,isPatrolling:u,hp:n}}function Rn(e){var t=e.read32(),n=e.read(28),r=e.read8();Object(g.a)(0===e.read8());var i=e.read8();Object(g.a)(0===e.read8());var a=e.read8();Object(g.a)(e.read(6).every((function(e){return 0===e})));var o=[];e.read8Bool()&&o.push("any"),e.read8Bool()&&o.push("red"),e.read8Bool()&&o.push("blue"),e.read8Bool()&&o.push("yellow"),e.read8Bool()&&o.push("white"),e.read8Bool()&&o.push("trader"),e.read8Bool()&&o.push("pirate"),e.read8Bool()&&o.push("native");for(var s=e.read(25),u=e.read32(),c=e.read32(),l=e.read32(),d=e.read(16),f=e.readString(2048),h=e.read(8),p=[],m=0;m<3;m++)p.push({count:e.read32(),requiredLevel:e.read32(),requiredLevelCount:e.read32()});var v=e.read(36),y={count:e.read32(),requiredLevel:e.read32(),requiredLevelCount:e.read32()};return console.log("task",t,n,s,d,h,v),{id:t,text:f,successVideoId:c,playersToKill:o,requiredBalance:u,requiredTradeBalance:l,ownCityReachInhabitants:p,helpOtherToReachInhabitantsPlayerId:a,helpOtherToReachInhabitants:y,monopolyGoodId1:r,monopolyGoodId2:i}}function _n(e){var t=e.read8(),n=e.read8(),r=e.read8(),i=e.read8(),a=e.read8();e.read(63);var o=e.read(4,4);e.read(4,4);var s=e.read(32,1),u=e.read32(),c=e.read32(),l=e.read32(),d=e.read32(),f=e.read32(),h=e.read32(),p=e.read32(),m=e.read32(),v=e.read8(),y=e.read8(),b=e.read8(),w=e.read8(),x=e.read32(),k=0==(64&x),E=0==(8&x),S=0==(4&x),R=0==(1&x),_=0==(256&x),A=e.read32(),I=e.read32(),O=e.read32(),T=e.read32(),P=e.read32(),C=e.read32();e.read(4),e.read(4);var N=e.read32(),G=e.read32();e.read(49,4);var D=e.read(32,4),j=e.read(32,4);Object(g.a)(s.length===j.length);var F={cntCity:t,cntIsland:n,cntShipyard:r,cntMilitary:i,cntProduction:a,cntSettlers:o,cntGrowth:s,timeCity:u,timeIsland:c,timeShipyard:l,timeMilitary:d,timeProduction:f,timeGoodToolsCnt:h,timeGoodToolsMax:p,timeGame:m,noErzOutFlg:v,tutorFlg:y,aiLevel:b,missionNumber:w,gameId:A,cityNameNumber:I,timeNextDrought:O,timePirateSec:T,missionSubNumber:P,shipMax:C,timeNextVulcano:N,cntVulcano:G,timeSettlers:D,timeGrowth:j,enableTrader:k,bigIronRunsOut:E,enableDroughts:S,enablePirate:R,enableVulcano:_};return console.log(F),F}function An(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Swordsman=0]="Swordsman",e[e.Cavalry=1]="Cavalry",e[e.Musketeer=2]="Musketeer",e[e.Gunner=3]="Gunner",e[e.Native=8]="Native"}(kn||(kn={}));var In=function(){var e,t,n;function r(e,t,n,i,a,o,s,u,c,l,d,f,h){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.numNativesNorth=e,this.numNativesSouth=t,this.numBigIronOre=n,this.numSmallIronOre=i,this.numGoldOre=a,this.numWine=o,this.numSugarCane=s,this.numSpice=u,this.numCacao=c,this.numTobacco=l,this.numCotton=d,this.numTreasures=f,this.islandTemplates=h}return e=r,n=[{key:"fromSaveGame",value:function(e){for(var t=e.slice(100),n=t[64],i=t[68],o=e.read32(),s=e.slice(268),u=s[46],c=s[54],l=s[62],d=s[110],f=s[95],h=s[86],p=s[118],m=s[78],v=s[102],y=s[174],b=[],w=0;w<o;w++){var x=e.read8(),k=0===x,E=1===x,S=e.read8();if(S<0||S>4)throw new Error("Invalid island size category: ".concat(S,"."));Object(g.a)(0===e.read8());var R=e.read8(),_=e.read16();Object(g.a)(0===e.read16());var A=new a.Point(e.read32(),e.read32());b.push({num:R,size:S,position:A,climate:k?"NORTH":E?"SOUTH":"ANY",numBaseIsland:_})}var I=!0,O=!1,T=void 0;try{for(var P,C=e.slice(e.length-e.position())[Symbol.iterator]();!(I=(P=C.next()).done);I=!0){var N=P.value;Object(g.a)(0===N)}}catch(e){O=!0,T=e}finally{try{I||null==C.return||C.return()}finally{if(O)throw T}}return new r(n,i,u,c,l,d,f,h,p,m,v,y,b)}},{key:"empty",value:function(){return new r(0,0,0,0,0,0,0,0,0,0,0,0,[])}}],(t=null)&&An(e.prototype,t),n&&An(e,n),r}();function On(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pn=function(){var e,t,n;function r(e,t,n){On(this,r),this.type=e,this.length=t,this.data=void 0,this.data=new o.a(n.slice(t))}return e=r,n=[{key:"empty",value:function(e){return new r(e,0,new o.a(new Uint8Array))}},{key:"fromStream",value:function(e){return new r(e.readString(16),e.read32(),e)}}],(t=null)&&Tn(e.prototype,t),n&&Tn(e,n),r}();function Cn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Nn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Dn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandLoader=t}var t,n,r,i,a;return t=e,(n=[{key:"populateWorld",value:(i=regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l,d,f,h,p,m,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Math.max.apply(Math,Cn(t.islands.map((function(e){return e.id}))).concat([-1]))+1,i=!0,a=!1,o=void 0,e.prev=4,s=n.islandTemplates[Symbol.iterator]();case 6:if(i=(u=s.next()).done){e.next=46;break}if(65535!==(c=u.value).numBaseIsland){e.next=14;break}return e.next=11,this.islandLoader.loadRandomIslandFile(c.size,c.climate);case 11:e.t0=e.sent,e.next=20;break;case 14:return e.t1="SOUTH"===c.climate,e.t2=c.numBaseIsland,e.next=18,this.islandLoader.loadIslandFileNum({isSouth:"SOUTH"===c.climate,numBaseIsland:c.numBaseIsland,size:c.size});case 18:e.t3=e.sent,e.t0={isSouth:e.t1,id:e.t2,data:e.t3};case 20:for(l=e.t0,d=l.data,f=l.isSouth,h=l.id,p=[];!d.eof();)p.push(Pn.fromStream(d));m=p.find((function(e){return["INSEL5","INSEL4","INSEL3"].includes(e.type)})),Object(g.a)(void 0!==m),v=p.find((function(e){return"INSELHAUS"===e.type})),Object(g.a)(void 0!==v),y=void 0,e.t4=m.type,e.next="INSEL5"===e.t4?34:"INSEL4"===e.t4?36:"INSEL3"===e.t4?38:40;break;case 34:return y=fn(r++,c.position,f,h,m.data),e.abrupt("break",41);case 36:return y=dn(r++,c.position,f,h,m.data),e.abrupt("break",41);case 38:return y=ln(r++,c.position,f,h,m.data),e.abrupt("break",41);case 40:throw new Error("This code cannot be reached.");case 41:this.islandLoader.setIslandFields(y,[v]),t.islands.push(y);case 43:i=!0,e.next=6;break;case 46:e.next=52;break;case 48:e.prev=48,e.t5=e.catch(4),a=!0,o=e.t5;case 52:e.prev=52,e.prev=53,i||null==s.return||s.return();case 55:if(e.prev=55,!a){e.next=58;break}throw o;case 58:return e.finish(55);case 59:return e.finish(52);case 60:case"end":return e.stop()}}),e,this,[[4,48,52,60],[53,,55,59]])})),a=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){Nn(a,n,r,o,s,"next",e)}function s(e){Nn(a,n,r,o,s,"throw",e)}o(void 0)}))},function(e,t){return a.apply(this,arguments)})}])&&Gn(t.prototype,n),r&&Gn(t,r),e}();function jn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Fn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandId=void 0,this.position=void 0,this.inhabitantLevel=void 0}var t,n,r;return t=e,r=[{key:"load",value:function(t){var n=new e;return n.islandId=t.read8(),n.position=new a.Point(t.read8(),t.read8()),t.read8(),t.read8(),n.inhabitantLevel=t.read8(),t.read8(),t.read8(),t.read16(),t.read8(),t.read8(),t.read32(),n}}],(n=null)&&jn(t.prototype,n),r&&jn(t,r),e}();function Ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Mn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandId=void 0,this.position=void 0,this.playerId=void 0,this.goods=void 0}var t,n,r;return t=e,r=[{key:"load",value:function(t){var n=new e;return n.islandId=t.read8(),n.position=new a.Point(t.read8(),t.read8()),n.playerId=t.read8(),n.goods=e.parseGoods(t),n}},{key:"parseGoods",value:function(e){for(var t=[],n=0;n<2;n++)ve.fromSaveGame(e);for(var r=2;r<25;r++)t.push(ve.fromSaveGame(e,Ke.NOWARE+r));for(var i=25;i<50;i++)ve.fromSaveGame(e);return t}}],(n=[{key:"save",value:function(e){throw new Error("Not implemented")}}])&&Ln(t.prototype,n),r&&Ln(t,r),e}();function Hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Bn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandId=void 0,this.position=void 0,this.cntGrowthTimerIdx=void 0,this.lastGrowthCntWhenFieldHasGrown=void 0,this.animCnt=void 0}var t,n,r;return t=e,r=[{key:"load",value:function(t){var n=new e;return n.islandId=t.read8(),n.position=new a.Point(t.read8(),t.read8()),n.cntGrowthTimerIdx=t.read8(),Object(g.a)(n.cntGrowthTimerIdx>=0&&n.cntGrowthTimerIdx<=32),n.lastGrowthCntWhenFieldHasGrown=t.read8(),n.animCnt=t.read8(),Object(g.a)(0===t.read16()),n}}],(n=[{key:"save",value:function(e){throw new Error("Not implemented")}}])&&Hn(t.prototype,n),r&&Hn(t,r),e}();function Un(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Wn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Kn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Wn(a,r,i,o,s,"next",e)}function s(e){Wn(a,r,i,o,s,"throw",e)}o(void 0)}))}}function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Zn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandLoader=t,this.worldGenerator=void 0,this.worldGenerator=t?new Dn(t):null}var t,n,r,i,a,o;return t=e,(n=[{key:"parse",value:function(e){for(var t=new Map;!e.eof();){var n=Pn.fromStream(e);if("INSELHAUS"!==n.type)t.has(n.type)||t.set(n.type,[]),t.get(n.type).push(n);else{var r=t.get("INSEL5")[t.get("INSEL5").length-1];void 0===r.inselHausBlocks&&(r.inselHausBlocks=[]),r.inselHausBlocks.push(n)}}return t}},{key:"getWorld",value:(o=Kn(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parse(t),e.next=3,this.doParse(n);case 3:return r=e.sent,i=r.world,a=r.worldGenerationSettings,e.next=8,this.worldGenerator.populateWorld(i,a);case 8:return i.log(),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"doParse",value:(a=Kn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f,h,p,m,v,b,w,x,k,E;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(Un(t.keys()).filter((function(e){return void 0!==t.get(e).find((function(e){return e.length>0}))})).map((function(e){return[e,t.get(e)]}))),n="",t.has("NAME")&&(r=t.get("NAME")[0],n=r.data.readString(r.length)),i=t.get("PLAYER4")[0],a=this.parsePlayers(i),o=t.has("INSEL5")?t.get("INSEL5"):[],e.next=8,this.parseIslands(o);case 8:return s=e.sent,u=this.handleBlock(t,"AUFTRAG4",Rn),c=this.handleBlock(t,"SHIP4",D),l=this.handleBlock(t,"SOLDAT3",Sn),d=this.handleBlock(t,"KONTOR2",Mn.load),f=this.handleBlock(t,"MILITAR",rn),h=this.handleBlock(t,"STADT4",an),p=this.handleBlock(t,"PRODLIST2",En.load),m=this.handleBlock(t,"SIEDLER",Fn.load),(v=this.handleBlock(t,"ROHWACHS2",Bn.load)).forEach((function(e){var t=s.find((function(t){return t.id===e.islandId}));Object(g.a)(t),e.animCnt=t.fields[e.position.x][e.position.y].ani})),b=null,t.has("HANDLER")&&t.get("HANDLER")[0].length>0&&(S=t.get("HANDLER")[0].data,R=void 0,_=void 0,A=void 0,I=void 0,R=S.read32(),_=S.read(20),A=function(e){for(var t=[],n=0;n<24;n++)t.push({goodId:e.read32(),_1:e.read32(),_2:e.read32()});return t}(S),I=S.read(292),console.log("trader",R,_,A,I),b={goods:A}),Object(g.a)(t.has("TIMERS")),Object(g.a)(1===t.get("TIMERS").length),w=_n(t.get("TIMERS")[0].data),x=In.empty(),t.has("SZENE")&&(k=t.get("SZENE")[0].data,x=In.fromSaveGame(k)),E=new y(s,a,u,n,l,c,d,f,h,b,w,p,m,v),e.abrupt("return",{world:E,worldGenerationSettings:x});case 28:case"end":return e.stop()}var S,R,_,A,I}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"handleBlock",value:function(e,t,n){if(!e.has(t))return[];var r=[],i=!0,a=!1,o=void 0;try{for(var s,u=e.get(t)[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)for(var c=s.value;!c.data.eof();)r.push(n(c.data))}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return r}},{key:"parseIslands",value:(i=Kn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],this.islandLoader){e.next=3;break}return e.abrupt("return",n);case 3:r=!0,i=!1,a=void 0,e.prev=6,o=t[Symbol.iterator]();case 8:if(r=(s=o.next()).done){e.next=32;break}if(u=s.value,c=hn(u.data),l=void 0!==u.inselHausBlocks?u.inselHausBlocks:[],d=Pn.empty("INSELHAUS"),f=void 0,c.differsFromBaseIsland||!(l.length<=1)){e.next=24;break}return 1===l.length&&(d=l[0]),e.next=18,this.islandLoader.loadIslandFile(c);case 18:h=e.sent,Pn.fromStream(h),f=Pn.fromStream(h),Object(g.a)("INSELHAUS"===f.type),e.next=27;break;case 24:Object(g.a)(l.length>=1&&l.length<=2),f=l[0],2===l.length&&(d=l[1]);case 27:this.islandLoader.setIslandFields(c,[f,d]),n.push(c);case 29:r=!0,e.next=8;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(6),i=!0,a=e.t0;case 38:e.prev=38,e.prev=39,r||null==o.return||o.return();case 41:if(e.prev=41,!i){e.next=44;break}throw a;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.abrupt("return",n);case 47:case"end":return e.stop()}}),e,this,[[6,34,38,46],[39,,41,45]])}))),function(e){return i.apply(this,arguments)})},{key:"parsePlayers",value:function(e){for(var t=[];!e.data.eof();)t.push(wn(e.data));return t}}])&&zn(t.prototype,n),r&&zn(t,r),e}();function Vn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function qn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Vn(a,r,i,o,s,"next",e)}function s(e){Vn(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xn=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.menuStructure=n,this.translator=r,this.buttons=[this.renderNewGame.bind(this),this.renderLoadGame.bind(this),function(){var e=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.menuStructure.renderScreen(t,"menu_loading");case 2:i.menuStructure.emit("load-game","/saves/lastgame.gam");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.menuStructure.renderScreen(t,"menu_main"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.currentPage=Math.max(0,i.currentPage-1),e.next=3,i.renderNewGame(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.currentPage=Math.min(Math.ceil(i.newGameLines.length/i.ROWS)-1,i.currentPage+1),e.next=3,i.renderNewGame(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()],this.texts=[],this.ignore=[],this.ROWS=14,this.SCROLL_UP="menu-31011",this.SCROLL_DOWN="menu-31012",this.newGameLines=[],this.currentPage=0,this.gamParser=void 0,this.gamParser=new Zn(null)}var t,n,r,i,a,o,s,u;return t=e,(n=[{key:"onLoad",value:(u=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNewGameLines();case 2:return e.next=4,this.renderNewGame(t);case 4:return e.next=6,this.menuStructure._playMainMenuMusic();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"renderNewGame",value:(s=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.currentPage*this.ROWS,r=0;r<this.ROWS;r++)(i=t.getChildByName("menu-".concat(31021+r))).off("click"),i.visible=!1,i.interactive=!1,i.buttonMode=!1,r+n<this.newGameLines.length&&function(){var e=s.newGameLines[r+n];i.text=e.name,i.visible=!0,e.file&&(i.interactive=!0,i.buttonMode=!0,i.once("click",qn(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.menuStructure.renderScreen(t,"menu_loading");case 2:s.menuStructure.emit("load-game",e.file.fullPath);case 3:case"end":return n.stop()}}),n)})))))}();for(a=0;a<this.ROWS;a++)t.getChildByName("menu-".concat(31041+a)).visible=a+n<this.newGameLines.length&&!!this.newGameLines[a+n].file;for(o=0;o<this.ROWS;o++)t.getChildByName("menu-".concat(31061+o)).visible=!1;t.getChildByName(this.SCROLL_UP).visible=!0,t.getChildByName(this.SCROLL_DOWN).visible=!0;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"renderLoadGame",value:(o=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/saves",".gam");case 2:for(e.t0=function(e){return"lastgame.gam"!==e.name},n=e.sent.filter(e.t0),r=function(e){var r=t.getChildByName("menu-".concat(31021+e));r.visible=e<12,e<n.length?(r.text="Game".concat(e.toString().padStart(2,"0")),r.interactive=!0,r.buttonMode=!0,r.once("click",qn(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s.menuStructure.renderScreen(t,"menu_loading");case 2:s.menuStructure.emit("load-game",n[e].fullPath);case 3:case"end":return r.stop()}}),r)}))))):r.text="Empty".concat(e.toString().padStart(2,"0"))},i=0;i<this.ROWS;i++)r(i);for(a=0;a<this.ROWS;a++)t.getChildByName("menu-".concat(31041+a)).visible=!1;for(o=0;o<this.ROWS;o++)t.getChildByName("menu-".concat(31061+o)).visible=o<12;t.getChildByName(this.SCROLL_UP).visible=!1,t.getChildByName(this.SCROLL_DOWN).visible=!1;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getNewGameLines",value:(a=qn(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadMissions();case 2:return t=e.sent,this.newGameLines.push({name:this.translator.translate("menu.divider.orginal_missions")}),t.filter((function(e){return-1!==e.missionNum})).forEach((function(e){n.newGameLines.push({name:e.name,file:e.file})})),this.newGameLines.push({name:this.translator.translate("menu.divider.missions")}),this.newGameLines.push({name:this.translator.translate("menu.divider.new_missions")}),t.filter((function(e){return-1===e.missionNum})).forEach((function(e){n.newGameLines.push({name:e.name,file:e.file})})),this.newGameLines.push({name:this.translator.translate("menu.divider.custom_missions")}),e.next=11,this.fs.ls("/missions-custom",".szs");case 11:e.sent.forEach((function(e){n.newGameLines.push({name:e.name.replace(".szs",""),file:e})}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadMissions",value:(i=qn(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Promise,e.next=3,this.fs.ls("/missions-original",".szs");case 3:return e.t1=function(){var e=qn(regeneratorRuntime.mark((function e(t){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fs.openAndGetContentAsStream(t);case 2:return r=e.sent,i=n.gamParser.parse(r),a=-1,i.has("SZENE_RANKING")&&(Object(g.a)(1===i.get("SZENE_RANKING").length),a=i.get("SZENE_RANKING")[0].data.read32()),o=-1,i.has("SZENE_KAMPAGNE")&&(Object(g.a)(1===i.get("SZENE_KAMPAGNE").length),o=i.get("SZENE_KAMPAGNE")[0].data.read32()),s=-1,i.has("SZENE_MISSNR")&&(Object(g.a)(1===i.get("SZENE_MISSNR").length),s=i.get("SZENE_MISSNR")[0].data.read32()),e.abrupt("return",{blocks:i,ranking:a,campaignNum:o,missionNum:s,name:t.name,file:t});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.t2=e.sent.map(e.t1),e.next=7,e.t0.all.call(e.t0,e.t2);case 7:return(t=e.sent).sort((function(e,t){return-1!==e.missionNum&&-1===t.missionNum?-1:-1===e.missionNum&&-1!==t.missionNum?1:-1!==e.missionNum&&-1!==t.missionNum?e.missionNum<t.missionNum?-1:e.missionNum>t.missionNum?1:0:0})),console.table(t),e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}])&&Yn(t.prototype,n),r&&Yn(t,r),e}();function Jn(e){return(Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $n(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Qn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){$n(a,r,i,o,s,"next",e)}function s(e){$n(a,r,i,o,s,"throw",e)}o(void 0)}))}}function er(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tr(e){return(tr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rr(e,t){return(rr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ir=function(e){function t(e,n,r,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t){return!t||"object"!==Jn(t)&&"function"!=typeof t?nr(e):t}(this,tr(t).call(this))).fs=e,a.gadRenderer=n,a.musicPlayer=r,a.translator=i,a.structure={menu_main:{onLoad:function(){return a._playMainMenuMusic()},buttons:[function(e){return a.renderScreen(e,"menu_missions")},function(){return console.log("Multiplayer")},function(){var e=Qn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.musicPlayer.stop(),e.next=3,a.loadVideoSprite(10);case 3:(n=e.sent).width=439,n.height=353,n.position.set(507,366),a.gadRenderer.renderVideo(t,n,(function(){return a._playMainMenuMusic}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=Qn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.loadVideoSprite(58);case 2:n=e.sent,a.musicPlayer.stop(),a.gadRenderer.renderVideoFullscreen(t,n,(function(){return a.renderScreen(t,"menu_main")}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){return console.log("Exit")}],texts:[],ignore:[]},menu_missions:new Xn(a.fs,nr(a),a.translator),menu_loading:{onLoad:function(){},buttons:[],texts:[],ignore:[]},menu_mission_details:{onLoad:function(){},buttons:[function(){return console.log("Start Mission")},function(e){return a.renderScreen(e,"menu_missions")},function(){return console.log("Highscores up")},function(){return console.log("Highscores down")},function(){return console.log("Sub-Mission 0")},function(){return console.log("Sub-Mission 1")},function(){return console.log("Sub-Mission 2")},function(){return console.log("Sub-Mission 3")},function(){return console.log("Sub-Mission 4")},function(){return console.log("Mission Description up")},function(){return console.log("Mission Description down")},function(){return console.log("Mission Description Slider")}],texts:[],ignore:[]}},a}var n,r,i,o,s,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rr(e,t)}(t,e),n=t,(r=[{key:"renderScreen",value:(u=Qn(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.fs.openAndGetContentAsText("/screens/".concat(n,".json"));case 3:return e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),console.log(i),a=r||this.structure[n]||{onLoad:function(){},buttons:[],texts:{},ignore:[]},this.gadRenderer.clear(t),e.next=10,this.gadRenderer.render(t,i,a);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"_playMainMenuMusic",value:(s=Qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.musicPlayer.play("1st Beginning",!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"loadVideoSprite",value:(o=Qn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.openAndGetContentAsUint8Array("/videos/".concat(t,".mp4"));case 2:return n=e.sent,e.t0=a.Sprite,e.next=6,Jt(n);case 6:return e.t1=e.sent,e.abrupt("return",e.t0.from.call(e.t0,e.t1));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}])&&er(n.prototype,r),i&&er(n,i),t}(a.utils.EventEmitter);function ar(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function or(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){ar(a,r,i,o,s,"next",e)}function s(e){ar(a,r,i,o,s,"throw",e)}o(void 0)}))}}function sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ur=n("9/1U").a.Sound,cr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.playing=!1,this.songs=[],this.currentSongIdx=void 0}var t,n,r,i,a,o,s;return t=e,(n=[{key:"load",value:(s=or(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/music");case 2:t=e.sent,n=!0,r=!1,i=void 0,e.prev=6,a=t[Symbol.iterator]();case 8:if(n=(o=a.next()).done){e.next=25;break}return s=o.value,console.log("Loading music ".concat(s.name)),e.next=13,this.fs.openAndGetContentAsUint8Array(s);case 13:return u=e.sent.buffer,e.t0=this.songs,e.t1=s.name,e.next=18,this.loadSound(u);case 18:e.t2=e.sent,e.t3={name:e.t1,sound:e.t2},e.t0.push.call(e.t0,e.t3),console.log("Finished loading music ".concat(s.name));case 22:n=!0,e.next=8;break;case 25:e.next=31;break;case 27:e.prev=27,e.t4=e.catch(6),r=!0,i=e.t4;case 31:e.prev=31,e.prev=32,n||null==a.return||a.return();case 34:if(e.prev=34,!r){e.next=37;break}throw i;case 37:return e.finish(34);case 38:return e.finish(31);case 39:case"end":return e.stop()}}),e,this,[[6,27,31,39],[32,,34,38]])}))),function(){return s.apply(this,arguments)})},{key:"play",value:(o=or(regeneratorRuntime.mark((function e(t){var n,r,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],void 0!==(r=this.songs.find((function(e){return e.name===t+".wav"})))){e.next=5;break}return console.warn("Song ".concat(t," not found.")),e.abrupt("return");case 5:if(r.sound.isPlaying){e.next=8;break}return e.next=8,r.sound.play({loop:n});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"playAll",value:(a=or(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.songs.length){e.next=3;break}return console.warn("No music to play found :("),e.abrupt("return");case 3:if(!this.playing){e.next=6;break}return console.warn("Music is already playing!"),e.abrupt("return");case 6:return this.stop(),this.playing=!0,this.currentSongIdx=-1,e.next=11,this.playNext();case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"stop",value:function(){this.songs.forEach((function(e){return e.sound.stop()}))}},{key:"playNext",value:(i=or(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentSongIdx++,this.currentSongIdx===this.songs.length&&(this.currentSongIdx=0),e.next=4,this.songs[this.currentSongIdx].sound.play(this.playNext.bind(this));case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,r){var i=ur.from({source:e,preload:t,singleInstance:!0,loaded:function(e,i){t&&(e?r(e):n(i))}});t||n(i)}))}}])&&sr(t.prototype,n),r&&sr(t,r),e}();function lr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var dr=function(){var e,t,n;function r(e,t,n,i,a,o,s,u,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.fieldId=e,this.x=t,this.y=n,this.islandId=i,this.islandCityNum=a,this.rotation=o,this.ani=s,this.random=u,this.playerId=c}return e=r,n=[{key:"load",value:function(e){var t=e.read16()+2e4,n=e.read8(),i=e.read8(),a=e.read32(),o=a>>0&Math.pow(2,2)-1,s=a>>2&Math.pow(2,4)-1,u=a>>6&Math.pow(2,8)-1,c=a>>14&Math.pow(2,3)-1,l=a>>17&Math.pow(2,5)-1,d=a>>22&Math.pow(2,4)-1;return Math.pow(2,6),new r(t,n,i,u,c,o,s,l,d)}}],(t=null)&&lr(e.prototype,t),n&&lr(e,n),r}();function fr(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function hr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function pr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){hr(a,r,i,o,s,"next",e)}function s(e){hr(a,r,i,o,s,"throw",e)}o(void 0)}))}}function mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}dr.saveGameDataLength=8;var gr=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.fieldData=n,this.islandSizes=[{id:0,name:"lit",maxSize:35},{id:1,name:"mit",maxSize:45},{id:2,name:"med",maxSize:55},{id:3,name:"big",maxSize:85},{id:4,name:"lar",maxSize:100}]}var t,n,r,i,a,o,s,u;return t=e,(n=[{key:"loadIslandFile",value:(u=pr(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.isSouth?"south":"north",r=t.numBaseIsland.toString().padStart(2,"0"),i=!0,a=!1,o=void 0,e.prev=5,s=this.islandSizes[Symbol.iterator]();case 7:if(i=(u=s.next()).done){e.next=14;break}if(c=u.value,!(t.size.x<=c.maxSize)){e.next=11;break}return e.abrupt("return",this.fs.openAndGetContentAsStream("/islands/".concat(n,"/").concat(c.name).concat(r,".scp")));case 11:i=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),a=!0,o=e.t0;case 20:e.prev=20,e.prev=21,i||null==s.return||s.return();case 23:if(e.prev=23,!a){e.next=26;break}throw o;case 26:return e.finish(23);case 27:return e.finish(20);case 28:throw new Error("Could not load island");case 29:case"end":return e.stop()}}),e,this,[[5,16,20,28],[21,,23,27]])}))),function(e){return u.apply(this,arguments)})},{key:"loadIslandFileNum",value:(s=pr(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.isSouth?"south":"north",r=t.numBaseIsland.toString().padStart(2,"0"),i=this.islandSizes.find((function(e){return e.id===t.size})),e.abrupt("return",this.fs.openAndGetContentAsStream("/islands/".concat(n,"/").concat(i.name).concat(r,".scp")));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"loadIslandFileByName",value:(o=pr(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fs.openAndGetContentAsStream("/islands/".concat(t,".scp")));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"loadRandomIslandFile",value:(a=pr(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(r=this.islandSizes.find((function(e){return e.id===t})))){e.next=3;break}throw new Error("This should never happen.");case 3:if(i=[],!["ANY","NORTH"].includes(n)){e.next=13;break}return e.t0=i.push,e.t1=i,e.t2=fr,e.next=10,this.loadIslandsWithSizeAndClimate(r.name,"north");case 10:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 13:if(!["ANY","SOUTH"].includes(n)){e.next=22;break}return e.t5=i.push,e.t6=i,e.t7=fr,e.next=19,this.loadIslandsWithSizeAndClimate(r.name,"south");case 19:e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t5.apply.call(e.t5,e.t6,e.t9);case 22:return a=i[Math.floor(Math.random()*i.length)],e.next=25,this.fs.openAndGetContentAsStream(a.file.fullPath);case 25:return e.t10=e.sent,e.t11="south"===a.climate,e.t12=a.id,e.abrupt("return",{data:e.t10,isSouth:e.t11,id:e.t12});case 29:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"setIslandFields",value:function(e,t){e.fields=[];for(var n=0;n<e.size.x;n++)e.fields.push(new Array(e.size.y).fill(null));var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)for(var u=o.value,c=this.parseIslandFields(e,u),l=0;l<e.size.x;l++)for(var d=0;d<e.size.y;d++){var f=c[l][d];null!==f&&(e.fields[l][d]=f)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"parseIslandFields",value:function(e,t){for(var n=t.data,r=t.length,i=[],a=0;a<e.size.x;a++)i.push(new Array(e.size.y).fill(null));for(var o=0;o<r/dr.saveGameDataLength;o++){var s=dr.load(n);Object(g.a)(s.x<e.size.x),Object(g.a)(s.y<e.size.y),i[s.x][s.y]=s}return i}},{key:"loadIslandsWithSizeAndClimate",value:(i=pr(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/islands/".concat(n));case 2:return e.t0=function(e){return e.name.startsWith(t)},e.t1=function(e){return null!==/\d\d\.scp$/.exec(e.name)},e.t2=function(e){return{file:e,climate:n,id:parseInt(e.name.substr(3,2),10)}},e.abrupt("return",e.sent.filter(e.t0).filter(e.t1).map(e.t2));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})}])&&mr(t.prototype,n),r&&mr(t,r),e}();function vr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function yr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function br(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){yr(a,r,i,o,s,"next",e)}function s(e){yr(a,r,i,o,s,"throw",e)}o(void 0)}))}}var wr=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.textures=new Map,this.lock=new Kt.a,this.getTextures=function(){var e=br(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="/gfx/".concat(t),e.next=3,n.lock.acquire(t,br(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.textures.has(t)){e.next=3;break}return e.next=3,n.loadTextures(t);case 3:case"end":return e.stop()}}),e)}))));case 3:return e.abrupt("return",n.textures.get(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadTextures=function(){var e=br(regeneratorRuntime.mark((function e(t){var r,i,o,s,u,c,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,e.next=3,n.fs.ls(t);case 3:i=e.sent,o=!0,s=!1,u=void 0,e.prev=7,c=i[Symbol.iterator]();case 9:if(o=(l=c.next()).done){e.next=17;break}if(d=l.value,"png"!==d.name.substr(d.name.lastIndexOf(".")+1)){e.next=14;break}return e.delegateYield(regeneratorRuntime.mark((function e(){var t,i,o,s,u,c,l,f,h,p,m,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.fullPath.substring(0,d.fullPath.lastIndexOf("."))+".json",e.t0=JSON,e.next=4,n.fs.openAndGetContentAsText(t);case 4:return e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),e.next=8,n.fs.openAndGetContentAsUint8Array(d);case 8:return o=e.sent,v=o,s=a.Texture.from("data:image/png;base64,".concat(Object(R.e)(v))),u=new a.Spritesheet(s.baseTexture,i),e.next=13,new Promise((function(e){u.parse((function(t){return e(t)}))}));case 13:for(c=e.sent,l=0,f=Object.entries(c);l<f.length;l++)h=vr(f[l],2),p=h[0],m=h[1],g=p.split("|")[1],r.set(parseInt(g,10),m);case 15:case"end":return e.stop()}var v}),e)}))(),"t0",14);case 14:o=!0,e.next=9;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(7),s=!0,u=e.t1;case 23:e.prev=23,e.prev=24,o||null==c.return||c.return();case 26:if(e.prev=26,!s){e.next=29;break}throw u;case 29:return e.finish(26);case 30:return e.finish(23);case 31:n.textures.set(t,r);case 32:case"end":return e.stop()}}),e,null,[[7,19,23,31],[24,,26,30]])})));return function(t){return e.apply(this,arguments)}}()},xr=n("q1tI"),kr=n("i8i4"),Er=n("/ia5");function Sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Rr=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.root=void 0,this.root={x:0,y:0,w:t,h:n}}var t,n,r;return t=e,(n=[{key:"addBlock",value:function(e){var t=this.findNode(this.root,e.w,e.h);return!!t&&this.splitNode(t,e.w,e.h)}},{key:"findNode",value:function(e,t,n){return e.used?this.findNode(e.right,t,n)||this.findNode(e.down,t,n):t<=e.w&&n<=e.h?e:null}},{key:"splitNode",value:function(e,t,n){return e.used=!0,e.down={x:e.x,y:e.y+n,w:e.w,h:e.h-n},e.right={x:e.x+t,y:e.y,w:e.w-t,h:n},e}}])&&Sr(t.prototype,n),r&&Sr(t,r),e}();function _r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ar=n("V4eY"),Ir=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=void 0,this.height=void 0,this.pixels=void 0,this.width=t,this.height=n,this.pixels=r}var t,n,r;return t=e,(n=[{key:"toPNG",value:function(){return Ar.encode([this.pixels.buffer],this.width,this.height)}}])&&_r(t.prototype,n),r&&_r(t,r),e}();function Or(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Tr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Or(a,r,i,o,s,"next",e)}function s(e){Or(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Cr=n("V4eY"),Nr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.SPRITESHEET_SIZE=2048,this.HEADER_SIZE=20,this.log=void 0,this.log=r.getLogger("bsh-parser")}var t,n,i,a,o,s,u,c;return t=e,(n=[{key:"decodeBSH",value:(c=Tr(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.decode(t,"BSH"));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"decodeZEI",value:(u=Tr(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.decode(t,"ZEI"));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"createSpriteSheets",value:function(e,t){Object(g.a)(!e.includes("|"));for(var n=[],r=new Rr(this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),i=new Uint8Array(this.SPRITESHEET_SIZE*this.SPRITESHEET_SIZE*4),a={meta:{},frames:{}},o=0;o<t.length;o++){var s=t[o],u=r.addBlock({w:s.width,h:s.height});if(!1===u&&(n.push({png:Cr.encode([i.buffer],this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),config:a}),r=new Rr(this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),i=new Uint8Array(this.SPRITESHEET_SIZE*this.SPRITESHEET_SIZE*4),a={meta:{},frames:{}},u=r.addBlock({w:s.width,h:s.height})),!u)throw new Error("Could not add image to empty spritesheet!");for(var c=u.x,l=u.y,d=0,f=0;f<s.height;f++)for(var h=0;h<s.width;h++){var p=4*(c+h+this.SPRITESHEET_SIZE*f+this.SPRITESHEET_SIZE*l);i[p+0]=s.pixels[4*d+0],i[p+1]=s.pixels[4*d+1],i[p+2]=s.pixels[4*d+2],i[p+3]=s.pixels[4*d+3],d++}a.frames["".concat(e,"|").concat(o)]={frame:{x:c,y:l,w:s.width,h:s.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:s.width,h:s.height},sourceSize:{w:s.width,h:s.height}}}return n.push({png:Cr.encode([i.buffer],this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),config:a}),n}},{key:"saveSpriteSheets",value:(s=Tr(regeneratorRuntime.mark((function e(t,n,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.mkdir(r);case 2:i=0;case 3:if(!(i<n.length)){e.next=9;break}return e.next=6,this.saveSpriteSheet(t,n[i],i,r);case 6:i++,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"encodeBSH",value:function(e){var t=this,n=new Er.SmartBuffer;return n.writeString("BSH".padEnd(16,"\0"),"ascii"),n.writeUInt32LE(42),e.forEach((function(){return n.writeUInt32LE(42)})),e.forEach((function(e,r){var i=t.encodeImage(e).toBuffer();n.writeUInt32LE(n.writeOffset-t.HEADER_SIZE,20+4*r),n.writeBuffer(i)})),n.writeUInt32LE(n.length-this.HEADER_SIZE,16),n.toBuffer()}},{key:"decode",value:(o=Tr(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.readString(16),Object(g.a)(r===n),i=t.read32(),Object(g.a)(this.HEADER_SIZE+i===t.length),(a=[]).push(t.read32()),o=a[0]/4,s=1;s<o;s++)a.push(t.read32());for(u=[],c=0;c<o;c++)t.seek(a[c]+this.HEADER_SIZE),null!==(l=this.decodeImage(t,n))&&u.push(l);return e.abrupt("return",u);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"decodeImage",value:function(e,t){var n=e.read32(),r=e.read32();e.read32(),e.read32(),Object(g.a)(n>0),Object(g.a)(r>0);for(var i=new Uint8Array(n*r*4),a=0,o=0;;){var s=e.read8();if(255===s)break;if(254===s)o=++a*n*4;else{o+=4*s;for(var u=e.read8(),c=0;c<u;c++){var l=e.read8();if("BSH"===t)i[o++]=jt[3*l],i[o++]=jt[3*l+1],i[o++]=jt[3*l+2];else if("ZEI"===t){Object(g.a)(1===l||7===l);var d=1===l?255:0;i[o++]=d,i[o++]=d,i[o++]=d}else Object(R.a)(t);i[o++]=255}}}return new Ir(n,r,i)}},{key:"encodeImage",value:function(e){var t=new Er.SmartBuffer;t.writeUInt32LE(e.width).writeUInt32LE(e.height).writeUInt32LE(1).writeUInt32LE(42);for(var n=0,r=0;r<e.height;r++){for(var i=0,a=[],o="empty",s=0;s<e.width;s++){var u=(e.pixels[4*(r*e.width+s)+0]<<24)+(e.pixels[4*(r*e.width+s)+1]<<16)+(e.pixels[4*(r*e.width+s)+2]<<8)+(e.pixels[4*(r*e.width+s)+3]<<0);if(0===u){if("empty"===o)i++;else if("colored"===o){for(;n>0;)t.writeUInt8(254),n--;for(;i>253;)t.writeUInt8(253),t.writeUInt8(0),i-=253;t.writeUInt8(i);for(var c=0;c<a.length;c+=255){var l=a.slice(c,c+255);c>0&&t.writeUInt8(0),t.writeUInt8(l.length),l.forEach((function(e){var n=Mt[e];t.writeUInt8(n)}))}i=1,a=[]}o="empty"}else o="colored",a.push(u)}if("colored"===o){for(;n>0;)t.writeUInt8(254),n--;for(;i>253;)t.writeUInt8(253),t.writeUInt8(0),i-=253;t.writeUInt8(i);for(var d=0;d<a.length;d+=255){var f=a.slice(d,d+255);d>0&&t.writeUInt8(0),t.writeUInt8(f.length),f.forEach((function(e){t.writeUInt8(Mt[e.toString()])}))}}n++}t.writeUInt8(255);for(var h=(4-t.length%4)%4,p=0;p<h;p++)t.writeUInt8(0);return t.writeUInt32LE(t.length,12),t}},{key:"saveSpriteSheet",value:(a=Tr(regeneratorRuntime.mark((function e(t,n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.write("".concat(i,"/sprite-sheet-").concat(r,".png"),n.png);case 2:return e.next=4,t.write("".concat(i,"/sprite-sheet-").concat(r,".json"),JSON.stringify(n.config));case 4:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return a.apply(this,arguments)})}])&&Pr(t.prototype,n),i&&Pr(t,i),e}(),Gr=n("daKf");function Dr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jr(e){return(jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Lr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Mr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.log=void 0,this.variables=void 0,this.objects=void 0,this.template=void 0,this.gfxMap=void 0,this.lastGfxName=void 0,this.currentObject=void 0,this.currentNestedObject=void 0,this.currentItem=void 0,this.currentNestedItem=void 0,this.log=r.getLogger("dat-parser")}var t,n,i;return t=e,(n=[{key:"parse",value:function(e,t){this.variables=new Map(t||[]),this.objects={},this.template=null,this.gfxMap=new Map,this.lastGfxName=null,this.currentObject=null,this.currentNestedObject=null,this.currentItem=null,this.currentNestedItem=0;var n=!0,r=!1,i=void 0;try{for(var a,o=e.split("\n")[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(0!==(s=s.split(";")[0].trim()).length&&!(s.startsWith("Nahrung:")||s.startsWith("Soldat:")||s.startsWith("Turm:")))if('Include: "TOOLS.INC"'!==s){var u=void 0;if(u=/^(@?)(\w+)\s*=\s*((?:\d+|\+|\w+)+)$/.exec(s))this.handleConstantAssignment(u);else if(u=/^ObjFill:\s*([\w,]+)$/.exec(s))this.handleObjFill(u);else if(u=/^Objekt:\s*(\w+)$/.exec(s))this.handleNestedObjectBegin(u);else if("EndObj"!==s){if(!(u=/^(@?)(\w+):\s*(.*?)\s*$/.exec(s)))throw new Error("Could not parse: "+s);this.handleProperty(u)}else this.handleNestedObjectEnd()}else Object(g.a)(t&&t.size>0)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return{variables:this.mapToObject(this.variables),objects:this.objects,gfx_category_map:this.mapToObject(this.gfxMap)}}},{key:"handleObjFill",value:function(e){Object(g.a)(null!=this.currentObject),Object(g.a)(null!=this.currentItem);var t=e[1],n=this.objects[this.currentObject].items[this.currentItem];if(t.startsWith("0,MAX"))Object(g.a)(null===this.template),this.template=n;else{Object(g.a)(Object.prototype.hasOwnProperty.call(n,"nested_objects"));var r=this.getValue(null,t,!1),i=this.objects[this.currentObject].items[r];this.objects[this.currentObject].items[this.currentItem]=this.deepCopy(i),null!=this.lastGfxName&&(n.GfxCategory=this.lastGfxName)}}},{key:"handleConstantAssignment",value:function(e){var t=e[1].length>0,n=e[2],r=e[3];if(n.startsWith("GFX"))if("0"===r)this.gfxMap.set(n,n);else if(r.startsWith("GFX")){var i=r.split("+")[0];this.gfxMap.has(i)&&this.gfxMap.set(n,this.gfxMap.get(i))}this.variables.set(n,this.getValue(n,r,t))}},{key:"handleNestedObjectBegin",value:function(e){var t=e[1];if(null===this.currentObject)this.currentObject=t,this.objects[t]={items:{}};else{if(null!==this.currentNestedObject)throw new Error("It appears like there is more than one nesting level. This is not supported by this parser.");Object(g.a)(null!==this.currentItem),this.currentNestedObject=t,this.currentNestedItem=0;var n=this.objects[this.currentObject].items[this.currentItem];void 0!==n.nested_objects[this.currentNestedObject]&&void 0!==n.nested_objects[this.currentNestedObject][this.currentNestedItem]||(n.nested_objects[this.currentNestedObject]=Fr({},this.currentNestedItem,{}))}}},{key:"handleNestedObjectEnd",value:function(){if(null!==this.currentNestedObject)this.currentNestedObject=null,this.currentNestedItem=null;else{if(null===this.currentObject)throw new Error("Received EndObj without current object!");this.currentObject=null,this.currentItem=null}}},{key:"handleProperty",value:function(e){var t=e[1].length>0,n=e[2],r=e[3],i=this.deepCopy(this.getValue(n,r,t));if(this.variables.set(n,i),"Nummer"!==n){var a=this.objects[this.currentObject].items[this.currentItem];if("Gfx"===n&&r.startsWith("GFX")&&(this.lastGfxName=r.split("+")[0]),null==this.currentNestedObject)a[n]=i,null!=this.lastGfxName&&(a.GfxCategory=this.lastGfxName,a.GfxCategoryMapped=this.gfxMap.get(this.lastGfxName));else{var o=a.nested_objects[this.currentNestedObject][this.currentNestedItem];Object.keys(o).includes(n)&&this.isObject(o[n])?o[n]=this.deepMerge(o[n],i):o[n]=i}}else if(null===this.currentNestedObject){if(this.currentItem=i,this.objects[this.currentObject].items[this.currentItem]={nested_objects:{}},null!==this.template){var s=this.deepCopy(this.template);this.objects[this.currentObject].items[this.currentItem]=this.deepMerge(s,this.objects[this.currentObject].items[this.currentItem])}}else this.currentNestedItem=i,this.objects[this.currentObject].items[this.currentItem].nested_objects[this.currentNestedObject][this.currentNestedItem]={}}},{key:"getValue",value:function(e,t,n){var r,i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;if(n&&(r=/^([+-])(\d+)$/.exec(t))){var o=this.variables.has(e)?this.deepCopy(this.variables.get(e)):null;if("RUINE_KONTOR_1"===o.toString()&&(o=424242),a>-1&&(o="Size"===e?o[0===a?"x":"y"]:o[a]),"+"===r[1])return o+parseInt(r[2],10);if("-"===r[1])return o-parseInt(r[2],10);throw new Error("This code should not be reached.")}if(/^[-+]?\d+$/.exec(t))return parseInt(t,10);if(/^[-+]?\d+\.\d+$/.exec(t))return parseFloat(t);if(r=/^([A-Za-z0-9_]+)(?:\[(\d+)])?$/.exec(t)){var s=r[1],u=r[2],c=this.variables.has(s)?this.deepCopy(this.variables.get(s)):s;return void 0!==u?c[u]:c}if(t.includes(",")){var l=t.split(",").map((function(t,r){return i.getValue(e,t.trim(),n,r)}));if("Size"===e)return{x:l[0],y:l[1]};if("Ware"===e){var d={};return d[l[0]]=l[1],d}return l}if(r=/^([A-z]+(?:\[\d+])?|\d+)([+-])([A-z]+(?:\[\d+])?|\d+)$/.exec(t)){var f=r[2],h=this.getValue(e,r[1],!1),p=this.getValue(e,r[3],!1);return"+"===f?h+p:h-p}throw new Error("This code should not be reached.")}},{key:"deepCopy",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"isObject",value:function(e){return e&&"object"===jr(e)&&!Array.isArray(e)}},{key:"deepMerge",value:function(e,t){var n=this,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dr(n,!0).forEach((function(t){Fr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dr(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return this.isObject(e)&&this.isObject(t)&&Object.keys(t).forEach((function(i){n.isObject(t[i])&&i in e?r[i]=n.deepMerge(e[i],t[i]):Object.assign(r,Fr({},i,t[i]))})),r}},{key:"mapToObject",value:function(e){var t={};return e.forEach((function(e,n){return t[n]=e})),t}}])&&Lr(t.prototype,n),i&&Lr(t,i),e}(),Hr=n("/dzE");function Br(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ur(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Br(a,r,i,o,s,"next",e)}function s(e){Br(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Wr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Kr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ffmpeg=void 0,this.memory=1e8}var t,n,r,i,a;return t=e,(n=[{key:"parse",value:(a=Ur(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Hr.a)();case 2:return this.ffmpeg=e.sent,n=[{data:t,name:"input.smk"}],e.prev=4,r=this.prepareArguments(!0),e.next=8,this.convert(r,n);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(4),"only-one-audio-stream"!==e.t0.message){e.next=20;break}return i=this.prepareArguments(!1),e.next=17,this.convert(i,n);case 17:return e.abrupt("return",e.sent);case 20:throw e.t0;case 21:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return a.apply(this,arguments)})},{key:"prepareArguments",value:function(e){var t=["-i","input.smk"];return e&&t.push.apply(t,["-filter_complex","[0:a]amerge[c]","-map","[c]","-map","0:v:0"]),t.push.apply(t,["-ac","2","-c:v","libx264","-pix_fmt","yuv420p","-preset","ultrafast","-movflags","+faststart","output.mp4"]),t}},{key:"convert",value:(i=Ur(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Converting video with arguments ".concat(t.join(" "))),e.abrupt("return",new Promise((function(e,i){var a="",o=function(e){a+=e+"\n",console.log(e)};r.ffmpeg({arguments:t,files:n,print:o,printErr:o,stdin:function(){},TOTAL_MEMORY:r.memory,noExitRuntime:!1,returnCallback:function(t){a.includes("Cannot find a matching stream for unlabeled input pad 1")?i(new Error("only-one-audio-stream")):1!==t.length?i(new Error("unknown-error")):e(new Uint8Array(t[0].data))}})})));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})}])&&Wr(t.prototype,n),r&&Wr(t,r),e}(),zr=n("B16k");function Zr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Vr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adpcmIndexTable=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],this.adpcmStepTable=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767]}var t,n,r;return t=e,(n=[{key:"decode",value:function(e){var t=new zr.a(e),n=t.fmt.bitsPerSample,r=t.fmt.sampleRate,i=t.fmt.numChannels;if(4!==n)throw new Error("Can only convert .wav files with 4 bits per sample.");if(2!==i)throw new Error("Can only convert .wav files with stereo sound.");for(var a={step_index:0,predictor:0},o={step_index:0,predictor:0},s=t.data.samples,u=new Int16Array(s.length),c=new Int16Array(s.length),l=0;l<s.length;l++)u[l]=this.decodeADPCM_IMA(a,s[l]>>>4),c[l]=this.decodeADPCM_IMA(o,15&s[l]);return{left:u,right:c,sampleRate:r}}},{key:"encode",value:function(e){for(var t=e.left.length,n=new Int16Array(2*t),r=0;r<t;r++)n[2*r+0]=e.left[r],n[2*r+1]=e.right[r];var i=new zr.a;return i.fromScratch(2,e.sampleRate,"16",n),i.toBuffer()}},{key:"av_clip",value:function(e,t,n){return Math.min(Math.max(t,e),n)}},{key:"av_clip_int16",value:function(e){return e+32768&-65536?e>>31^32767:e}},{key:"decodeADPCM_IMA",value:function(e,t){var n=this.adpcmStepTable[e.step_index],r=this.av_clip(e.step_index+this.adpcmIndexTable[t],0,88),i=8&t,a=(2*(7&t)+1)*n>>>3,o=e.predictor;return i?o-=a:o+=a,e.predictor=this.av_clip_int16(o),e.step_index=r,e.predictor}}])&&Zr(t.prototype,n),r&&Zr(t,r),e}();function qr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Yr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Xr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Jr=n("1Y70"),$r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r,i,a;return t=e,(n=[{key:"createBitmapFont",value:(i=regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l,d,f,h,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],i=[],a=0;a<t.length;a++)for(o=t[a],r.push({page:[{_attr:{id:a,file:"data:image/png;base64,".concat(Object(R.e)(new Uint8Array(o.png)))}}]}),s=0,u=Object.entries(o.config.frames);s<u.length;s++)c=qr(u[s],2),l=c[0],d=c[1],f=l.split("|")[1],h=parseInt(f,10)+32,i.push({char:[{_attr:{id:h,x:d.frame.x,y:d.frame.y,width:d.frame.w,height:d.frame.h,xoffset:0,yoffset:0,xadvance:d.frame.w,page:a,chnl:15,letter:String.fromCharCode(h)}}]});return p=Object.values(t[0].config.frames)[0].sourceSize.h,m={font:[{info:[{_attr:{face:n,size:p,padding:"0,0,0,0",spacing:"0,0",italic:"0",bold:"0",stretchH:"100",smooth:"1",aa:"1"}}]},{common:[{_attr:{pages:t.length,lineHeight:p,packed:0}}]},{pages:r},{chars:i}]},e.abrupt("return",Jr(m,{indent:"  "}));case 6:case"end":return e.stop()}}),e)})),a=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){Yr(a,n,r,o,s,"next",e)}function s(e){Yr(a,n,r,o,s,"throw",e)}o(void 0)}))},function(e,t){return a.apply(this,arguments)})}])&&Xr(t.prototype,n),r&&Xr(t,r),e}();function Qr(e){var t={},n=null,r=!0,i=!1,a=void 0;try{for(var o,s=e.split("\r\n")[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n?"[END]"===u?n=null:t[n].push(u):u.startsWith("[")&&(t[n=u.split(/[[\]]/)[1]]=[])}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return t}function ei(e){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ti(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ni(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){ti(a,r,i,o,s,"next",e)}function s(e){ti(a,r,i,o,s,"throw",e)}o(void 0)}))}}function ri(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ii(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ai(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function si(e){return(si=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ui(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ci(e,t){return(ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var li=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==ei(t)&&"function"!=typeof t?ui(e):t}(this,si(t).call(this,e))).info=function(e){n.log(e,"info")},n.warn=function(e){n.log(e,"warn")},n.error=function(e){n.log(e,"error")},n.log=function(e,t){n.setState((function(n){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ii(n,!0).forEach((function(t){ai(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ii(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n,{messages:[{msg:e,type:t}].concat(ri(n.messages.filter((function(e,t){return"info"!==e.type||t<50}))))})}))},n.zipUploaded=function(){var e=ni(regeneratorRuntime.mark((function e(t){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=t.target.files)&&1===r.length){e.next=4;break}return alert("Please select the zipped Anno1602 folder to upload."),e.abrupt("return");case 4:if((i=r[0]).name.endsWith(".zip")){e.next=8;break}return alert("You need to upload a .zip file!"),e.abrupt("return");case 8:return n.setState({isUploading:!0}),e.next=11,n.props.onUploaded(i);case 11:a=e.sent,n.setState({isUploading:!1}),a?(n.info("Upload finished. Please reload the page."),alert("Upload finished. Please reload the page.")):(n.error("The upload failed."),alert("The upload failed."));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.resetFiles=ni(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.onReset();case 2:alert("All files deleted. The page will now refresh."),window.location.reload(!0);case 4:case"end":return e.stop()}}),e)}))),n.state={isUploading:!1,messages:[]},n.props.setLogger(ui(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ci(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){return xr.createElement("div",{style:{marginLeft:"1em",marginRight:"1em",fontFamily:"Arial",maxWidth:"800px",lineHeight:1.4}},xr.createElement("h1",null,"Anno 2018"),xr.createElement("p",null,"Welcome to Anno 2018, an effort to port twenty-year-old Anno 1602 to the browser. This is in early development, however, you can already load your savegames and start new games. Much of the actual simulation is still missing though. For copyright reasons, we can't include the original Anno 1602 files and graphics."," ",xr.createElement("strong",null,"You need your own copy of Anno 1602 for Anno 2018 work.")),xr.createElement("p",null,"The following versions have been tested by us and confirmed to work:"),xr.createElement("ul",null,xr.createElement("li",null,'German "Anno 1602 Köngisedition"'),xr.createElement("li",null,'English "Anno 1602 A.D." from GOG')),xr.createElement("p",null,"Anno 2018 is tested in the latest versions of"," ",xr.createElement("strong",null,"Chrome (preferred, faster) and Firefox")," only. Other browsers ",xr.createElement("em",null,"might")," work, but aren't supported."),xr.createElement("p",null,'To get started, follow these steps. You will need to "upload" your Anno files on this website. Don\'t worry though, the files'," ",xr.createElement("em",null,"never")," leave your PC and are only uploaded into your browser. Once uploaded, the files remain in your browser and will be there when you re-open this website."),xr.createElement("ol",null,xr.createElement("li",null,"Find your Anno 1602 files and zip them. If you are using a version of Anno 1602 which came with a physical CD, copy the videosmk and music8 folders into your Anno 1602 root folder before creating the zip file."),xr.createElement("li",null,"Use the upload button below to upload the zip file. The file should be around 50MB if it doesn't contain music and videos, and around 500MB if it does."),xr.createElement("li",null,xr.createElement("p",null,"Grab a coffee. The upload takes some time. Progress is being logged below. Should anything go wrong, take a look at the error message. It might tell you what to do. If it doesn't, make sure you're using a recent version of Chrome or Firefox. If it is still not working,"," ",xr.createElement("a",{href:"https://reddit.com/u/cmfcmf"},"drop me a note at reddit"),", ",xr.createElement("a",{href:"https://twitter.com/christianmflach"},"twitter"),", or"," ",xr.createElement("a",{href:"https://github.com/cmfcmf/Anno2018"},"create an issue at GitHub"),". Make sure to include the upload progress output."),"Upload:"," ",xr.createElement("input",{type:"file",multiple:!1,accept:".zip",onChange:this.zipUploaded,disabled:this.state.isUploading}))),xr.createElement("h2",null,"Upload Progress ",xr.createElement("small",null,"(newest at the top)")),0===this.state.messages.length&&xr.createElement("p",null,"Nothing yet..."),xr.createElement("div",{style:{fontSize:"10px"}},this.state.messages.map((function(e,t){return xr.createElement("div",{key:t},xr.createElement("span",{style:{color:"info"===e.type?"blue":"warn"===e.type?"orange":"red"}},e.type.toUpperCase()),": ",e.msg)}))),xr.createElement("h2",null,"Uploading custom missions and additional savegames"),xr.createElement("p",null,"Use this button to upload additional missions or savegames after you uploaded the main game:"," ",xr.createElement("input",{type:"file",multiple:!0,accept:".szm,.szs,.gam",onChange:this.props.onSaveOrMissionUploaded})),xr.createElement("h2",null,"Downloading all uploaded and converted files"),xr.createElement("p",null,"Use this button to download an archive of all uploaded files. This includes the original files as well as converted files:"),xr.createElement("button",{type:"button",onClick:this.props.onDownloadFiles},"Download files"),xr.createElement("h2",null,"Resetting files"),xr.createElement("p",null,'You can use the "Reset all files" button to delete all uploaded files if needed: ',xr.createElement("button",{onClick:this.resetFiles},"Reset all files")))}}])&&oi(n.prototype,r),i&&oi(n,i),t}(xr.Component);function di(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function fi(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){di(a,r,i,o,s,"next",e)}function s(e){di(a,r,i,o,s,"throw",e)}o(void 0)}))}}function hi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var pi=n("oxjq"),mi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.logger=void 0,this.logger=r}var t,n,i,a,s,c,l,d,f,h,p,m,g,v,y,b,w,x,k,E;return t=e,(n=[{key:"init",value:(E=fi(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,this.fs.ls("/");case 3:e.t1=e.sent,e.t0.table.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"render",value:function(e){var t,n,r=this,i=document.createElement("div");kr.render(xr.createElement(li,{onUploaded:this.uploadAndParse.bind(this),onReset:this.reset.bind(this),onSaveOrMissionUploaded:(n=fi(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.target.files)&&0!==n.length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Promise.all(Array.from(n).map((function(e){return r.uploadSaveOrMission(e)})));case 5:alert("Upload finished. The page will now refresh."),window.location.reload(!0);case 7:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),onDownloadFiles:(t=fi(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.fs.download("/");case 2:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)}),setLogger:this.setLogger.bind(this)}),e),e.appendChild(i)}},{key:"isUploaded",value:(k=fi(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fs.exists("/fields.dat"));case 1:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"setLogger",value:function(e){this.logger=e}},{key:"reset",value:(x=fi(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.rmRoot();case 2:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"uploadAndParse",value:(w=fi(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fs.write("/original.zip",t);case 3:return e.next=5,this.fs.open("/original.zip");case 5:return r=e.sent,e.next=8,u.a.loadAsync(r);case 8:n=e.sent,e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),this.logger.error("Could not upload the ZIP file: ".concat(e.t0.message)),e.abrupt("return",!1);case 15:return e.prev=15,i=Object(R.b)(n),e.next=19,this.fs.rmRoot();case 19:return e.next=21,this.copyIslands(i);case 21:return e.next=23,this.copySaves(i);case 23:return e.next=25,this.parseTranslations(i);case 25:return a=e.sent,e.next=28,this.copyMissions(i,a);case 28:return e.next=30,this.decryptCODs(i);case 30:return e.next=32,this.parseDATs();case 32:return e.next=34,this.parseGADs(i);case 34:return e.next=36,this.parseBSHs(i);case 36:return e.next=38,this.parseZEIs(i);case 38:return e.next=40,this.parseMusic(i);case 40:return e.next=42,this.parseVideos(i);case 42:e.next=48;break;case 44:return e.prev=44,e.t1=e.catch(15),this.logger.error(e.t1.message),e.abrupt("return",!1);case 48:return e.abrupt("return",!0);case 49:case"end":return e.stop()}}),e,this,[[0,11],[15,44]])}))),function(e){return w.apply(this,arguments)})},{key:"uploadSaveOrMission",value:(b=fi(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".gam")){e.next=5;break}return e.next=3,this.fs.write("/saves/".concat(t.name),t);case 3:e.next=7;break;case 5:return e.next=7,this.fs.write("/missions-custom/".concat(t.name),t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"parseDATs",value:(y=fi(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([["/fields.dat","/fields.json"],["/animations.dat","/animations.json"]].map(function(){var e=fi(regeneratorRuntime.mark((function e(n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n[0],i=n[1],t.logger.info('Started parsing "'.concat(r,'".')),a=new Mr,e.t0=a,e.next=7,t.fs.openAndGetContentAsText(r);case 7:return e.t1=e.sent,o=e.t0.parse.call(e.t0,e.t1),e.next=11,t.fs.write(i,JSON.stringify(o));case 11:t.logger.info('Finished parsing "'.concat(r,'".'));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})},{key:"parseGADs",value:(v=fi(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/screens");case 2:return n=new Mr,r="GADDATA/TOOLS.INC",this.logger.info('Started parsing "'.concat(r,'".')),i=this.findFileCaseInsensitive(t,r),e.t0=n,e.next=9,i.async("text");case 9:e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),o=new Map(Object.entries(a.variables)),this.logger.info('Finished parsing "'.concat(r,'".')),s=0,u=[["Anno.gad",""],["BASE.GAD","menu_main"],["BAU.GAD",""],["BAUKONT.GAD",""],["BAUSHIP.GAD",""],["BERGWERK.GAD",""],["BUBBLE01.GAD",""],["BUBBLE.GAD",""],["CHAT.GAD",""],["CLIENT.GAD",""],["CTRL.GAD",""],["DISK.GAD",""],["ENDE.GAD","menu_points"],["FARBWAHL.GAD","menu_player_selection"],["HANDEL.GAD",""],["HOST.GAD","menu_missions"],["INFO.GAD",""],["INFRA.GAD",""],["KONTOR.GAD",""],["LAGER.GAD",""],["LEIST.GAD",""],["MARKT.GAD",""],["MILITAR.GAD",""],["MISSION.GAD","menu_mission_details"],["MISSZIEL.GAD",""],["MKSHIP.GAD",""],["MKSOLDAT.GAD",""],["MUSIK.GAD",""],["OPTION.GAD",""],["PIRAT.GAD",""],["PIRATORD.GAD",""],["PLANTAGE.GAD",""],["PROD.GAD",""],["ROUTE.GAD",""],["SCAPE.GAD",""],["SHIP.GAD",""],["SHIPLIST.GAD",""],["SIEDLER.GAD",""],["SKSHIP.GAD",""],["SKSOLDAT.GAD",""],["STADT.GAD",""],["STADTLST.GAD",""],["TRADE.GAD",""],["TRADER.GAD",""],["TRANSFER.GAD",""],["TRIBUT.GAD",""],["TUTOR.GAD",""],["VERTRAG.GAD",""],["WAITLOAD.GAD","menu_loading"],["WERFT.GAD",""]];case 15:if(!(s<u.length)){e.next=34;break}return""===(c=u[s])[1]&&(c[1]=c[0]),l="GADDATA/".concat(c[0]),d="/screens/".concat(c[1],".json"),this.logger.info('Started parsing "'.concat(l,'".')),f=this.findFileCaseInsensitive(t,l),e.t2=n,e.next=25,f.async("text");case 25:return e.t3=e.sent,e.t4=o,h=e.t2.parse.call(e.t2,e.t3,e.t4),e.next=30,this.fs.write(d,JSON.stringify(h));case 30:this.logger.info('Finished parsing "'.concat(l,'".'));case 31:s++,e.next=15;break;case 34:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"decryptCODs",value:(g=fi(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Gr.a,e.abrupt("return",Promise.all([["haeuser.cod","/fields.dat"],["figuren.cod","/animations.dat"]].map(function(){var e=fi(regeneratorRuntime.mark((function e(i){var a,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i[0],s=i[1],r.logger.info('Started parsing "'.concat(a,'".')),u=r.findFileCaseInsensitive(t,a),e.next=6,o.a.fromZipObject(u);case 6:return c=e.sent,e.next=9,r.fs.write(s,n.decrypt(c));case 9:r.logger.info('Finished parsing "'.concat(a,'".'));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 2:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"parseBSHs",value:(m=fi(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,u,c,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new Nr,r=0,i=[["GFX/NUMBERS","NUMBERS"],["GFX/STADTFLD","STADTFLD"],["GFX/EFFEKTE","EFFEKT"],["GFX/FISCHE","WAL"],["GFX/GAUKLER","GAUKLER"],["GFX/MAEHER","MAEHER"],["GFX/SCHATTEN","SCHATTEN"],["GFX/SHIP","SHIP"],["GFX/SOLDAT","SOLDAT"],["GFX/TIERE","RIND"],["GFX/TRAEGER","TRAEGER"],["ToolGfx/BAUHAUS","TOOLS/BAUHAUS"],["ToolGfx/BAUSHIP","TOOLS/BAUSHIP"],["ToolGfx/START","TOOLS/START"],["ToolGfx/SYMBOL","TOOLS/SYMBOL"],["ToolGfx/TOOLS","TOOLS/TOOLS"]];case 3:if(!(r<i.length)){e.next=23;break}return a=i[r],s=a[0]+".BSH",u=a[1],this.logger.info('Started parsing "'.concat(s,'".')),c=this.findFileCaseInsensitive(t,s),e.t0=n,e.next=12,o.a.fromZipObject(c);case 12:return e.t1=e.sent,e.next=15,e.t0.decodeBSH.call(e.t0,e.t1);case 15:return l=e.sent,d=n.createSpriteSheets(u,l),e.next=19,n.saveSpriteSheets(this.fs,d,"/gfx/".concat(u));case 19:this.logger.info('Finished parsing "'.concat(s,'".'));case 20:r++,e.next=3;break;case 23:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"parseTranslations",value:(p=fi(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("Started parsing translations."),n=this.findFileCaseInsensitive(t,"text.cod"),r=new Gr.a,e.t0=Qr,e.t1=r,e.next=7,o.a.fromZipObject(n);case 7:return e.t2=e.sent,e.t3=e.t1.decrypt.call(e.t1,e.t2),i=(0,e.t0)(e.t3),e.next=12,this.fs.write("/translations.json",JSON.stringify(i));case 12:return this.logger.info("Finished parsing translations."),e.abrupt("return",i.PATH[0]);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"parseZEIs",value:(h=fi(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,u,c,l,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/fonts");case 2:n=new Nr,r=new $r,i=0,a=["ZEI11A","ZEI14A","ZEI14V","ZEI16G","ZEI16H","ZEI16V","ZEI20H","ZEI20V","ZEI24V","ZEI28V","ZEI2","ZEI9A"];case 6:if(!(i<a.length)){e.next=30;break}return s=a[i],u="TOOLGFX/".concat(s,".ZEI"),this.logger.info('Started parsing "'.concat(u,'".')),c=this.findFileCaseInsensitive(t,u),e.t0=n,e.next=14,o.a.fromZipObject(c);case 14:return e.t1=e.sent,e.next=17,e.t0.decodeZEI.call(e.t0,e.t1);case 17:return l=e.sent,d=n.createSpriteSheets(s,l),e.next=21,n.saveSpriteSheets(this.fs,d,"/fonts/".concat(s));case 21:return e.next=23,r.createBitmapFont(d,s);case 23:return f=e.sent,e.next=26,this.fs.write("/fonts/".concat(s,"/font.xml"),f);case 26:this.logger.info('Finished parsing "'.concat(u,'".'));case 27:i++,e.next=6;break;case 30:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"parseMusic",value:(f=fi(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/music");case 2:if(this.hasFolderCaseInsensitive(t,"MUSIC8")){e.next=5;break}return this.logger.warn("No music files found."),e.abrupt("return");case 5:n=new Vr,r=this.findFilesInZip(t,"MUSIC8",".wav"),i=!0,a=!1,o=void 0,e.prev=10,s=r[Symbol.iterator]();case 12:if(i=(u=s.next()).done){e.next=28;break}return c=u.value,l=c.path.substr(1),this.logger.info("Converting song ".concat(l)),e.t0=n,e.next=19,c.file.async("uint8array");case 19:return e.t1=e.sent,d=e.t0.decode.call(e.t0,e.t1),f=n.encode(d),e.next=24,this.fs.write("/music/".concat(l),f);case 24:this.logger.info("Finished converting song ".concat(l));case 25:i=!0,e.next=12;break;case 28:e.next=34;break;case 30:e.prev=30,e.t2=e.catch(10),a=!0,o=e.t2;case 34:e.prev=34,e.prev=35,i||null==s.return||s.return();case 37:if(e.prev=37,!a){e.next=40;break}throw o;case 40:return e.finish(37);case 41:return e.finish(34);case 42:case"end":return e.stop()}}),e,this,[[10,30,34,42],[35,,37,41]])}))),function(e){return f.apply(this,arguments)})},{key:"parseVideos",value:(d=fi(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/videos");case 2:if(this.hasFolderCaseInsensitive(t,"VIDEOSMK")){e.next=5;break}return this.logger.warn("No video files found."),e.abrupt("return");case 5:n=new Kr,r=this.findFilesInZip(t,"VIDEOSMK",".smk"),i=!0,a=!1,o=void 0,e.prev=10,s=r[Symbol.iterator]();case 12:if(i=(u=s.next()).done){e.next=28;break}return c=u.value,l=c.path.substr(1),this.logger.info("Converting video ".concat(l)),e.next=18,c.file.async("uint8array");case 18:return d=e.sent,e.next=21,n.parse(d);case 21:return f=e.sent,e.next=24,this.fs.write("/videos/".concat(l.replace(".smk",".mp4")),f);case 24:this.logger.info("Finished converting video ".concat(l));case 25:i=!0,e.next=12;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(10),a=!0,o=e.t0;case 34:e.prev=34,e.prev=35,i||null==s.return||s.return();case 37:if(e.prev=37,!a){e.next=40;break}throw o;case 40:return e.finish(37);case 41:return e.finish(34);case 42:case"end":return e.stop()}}),e,this,[[10,30,34,42],[35,,37,41]])}))),function(e){return d.apply(this,arguments)})},{key:"copyIslands",value:(l=fi(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([["NOKLIMA","/islands/noklima"],["NORD","/islands/north"],["NORDNAT","/islands/northnat"],["SUED","/islands/south"],["SUEDNAT","/islands/southnat"]].map((function(e){return n.copyFolderFromZip(t,e[0],e[1],".scp")}))));case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"copySaves",value:(c=fi(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyFolderFromZip(t,"SAVEGAME","/saves",".gam");case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"copyMissions",value:(s=fi(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyFolderFromZip(t,"Szenes","/missions-original",".szm|.szs|.hss");case 2:return e.next=4,this.copyFolderFromZip(t,n,"/missions-custom",".szm|.szs|.hss");case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"copyFolderFromZip",value:(a=fi(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,u,c,l,d,f,h,p,m,g=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(g.length>4&&void 0!==g[4])||g[4],n="".concat(n,"/"),this.logger.info("Copying '".concat(i,"' files from '").concat(n,"' to '").concat(r,"'.")),o=this.findFilesInZip(t,n,i),e.next=6,this.fs.mkdir(r);case 6:s=!0,u=!1,c=void 0,e.prev=9,l=o[Symbol.iterator]();case 11:if(s=(d=l.next()).done){e.next=27;break}return f=d.value,h=a?f.path.toLowerCase():f.path,p=f.file,m="".concat(r,"/").concat(h),this.logger.info("Copying '".concat(h,"' to '").concat(m,"'.")),e.t0=this.fs,e.t1=m,e.next=21,p.async("blob");case 21:return e.t2=e.sent,e.next=24,e.t0.write.call(e.t0,e.t1,e.t2);case 24:s=!0,e.next=11;break;case 27:e.next=33;break;case 29:e.prev=29,e.t3=e.catch(9),u=!0,c=e.t3;case 33:e.prev=33,e.prev=34,s||null==l.return||l.return();case 36:if(e.prev=36,!u){e.next=39;break}throw c;case 39:return e.finish(36);case 40:return e.finish(33);case 41:case"end":return e.stop()}}),e,this,[[9,29,33,41],[34,,36,40]])}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"findFilesInZip",value:function(e,t,n){var r=[];return e.forEach((function(e,i){if(e.startsWith(t)){var a=!0,o=!1,s=void 0;try{for(var u,c=n.split("|")[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;if(e.toLowerCase().endsWith(l.toLowerCase())){e=(e=e.substring(t.length)).substring(0,e.length-l.length),e+=l,r.push({path:e,file:i});break}}}catch(e){o=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}}})),r}},{key:"findFileCaseInsensitive",value:function(e,t){var n=new RegExp("^".concat(pi(t),"$"),"i"),r=e.file(n)[0];if(void 0===r)throw new Error("Could not find file ".concat(t,"."));return r}},{key:"hasFolderCaseInsensitive",value:function(e,t){t.endsWith("/")||(t+="/");var n=new RegExp("^".concat(pi(t),"$"),"i");return void 0!==e.folder(n)[0]}}])&&hi(t.prototype,n),i&&hi(t,i),e}();function gi(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function vi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var yi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.translations=new Map,this.jsonData=void 0}var t,n,r,i,a;return t=e,(n=[{key:"loadTranslations",value:(i=regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.fs.openAndGetContentAsText("/translations.json");case 3:for(e.t1=e.sent,this.jsonData=e.t0.parse.call(e.t0,e.t1),t=0,n=Object.keys(this.jsonData);t<n.length;t++)for(a in r=n[t],i=he[r])parseInt(a,10)>=0&&(o=i[a],this.translations.set(o,this.jsonData[r][a]));case 6:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){gi(a,n,r,o,s,"next",e)}function s(e){gi(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return a.apply(this,arguments)})},{key:"translate",value:function(e){var t=this.translations.get(e);if(!t)throw new Error("Unknown translation key ".concat(e,"."));return t}},{key:"getFieldName",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=pe[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)for(var o=i.value,s=0;s<o.ids.length;s++)if(o.ids[s]===e)return this.jsonData[o.type][s]}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}throw new Error("Could not find translation for field id ".concat(e,"."))}},{key:"populationLevelName",value:function(e){switch(e){case 0:return this.translate("game.pioneers");case 1:return this.translate("game.settlers");case 2:return this.translate("game.citizens");case 3:return this.translate("game.merchants");case 4:return this.translate("game.aristocrats");default:throw new Error("Unknown inhabitant level ".concat(e,"."))}}}])&&vi(t.prototype,n),r&&vi(t,r),e}();function bi(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function wi(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){bi(a,r,i,o,s,"next",e)}function s(e){bi(a,r,i,o,s,"throw",e)}o(void 0)}))}}wi(regeneratorRuntime.mark((function e(){var t,n,o,s,u,c,l,d,f,h,m,g,v,y,b,w,x,k,E,S,_,I,O,T,P,C,N,G,D,j,F,L,M,H,B;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.enableAll(),(t=document.createElement("style")).innerText="\n        body, html {\n            margin: 0;\n        }\n    ",(n=document.createElement("div")).id="game",(o=document.createElement("p")).innerHTML="Anno 2018, version ".concat("df55a8a",',\n                        made by <a href="https://github.com/cmfcmf">@cmfcmf</a>.\n                        The source is at <a href="https://github.com/cmfcmf/Anno2018">GitHub</a>.\n                        <br />\n                        <a href="thirdparty.txt">Thirdparty Notices</a>\n                        | <a href="https://cmfcmf.github.io/about">Datenschutz</a>'),document.head.appendChild(t),document.body.appendChild(n),document.body.appendChild(o),s=new p,2e3,e.next=14,s.init(2097152e3);case 14:return window.fs=s,u=new mi(s),e.next=18,u.init();case 18:return u.render(n),e.next=21,u.isUploaded();case 21:if(e.sent){e.next=24;break}return console.warn("Anno 1602 files not yet uploaded."),e.abrupt("return");case 24:return a.settings.SCALE_MODE=a.SCALE_MODES.NEAREST,a.settings.MIPMAP_TEXTURES=a.MIPMAP_MODES.OFF,c=new a.Application({width:window.innerWidth,height:window.innerHeight-120,antialias:!1,transparent:!1}),n.insertAdjacentElement("afterbegin",c.view),l=new i.a({screenWidth:c.screen.width,screenHeight:c.screen.height,passiveWheel:!1}),c.stage.addChild(l),l.drag({direction:"all",wheel:!1}).wheel().mouseEdges({distance:20,speed:15}),d=new i.a({screenWidth:c.screen.width,screenHeight:c.screen.height,worldWidth:1024,worldHeight:768}),c.stage.addChild(d),f=new yi(s),e.next=36,f.loadTranslations();case 36:return h=new xt(s),e.next=39,h.load();case 39:return m=new yt(s),e.next=42,m.load();case 42:return console.log("Finished loading config."),g=new cr(s),e.next=46,g.load();case 46:return console.log("Finished loading music."),v=new wr(s),y=new gr(s,m.getFieldData()),e.t0=JSON,e.next=52,s.openAndGetContentAsText("/animations.json");case 52:if(e.t1=e.sent,b=e.t0.parse.call(e.t0,e.t1),w=new pt(b,v),x=new Zn(y),k=new qt(m,v,w),E=new Ut(v),S=new ir(s,E,g,f),_=new lt(s,x,k,c,l,m,g,w,S,f,v),I=Object(R.c)("load"),O=Object(R.c)("gad"),T=Object(R.c)("animation"),P=Object(R.c)("island"),null===I){e.next=70;break}return e.next=67,_.loadByName(I);case 67:d.visible=!1,e.next=127;break;case 70:if(null===O){e.next=100;break}console.info('Rendering "'.concat(O,'" screen.')),C=!0,N=!1,G=void 0,e.prev=75,D=O.split(",")[Symbol.iterator]();case 77:if(C=(j=D.next()).done){e.next=84;break}return F=j.value,e.next=81,S.renderScreen(d,F);case 81:C=!0,e.next=77;break;case 84:e.next=90;break;case 86:e.prev=86,e.t2=e.catch(75),N=!0,G=e.t2;case 90:e.prev=90,e.prev=91,C||null==D.return||D.return();case 93:if(e.prev=93,!N){e.next=96;break}throw G;case 96:return e.finish(93);case 97:return e.finish(90);case 98:e.next=127;break;case 100:if(null===T){e.next=106;break}return console.log('Rendering animation "'.concat(T,'".')),e.next=104,w.renderAnimation(T,l);case 104:e.next=127;break;case 106:if(null===P){e.next=124;break}return console.info('Rendering island "'.concat(P,'".')),e.next=110,y.loadIslandFileByName(P);case 110:for(L=e.sent,M=[];!L.eof();)M.push(Pn.fromStream(L));return console.table(M),H=hn(M.find((function(e){return["INSEL5","INSEL4","INSEL3"].includes(e.type)})).data),y.setIslandFields(H,[M.find((function(e){return"INSELHAUS"===e.type}))]),H.position=new a.Point(0,0),H.positionRect=new a.Rectangle(0,0,H.size.x,H.size.y),d.visible=!1,B=new A(l,k),e.next=122,B.render([H]);case 122:e.next=127;break;case 124:return S.on("load-game",function(){var e=wi(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.load(t);case 2:d.visible=!1;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=127,S.renderScreen(d,"menu_main");case 127:case"end":return e.stop()}}),e,null,[[75,86,90,98],[91,,93,97]])})))()},"/dzE":function(module,__webpack_exports__,__webpack_require__){"use strict";(function(__dirname){__webpack_require__.d(__webpack_exports__,"a",(function(){return loadFFmpeg}));var async_lock__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("aNYc"),async_lock__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(async_lock__WEBPACK_IMPORTED_MODULE_0__),loadedFFmpeg;function asyncGeneratorStep(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){asyncGeneratorStep(a,r,i,o,s,"next",e)}function s(e){asyncGeneratorStep(a,r,i,o,s,"throw",e)}o(void 0)}))}}var lock=new async_lock__WEBPACK_IMPORTED_MODULE_0___default.a;function loadFFmpeg(){return _loadFFmpeg.apply(this,arguments)}function _loadFFmpeg(){return(_loadFFmpeg=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lock.acquire("ffmpeg",_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(loadedFFmpeg){e.next=6;break}return e.next=3,doLoadFFmpeg();case 3:return loadedFFmpeg=e.sent,e.next=6,new Promise((function(e,t){loadedFFmpeg({arguments:["-version"],returnCallback:e})}));case 6:case"end":return e.stop()}}),e)}))));case 2:return e.abrupt("return",loadedFFmpeg);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function doLoadFFmpeg(){return _doLoadFFmpeg.apply(this,arguments)}function _doLoadFFmpeg(){return _doLoadFFmpeg=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var ffmpeg;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(console.log("Loading FFmpeg"),"undefined"==typeof window){_context3.next=7;break}return _context3.next=4,loadFFmpegInBrowser();case 4:ffmpeg=_context3.sent,_context3.next=8;break;case 7:ffmpeg=eval("require")(__dirname+"/../../node_modules/smk2mp4/demo/ffmpeg.js");case 8:return console.log("Finished loading FFmpeg"),_context3.abrupt("return",ffmpeg);case 10:case"end":return _context3.stop()}}),_callee3)}))),_doLoadFFmpeg.apply(this,arguments)}function loadFFmpegInBrowser(){return _loadFFmpegInBrowser.apply(this,arguments)}function _loadFFmpegInBrowser(){return(_loadFFmpegInBrowser=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n=function(){var n=self.ffmpeg_run;n?e(n):t("Could not load FFmpeg!")},r=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src="ffmpeg.js",i.onreadystatechange=n,i.onload=n,r.appendChild(i)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,"/")},0:function(e,t,n){n("LSZE"),n("ls82"),n("ZPch"),e.exports=n("/7QA")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},cE7O:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("lXCB");function i(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.pos=void 0,this.data=void 0,this.pos=0,this.data=e}return o(n,null,[{key:"fromZipObject",value:(e=regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.async("uint8array");case 2:return r=e.sent,e.abrupt("return",new n(r));case 4:case"end":return e.stop()}}),e)})),t=function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,u,"next",e)}function u(e){i(o,r,a,s,u,"throw",e)}s(void 0)}))},function(e){return t.apply(this,arguments)})}]),o(n,[{key:"position",value:function(){return this.pos}},{key:"seek",value:function(e){this.pos=e}},{key:"readString",value:function(e){for(var t="",n=!1;e--;){var r=this.read8();n||0===r?n=!0:t+=String.fromCharCode(r)}return t}},{key:"readStringUnterminated",value:function(e){for(var t="";e--;)t+=String.fromCharCode(this.read8());return t}},{key:"read",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e*=t;for(var n=[];e>0;)n.push(this.readNBytes(t)),e-=t;return n}},{key:"slice",value:function(e){var t=this.data.slice(this.pos,this.pos+e);return this.pos+=e,t}},{key:"read16",value:function(){return this.readNBytes(2)}},{key:"read24",value:function(){return this.readNBytes(3)}},{key:"read32",value:function(){return this.readNBytes(4)}},{key:"read32S",value:function(){return this.readNBytes(4)>>0}},{key:"read8",value:function(){return this.data[this.pos++]}},{key:"eof",value:function(){return this.pos===this.length}},{key:"read8Bool",value:function(){return 0!==this.read8()}},{key:"readNBytes",value:function(e){for(var t=0,n=0;n<e;n++)t+=this.read8()*Math.pow(2,8*n);return t}},{key:"writeNBytes",value:function(e,t){for(var n=0;n<e;n++)this.write8(t*Math.pow(2,8*-n)&255)}},{key:"write8",value:function(e){Object(r.a)(e>=0&&e<=255),this.data[this.pos++]=e}},{key:"write16",value:function(e){this.writeNBytes(2,e)}},{key:"length",get:function(){return this.data.length}}]),n}()},daKf:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var r=n("rPnE"),i=n("cE7O");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.encoding="win1252"}var n,o,s;return n=t,(o=[{key:"decrypt",value:function(t){for(var n=e.allocUnsafe(t.length),i=0;i<t.length;i++)n[i]=256-t.read8();return Object(r.decode)(n,this.encoding)}},{key:"encrypt",value:function(t){for(var n=new i.a(Object(r.encode)(t,this.encoding)),a=e.allocUnsafe(n.length),o=0;o<n.length;o++)a[o]=256-n.read8();return a}}])&&a(n.prototype,o),s&&a(n,s),t}()}).call(this,n("tjlA").Buffer)},lXCB:function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t||"unknown assertion error")}n.d(t,"a",(function(){return r}))},vurl:function(module,__webpack_exports__,__webpack_require__){"use strict";function uInt8ToBase64(arr){for(var CHUNK_SIZE=32768,index=0,length=arr.length,result="";index<length;){var slice=arr.subarray(index,Math.min(index+CHUNK_SIZE,length));result+=String.fromCharCode.apply(null,slice),index+=CHUNK_SIZE}return"undefined"!=typeof window?btoa(result):eval("require")("btoa")(result)}function getQueryParameter(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=window.location.href;e=e.replace(/[[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=r.exec(n);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":t}function findRootInZip(e){var t=e.filter((function(e){return("/"+e).endsWith("/GFX/")}));if(1===t.length)return e.folder(t[0].name.replace("GFX/",""));throw new Error("Your ZIP file does not have the expected structure.")}function make2DArray(e,t){return Array(e).fill(void 0).map((function(){return Array(t).fill(null)}))}function assertNever(e){throw new Error("Unexpected object: ".concat(e))}__webpack_require__.d(__webpack_exports__,"e",(function(){return uInt8ToBase64})),__webpack_require__.d(__webpack_exports__,"c",(function(){return getQueryParameter})),__webpack_require__.d(__webpack_exports__,"b",(function(){return findRootInZip})),__webpack_require__.d(__webpack_exports__,"d",(function(){return make2DArray})),__webpack_require__.d(__webpack_exports__,"a",(function(){return assertNever}))}},[[0,1,2]]]);
//# sourceMappingURL=app.699ecad7029dc16befc9.js.map